import e from"assert";import t from"node:assert";import{toBigIntLE as A,toBufferLE as r}from"bigint-buffer";import{secretKey as n,publicKey as s,ringRoot as o,ringVrfVerify as i,ringVrfOutputHash as a,ietfVrfOutputHashFromSecret as g,ietfVrfOutputHash as c,ietfVrfSign as u,ietfVrfVerify as I}from"@tsjam/crypto-napi";import d from"sodium-native";import p from"fs";import l from"node:fs";import y from"node:net";import{parseArgs as h}from"node:util";const C=2n**64n-1n,E=2n**64n-2n,m=2n**64n-3n,B=2n**64n-4n,Q=2n**64n-5n,f=2n**64n-6n,_=2n**64n-7n,w=2n**64n-8n,v=2n**64n-9n,b=0n;var S;!function(e){e[e.HALT=0]="HALT",e[e.PANIC=1]="PANIC",e[e.FAULT=2]="FAULT",e[e.HOST=3]="HOST",e[e.OOG=4]="OOG"}(S||(S={}));var D=Object.freeze({__proto__:null,BLOCK_TIME:6,CORES:2,EPOCH_LENGTH:12,ERASURECODE_EXPORTED_SIZE:1026,LOTTERY_MAX_SLOT:10,MAX_TICKETS_PER_BLOCK:3,MAX_TICKETS_PER_VALIDATOR:3,MINIMUM_VALIDATORS:5,NUMBER_OF_VALIDATORS:6,PREIMAGE_EXPIRATION:32,TOTAL_GAS_ACCUMULATION_ALL_CORES:20000000n,TOTAL_GAS_REFINEMENT_LOGIC:1000000000n,VALIDATOR_CORE_ROTATION:4});let N=6;let O=1023,k=683,M=341,x=500,R=600,F=16,U=2;let T=10;const G=14400,j=(new TextEncoder).encode("jam_available");(new TextEncoder).encode("jam_beefy");const H=(new TextEncoder).encode("jam_entropy"),L=(new TextEncoder).encode("jam_fallback_seal"),Y=(new TextEncoder).encode("jam_guarantee");(new TextEncoder).encode("jam_announce");const K=(new TextEncoder).encode("jam_ticket_seal");(new TextEncoder).encode("jam_audit");const J=(new TextEncoder).encode("jam_valid"),P=(new TextEncoder).encode("jam_invalid"),V=80,X=4e7,z=128;let q=19200;let W=6;const Z=684*W,$=10000000n;let ee=5000000000n;let te=3500000000n;const Ae=4096,re=65536;let ne="full";function se(){return ne}!function(){const e="tiny"===process.env.JAM_CONSTANTS?"tiny":"full";if("full"===e)return;const t=D;O=t.NUMBER_OF_VALIDATORS,M=t.CORES,q=t.PREIMAGE_EXPIRATION,N=t.BLOCK_TIME,R=t.EPOCH_LENGTH,x=t.LOTTERY_MAX_SLOT,U=t.MAX_TICKETS_PER_VALIDATOR,F=t.MAX_TICKETS_PER_BLOCK,T=t.VALIDATOR_CORE_ROTATION,W=t.ERASURECODE_EXPORTED_SIZE,te=t.TOTAL_GAS_ACCUMULATION_ALL_CORES,ee=t.TOTAL_GAS_REFINEMENT_LOGIC,k=t.MINIMUM_VALIDATORS,ne=e}();const oe=(e,t)=>{const A=new Uint8Array(e.encodedSize(t));return e.encode(t,A),A},ie=e=>({encode(t,A){let r=0;for(const[n,s]of e)try{r+=s.encode(t[n],A.subarray(r))}catch(e){throw console.error(`Error encoding key: ${n}`,e,t[n],s,Object.getPrototypeOf(t)),e}return r},decode(t){let A=0;const r={};for(const[n,s]of e){if(void 0===s.decode)throw new Error(`codec.decode for ${String(n)} is undefined`);const{value:e,readBytes:o}=s.decode(t.subarray(A));r[n]=e,A+=o}return{value:r,readBytes:A}},encodedSize(t){let A=0;for(const[r,n]of e)A+=n.encodedSize(t[r]);return A}}),ae=(e,t,A)=>({encode:(t,r)=>e.encode(A(t),r),decode(A){const{value:r,readBytes:n}=e.decode(A);return{value:t(r),readBytes:n}},encodedSize:t=>e.encodedSize(A(t))}),ge=Symbol.for("__jamcodecs__"),ce=Symbol.for("__jamcodec__singleelclass");class ue{static encode(e,t){throw new Error(`stub! ${this.name}`)}static decode(e){throw new Error(`stub! ${this.name}`)}static encodedSize(e){throw new Error(`stub! ${this.name}`)}static fromJSON(e){throw new Error(`stub! ${this.name}`)}static toJSON(e){throw new Error(`stub! ${this.name}`)}static codecOf(t){const A=this.prototype[ge]?.find(e=>e.propertyKey===t);return e(A,`Codec for property ${String(t)} not found in ${this.name}`),{encode:A.codec.encode.bind(A.codec),decode:A.codec.decode.bind(A.codec),encodedSize:A.codec.encodedSize.bind(A.codec),fromJSON:A.json.codec.fromJSON.bind(A.json.codec),toJSON:A.json.codec.toJSON.bind(A.json.codec)}}toBinary(){throw new Error("stub")}toJSON(){throw new Error("stub!")}}const Ie=e=>((e,t)=>e.decode(oe(e,t)).value)(Object.getPrototypeOf(e).constructor,e),de=e=>({fromJSON(t){const A={};for(const[r,n,s]of e)try{A[r]=s.fromJSON(t[n])}catch(e){throw console.error("Error in JSONCodec",r,n,e?.message),console.error(e),console.log(t[n]),e}return A},toJSON(t){const A={};for(const[r,n,s]of e)A[n]=s.toJSON(t[r]);return A}});function pe(e){return function(t,A){t[ge]||(t[ge]=[]),t[ge].push({propertyKey:A,codec:e})}}function le(e,t){return function(A,r){A[ge]||(A[ge]=[]);const n=A[ge].find(e=>e.propertyKey===r);if(void 0===n)throw new Error(`jsonCodec decorator for ${String(r)} must be applied after binaryCodec decorator`);n.json={codec:e,key:t}}}function ye(e,t,A){const r="string"==typeof t||t===ce?t:A,n="object"==typeof t?t:e;return function(t,A){pe(e)(t,A),le(n,r)(t,A)}}function he(e){return function(t){const A=t.prototype[ge];A.forEach(({propertyKey:e,codec:A})=>{if(void 0===A||"function"!=typeof A.encode)throw console.log(t.name,A),new Error(`codec for ${e} is not defined properly`)});const r=ae(ie(A.map(({propertyKey:e,codec:t})=>[e,t])),e=>{const t=new o;return Object.assign(t,e),t},e=>e);let n=!1,s=de(A.map(({propertyKey:e,json:t})=>{if(void 0===t)throw new Error(`json codec for ${e} is not defined`);return n=n||t.key===ce,[e,t.key??e,t.codec]}));if(n&&A.length>1)throw new Error("SINGLE_ELEMENT_CLASS used with more than one element");if(n){const e=s;s={toJSON:t=>e.toJSON(t)[ce],fromJSON:t=>e.fromJSON({[ce]:t})}}e&&(s=t);const o=Ce(t.name,class extends t{toBinary(){return oe(r,this)}toJSON(){return s.toJSON(this)}static encode(e,t){return r.encode(e,t)}static decode(e){return r.decode(e)}static encodedSize(e){return r.encodedSize(e)}static fromJSON(e){const t=s.fromJSON(e),A=new o;return Object.assign(A,t),A}static toJSON(e){return s.toJSON(e)}});return o}}const Ce=(e,t)=>new Function("Base",`return class ${e} extends Base {}`)(t),Ee=e=>Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join(""),me={arrayToBigEndian:e=>0===e.length?0n:BigInt("0x"+Ee(e)),arrayToLittleEndian:e=>0===e.length?0n:BigInt("0x"+Ee(new Uint8Array(e).reverse())),bigEndianToNewArray(e,t){const A=new Uint8Array(t);return me.bigEndianToArray(e,A),A},bigEndianToArray(e,t){const A=e.toString(16).padStart(2*t.length,"0");t.set(A.match(/.{2}/g).map(e=>parseInt(e,16)))},littleEndianToNewArray(e,t){const A=new Uint8Array(t);return me.littleEndianToArray(e,A),A},littleEndianToArray(e,t){me.bigEndianToArray(e,t),t.reverse()}},Be=(e,A)=>0===A.length?0:(e=BigInt(e),t.ok(e>=0,"value must be positive"),t.ok(e<2**(8*A.length),"value is too large"),me.littleEndianToArray(e,A),A.length),Qe=e=>({value:me.arrayToLittleEndian(e),readBytes:e.length}),fe=e=>`0x${Buffer.from(e).toString("hex")}`,_e=()=>({fromJSON:e=>BigInt(e),toJSON:e=>Number(e)}),we=()=>({fromJSON:e=>new Uint8Array([...Buffer.from(e.slice(2),"hex")]),toJSON:e=>fe(e)}),ve={fromJSON:e=>new Uint8Array([...Buffer.from(e.slice(2),"hex")]),toJSON:e=>fe(e)},be=e=>({fromJSON:t=>t.map(t=>e.fromJSON(t)),toJSON:t=>t.map(t=>e.toJSON(t))}),Se=(e,t,A)=>({fromJSON:r=>new Map(r.map(r=>[t.fromJSON(r[e.key]),A.fromJSON(r[e.value])])),toJSON:r=>[...r.entries()].map(([r,n])=>({[e.key]:t.toJSON(r),[e.value]:A.toJSON(n)}))}),De=e=>({fromJSON(t){if(null!==t)return e.fromJSON(t)},toJSON:t=>void 0===t?null:e.toJSON(t)}),Ne=(e,t)=>({fromJSON:A=>t.fromJSON(e.fromJSON(A)),toJSON:A=>e.toJSON(t.toJSON(A))}),Oe=e=>({encode:(A,n)=>(t(n.length>=e,`bytes length=${n.length} must be >= sub=${e}`),n.set(r(A,e)),e),decode:t=>{if(t.length<e){const A=new Uint8Array(e).fill(0);return A.set(t),Qe(A)}return{value:A(t.subarray(0,e)),readBytes:e}},encodedSize:()=>e}),ke=Oe(1),Me=Oe(2),xe=Oe(4),Re=Oe(8),Fe=e=>({encode:(A,r)=>(t(r.length>=e,`bytes length=${r.length} must >= sub=${e}`),Be(BigInt(A),r.subarray(0,e))),decode:t=>{if(t.length<e){const A=new Uint8Array(e).fill(0);A.set(t);const r=Qe(A);return{value:Number(r.value),readBytes:r.readBytes}}const A=Qe(t.subarray(0,e));return{value:Number(A.value),readBytes:A.readBytes}},encodedSize:()=>e}),Ue=Fe(1),Te=Fe(2),Ge=Fe(4),je=(e,t)=>(A,r)=>{pe(Oe(e))(A,r),le(_e(),t)(A,r)},He=(e,t)=>(A,r)=>{pe(Fe(e))(A,r),le({fromJSON:e=>e,toJSON:e=>e},t)(A,r)},Le=e=>(t,A)=>{pe(ae(Ue,e=>1===e,e=>e?1:0))(t,A),le({fromJSON:e=>e,toJSON:e=>e},e)(t,A)},Ye={encode:(e,A)=>{if(t.ok(e>=0,"value must be positive"),0n==e)return A[0]=0,1;if(e<2**56){let t=0;for(let A=1;A<8&&e>=2n**(7n*BigInt(A));A++)t=A;const r=BigInt(t);A[0]=Number(256n-2n**(8n-r)+e/2n**(8n*r));return Oe(t).encode(e%2n**(8n*r),A.subarray(1,t+1))+1}return t.ok(e<2n**64n,"value is too large"),A[0]=255,Re.encode(e,A.subarray(1,9)),9},decode:e=>{const t=e[0];if(0==t)return{value:0n,readBytes:1};if(t<255){let A=0;for(let e=0;e<8&&t>=256-2**(8-e);e++)A=e;const r=t-(256-2**(8-A));return{value:Oe(A).decode(e.subarray(1,A+1)).value+2n**(8n*BigInt(A))*BigInt(r),readBytes:A+1}}return{value:Re.decode(e.subarray(1,9)).value,readBytes:9}},encodedSize:e=>{if(t.ok(e>=0,"value must be positive"),e<2**56){let t=0;for(let A=1;A<9&&e>=2n**(7n*BigInt(A));A++)t=A;return 1+t}return 9}},Ke=()=>ae(Ye,e=>e,e=>e),Je=()=>ae(Ye,e=>Number(e),e=>BigInt(e)),Pe=e=>(t,A)=>{pe(Ke())(t,A),le(_e(),e)(t,A)},Ve=e=>(t,A)=>{pe(Je())(t,A),le({fromJSON:e=>e,toJSON:e=>e},e)(t,A)},Xe=e=>({encode:function(e,A){const r=this.encodedSize(e);t.ok(A.length>=r,"bytes not long enough");for(let t=0;t<r;t++){let r=0;for(let A=0;A<8;A++){r|=e[8*t+A]<<A}A[t]=r}return r},decode:function(t){const A=Math.ceil(e/8),r=[];for(let e=0;e<A;e++){const A=t[e];for(let e=0;e<8;e++)r.push(A>>e&1)}return{value:r.slice(0,e),readBytes:A}},encodedSize:function(e){return Math.ceil(e.length/8)}});class ze{constructor(e){this.codec=e}encode(e,t){return null==e?t[0]=0:(t[0]=1,this.codec.encode(e,t.subarray(1))),this.encodedSize(e)}decode(e){if(0===e[0])return{value:void 0,readBytes:1};{const t=this.codec.decode(e.subarray(1));return{value:t.value,readBytes:t.readBytes+1}}}encodedSize(e){return null==e?1:this.codec.encodedSize(e)+1}}const qe=(e,t)=>function(A,r){pe(new ze(e))(A,r),le(De(e),t)(A,r)},We={decode:e=>({value:e,readBytes:e.length}),encode:(e,t)=>(t.set(e),e.length),encodedSize:e=>e.length},Ze=e=>({decode:t=>({value:t.subarray(0,e),readBytes:e}),encode:(e,t)=>(t.set(e),e.length),encodedSize:()=>e}),$e=e=>({...Ze(e),...we()});class et{constructor(e){this.subCodec=e}encode(e,t){const A=(this.subCodec.length??this.subCodec.encodedSize).call(this.subCodec,e),r=BigInt(A),n=Ye.encodedSize(r);Ye.encode(r,t.subarray(0,n));return n+this.subCodec.encode(e,t.subarray(n))}decode(e){const t=Ye.decode(e),A=this.subCodec.decode(e.subarray(t.readBytes),Number(t.value));return{value:A.value,readBytes:t.readBytes+A.readBytes}}encodedSize(e){return this.subCodec.encodedSize(e)+Ye.encodedSize(BigInt((this.subCodec.length??this.subCodec.encodedSize).call(this.subCodec,e)))}}const tt=new et({...We,decode:(e,t)=>We.decode(e.subarray(0,t))}),At={encode:tt.encode.bind(tt),decode:tt.decode.bind(tt),encodedSize:tt.encodedSize.bind(tt),...we()},rt=e=>new et({encode:(t,A)=>t.reduce((t,r)=>t+e.encode(r,A.subarray(t)),0),decode:(t,A)=>{const r=[];let n=0;for(let s=0;s<A;s++){const A=e.decode(t.subarray(n));r.push(A.value),n+=A.readBytes}return{value:r,readBytes:n}},length:e=>e.length,encodedSize:t=>t.reduce((t,A)=>t+e.encodedSize(A),0)}),nt=(e,t)=>(A,r)=>{pe(rt(e))(A,r),le(be(e),t)(A,r)},st=(e,A)=>({encode(r,n){t(r.length===e,`Invalid array length ${r.length} - ${e}`);let s=0;for(let t=0;t<e;t++)s+=A.encode(r[t],n.subarray(s));return s},decode(t){const r=[];let n=0;for(let s=0;s<e;s++){const e=A.decode(t.subarray(n));r.push(e.value),n+=e.readBytes}return{value:r,readBytes:n}},encodedSize:e=>e.reduce((e,t)=>e+A.encodedSize(t),0)}),ot=(e,t,A)=>function(r,n){pe(st(e,t))(r,n),le(be(t),A)(r,n)};function it(e,t,A){const r=new et(new at(e,t,A));return{encode:r.encode.bind(r),decode:r.decode.bind(r),encodedSize:r.encodedSize.bind(r)}}class at{constructor(e,t,A){this.keyCodec=e,this.valueCodec=t,this.keySorter=A}encode(e,t){let A=0;const r=[...e.keys()].sort(this.keySorter);for(const n of r)A+=this.keyCodec.encode(n,t.subarray(A)),A+=this.valueCodec.encode(e.get(n),t.subarray(A));return A}length(e){return e.size}decode(e,t){const A=[],r=[];let n=0;for(;A.length<t;){const t=this.keyCodec.decode(e.subarray(n));n+=t.readBytes;const s=this.valueCodec.decode(e.subarray(n));n+=s.readBytes,A.push(t.value),r.push(s.value)}return{value:new Map(A.map((e,t)=>[e,r[t]])),readBytes:n}}encodedSize(e){return[...e.keys()].reduce((t,A)=>{const r=this.valueCodec;return t+this.keyCodec.encodedSize(A)+r.encodedSize(e.get(A))},0)}}const gt=e=>({encode(t,A){for(let r=0;r<e.length;r++){const[n,s]=e[r];if(void 0!==t[n])return A[0]=r,1+s.encode(t[n],A.subarray(1))}throw new Error("No codec for value")},decode(t){const A=t[0],[r,n]=e[A],{value:s,readBytes:o}=n.decode(t.subarray(1));return{value:{[r]:s},readBytes:1+o}},encodedSize(t){for(let A=0;A<e.length;A++){const[r,n]=e[A];if(void 0!==t[r])return 1+n.encodedSize(t[r])}throw new Error("No codec for value")}}),ct=e=>Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join(""),ut={arrayToBigEndian:e=>0===e.length?0n:BigInt("0x"+ct(e)),arrayToLittleEndian:e=>0===e.length?0n:BigInt("0x"+ct(new Uint8Array(e).reverse())),bigEndianToNewArray(e,t){const A=new Uint8Array(t);return ut.bigEndianToArray(e,A),A},bigEndianToArray(e,t){const A=e.toString(16).padStart(2*t.length,"0");t.set(A.match(/.{2}/g).map(e=>parseInt(e,16)))},littleEndianToNewArray(e,t){const A=new Uint8Array(t);return ut.littleEndianToArray(e,A),A},littleEndianToArray(e,t){ut.bigEndianToArray(e,t),t.reverse()}},It=Object.prototype.toString;function dt(e){return function(e,t,A){return!!e&&(e.constructor===t||It.call(e)===A)}(e,Uint8Array,"[object Uint8Array]")}function pt(e){if(!dt(e))throw new TypeError(`Expected \`Uint8Array\`, got \`${typeof e}\``)}function lt(e,t){pt(e),pt(t);const A=Math.min(e.length,t.length);for(let r=0;r<A;r++){const A=e[r]-t[r];if(0!==A)return Math.sign(A)}return Math.sign(e.length-t.length)}function yt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function ht(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var A=function e(){var A=!1;try{A=this instanceof e}catch{}return A?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};A.prototype=t.prototype}else A={};return Object.defineProperty(A,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(A,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}),A}new globalThis.TextDecoder("utf8"),new globalThis.TextEncoder,Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));var Ct={};const Et={withStackTrace:!1},mt=(e,t,A=Et)=>({data:t.isOk()?{type:"Ok",value:t.value}:{type:"Err",value:t.error},message:e,stack:A.withStackTrace?(new Error).stack:void 0});function Bt(e,t,A,r){return new(A||(A=Promise))(function(t,n){function s(e){try{i(r.next(e))}catch(e){n(e)}}function o(e){try{i(r.throw(e))}catch(e){n(e)}}function i(e){var r;e.done?t(e.value):(r=e.value,r instanceof A?r:new A(function(e){e(r)})).then(s,o)}i((r=r.apply(e,[])).next())})}function Qt(e){var t="function"==typeof Symbol&&Symbol.iterator,A=t&&e[t],r=0;if(A)return A.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ft(e){return this instanceof ft?(this.v=e,this):new ft(e)}function _t(e,t,A){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,n=A.apply(e,t||[]),s=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",function(e){return function(t){return Promise.resolve(t).then(e,g)}}),r[Symbol.asyncIterator]=function(){return this},r;function o(e,t){n[e]&&(r[e]=function(t){return new Promise(function(A,r){s.push([e,t,A,r])>1||i(e,t)})},t&&(r[e]=t(r[e])))}function i(e,t){try{(A=n[e](t)).value instanceof ft?Promise.resolve(A.value.v).then(a,g):c(s[0][2],A)}catch(e){c(s[0][3],e)}var A}function a(e){i("next",e)}function g(e){i("throw",e)}function c(e,t){e(t),s.shift(),s.length&&i(s[0][0],s[0][1])}}function wt(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,A=e[Symbol.asyncIterator];return A?A.call(e):(e=Qt(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(A){t[A]=e[A]&&function(t){return new Promise(function(r,n){(function(e,t,A,r){Promise.resolve(r).then(function(t){e({value:t,done:A})},t)})(r,n,(t=e[A](t)).done,t.value)})}}}"function"==typeof SuppressedError&&SuppressedError;class vt{constructor(e){this._promise=e}static fromSafePromise(e){const t=e.then(e=>new Tt(e));return new vt(t)}static fromPromise(e,t){const A=e.then(e=>new Tt(e)).catch(e=>new Gt(t(e)));return new vt(A)}static fromThrowable(e,t){return(...A)=>new vt((()=>Bt(this,0,void 0,function*(){try{return new Tt(yield e(...A))}catch(e){return new Gt(t?t(e):e)}}))())}static combine(e){return kt(e)}static combineWithAllErrors(e){return xt(e)}map(e){return new vt(this._promise.then(t=>Bt(this,0,void 0,function*(){return t.isErr()?new Gt(t.error):new Tt(yield e(t.value))})))}andThrough(e){return new vt(this._promise.then(t=>Bt(this,0,void 0,function*(){if(t.isErr())return new Gt(t.error);const A=yield e(t.value);return A.isErr()?new Gt(A.error):new Tt(t.value)})))}andTee(e){return new vt(this._promise.then(t=>Bt(this,0,void 0,function*(){if(t.isErr())return new Gt(t.error);try{yield e(t.value)}catch(e){}return new Tt(t.value)})))}orTee(e){return new vt(this._promise.then(t=>Bt(this,0,void 0,function*(){if(t.isOk())return new Tt(t.value);try{yield e(t.error)}catch(e){}return new Gt(t.error)})))}mapErr(e){return new vt(this._promise.then(t=>Bt(this,0,void 0,function*(){return t.isOk()?new Tt(t.value):new Gt(yield e(t.error))})))}andThen(e){return new vt(this._promise.then(t=>{if(t.isErr())return new Gt(t.error);const A=e(t.value);return A instanceof vt?A._promise:A}))}orElse(e){return new vt(this._promise.then(t=>Bt(this,0,void 0,function*(){return t.isErr()?e(t.error):new Tt(t.value)})))}match(e,t){return this._promise.then(A=>A.match(e,t))}unwrapOr(e){return this._promise.then(t=>t.unwrapOr(e))}safeUnwrap(){return _t(this,arguments,function*(){return yield ft(yield ft(yield*function(e){var t,A;return t={},r("next"),r("throw",function(e){throw e}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,n){t[r]=e[r]?function(t){return(A=!A)?{value:ft(e[r](t)),done:!1}:n?n(t):t}:n}}(wt(yield ft(this._promise.then(e=>e.safeUnwrap()))))))})}then(e,t){return this._promise.then(e,t)}[Symbol.asyncIterator](){return _t(this,arguments,function*(){const e=yield ft(this._promise);return e.isErr()&&(yield yield ft(bt(e.error))),yield ft(e.value)})}}function bt(e){return new vt(Promise.resolve(new Gt(e)))}const St=vt.fromPromise,Dt=vt.fromSafePromise,Nt=vt.fromThrowable,Ot=e=>{let t=Ft([]);for(const A of e){if(A.isErr()){t=Ut(A.error);break}t.map(e=>e.push(A.value))}return t},kt=e=>vt.fromSafePromise(Promise.all(e)).andThen(Ot),Mt=e=>{let t=Ft([]);for(const A of e)A.isErr()&&t.isErr()?t.error.push(A.error):A.isErr()&&t.isOk()?t=Ut([A.error]):A.isOk()&&t.isOk()&&t.value.push(A.value);return t},xt=e=>vt.fromSafePromise(Promise.all(e)).andThen(Mt);var Rt;function Ft(e){return new Tt(e)}function Ut(e){return new Gt(e)}!function(e){e.fromThrowable=function(e,t){return(...A)=>{try{return Ft(e(...A))}catch(e){return Ut(t?t(e):e)}}},e.combine=function(e){return Ot(e)},e.combineWithAllErrors=function(e){return Mt(e)}}(Rt||(Rt={}));class Tt{constructor(e){this.value=e}isOk(){return!0}isErr(){return!this.isOk()}map(e){return Ft(e(this.value))}mapErr(e){return Ft(this.value)}andThen(e){return e(this.value)}andThrough(e){return e(this.value).map(e=>this.value)}andTee(e){try{e(this.value)}catch(e){}return Ft(this.value)}orTee(e){return Ft(this.value)}orElse(e){return Ft(this.value)}asyncAndThen(e){return e(this.value)}asyncAndThrough(e){return e(this.value).map(()=>this.value)}asyncMap(e){return vt.fromSafePromise(e(this.value))}unwrapOr(e){return this.value}match(e,t){return e(this.value)}safeUnwrap(){const e=this.value;return function*(){return e}()}_unsafeUnwrap(e){return this.value}_unsafeUnwrapErr(e){throw mt("Called `_unsafeUnwrapErr` on an Ok",this,e)}*[Symbol.iterator](){return this.value}}class Gt{constructor(e){this.error=e}isOk(){return!1}isErr(){return!this.isOk()}map(e){return Ut(this.error)}mapErr(e){return Ut(e(this.error))}andThrough(e){return Ut(this.error)}andTee(e){return Ut(this.error)}orTee(e){try{e(this.error)}catch(e){}return Ut(this.error)}andThen(e){return Ut(this.error)}orElse(e){return e(this.error)}asyncAndThen(e){return bt(this.error)}asyncAndThrough(e){return bt(this.error)}asyncMap(e){return bt(this.error)}unwrapOr(e){return e}match(e,t){return t(this.error)}safeUnwrap(){const e=this.error;return function*(){throw yield Ut(e),new Error("Do not use this generator out of `safeTry`")}()}_unsafeUnwrap(e){throw mt("Called `_unsafeUnwrap` on an Err",this,e)}_unsafeUnwrapErr(e){return this.error}*[Symbol.iterator](){return yield this,this}}const jt=Rt.fromThrowable;var Ht,Lt=ht(Object.freeze({__proto__:null,Err:Gt,Ok:Tt,get Result(){return Rt},ResultAsync:vt,err:Ut,errAsync:bt,fromAsyncThrowable:Nt,fromPromise:St,fromSafePromise:Dt,fromThrowable:jt,ok:Ft,okAsync:function(e){return new vt(Promise.resolve(new Tt(e)))},safeTry:function(e){const t=e().next();return t instanceof Promise?new vt(t.then(e=>e.value)):t.value}}));!function(){if(Ht)return Ct;Ht=1,Object.defineProperty(Ct,"__esModule",{value:!0});const e=Lt;e.Ok.prototype.safeRet=function(){return[void 0,this.value]},e.Err.prototype.safeRet=function(){return[this.error,void 0]}}();const Yt=e=>e,Kt=e=>e;var Jt,Pt,Vt,Xt;!function(e){e[e.OutOfGas=1]="OutOfGas",e[e.Panic=2]="Panic",e[e.BadExports=3]="BadExports",e[e.Oversize=4]="Oversize",e[e.Bad=5]="Bad",e[e.Big=6]="Big"}(Jt||(Jt={})),function(e){e[e.Halt=0]="Halt",e[e.Panic=1]="Panic",e[e.OutOfGas=2]="OutOfGas"}(Pt||(Pt={})),function(e){e[e.HostCall=3]="HostCall",e[e.PageFault=4]="PageFault"}(Vt||(Vt={})),function(e){e.Read="read",e.Write="write",e.Null="null"}(Xt||(Xt={}));var zt,qt,Wt,Zt,$t,eA,tA,AA={exports:{}};function rA(){if(Zt)return Wt;function e(e){return Buffer.isBuffer(e)?e:Buffer.from(e.buffer,e.byteOffset,e.byteLength)}return Zt=1,Wt={isBuffer:function(e){return Buffer.isBuffer(e)||e instanceof Uint8Array},isEncoding:function(e){return Buffer.isEncoding(e)},alloc:function(e,t,A){return Buffer.alloc(e,t,A)},allocUnsafe:function(e){return Buffer.allocUnsafe(e)},allocUnsafeSlow:function(e){return Buffer.allocUnsafeSlow(e)},byteLength:function(e,t){return Buffer.byteLength(e,t)},compare:function(e,t){return Buffer.compare(e,t)},concat:function(e,t){return Buffer.concat(e,t)},copy:function(t,A,r,n,s){return e(t).copy(A,r,n,s)},equals:function(t,A){return e(t).equals(A)},fill:function(t,A,r,n,s){return e(t).fill(A,r,n,s)},from:function(e,t,A){return Buffer.from(e,t,A)},includes:function(t,A,r,n){return e(t).includes(A,r,n)},indexOf:function(t,A,r,n){return e(t).indexOf(A,r,n)},lastIndexOf:function(t,A,r,n){return e(t).lastIndexOf(A,r,n)},swap16:function(t){return e(t).swap16()},swap32:function(t){return e(t).swap32()},swap64:function(t){return e(t).swap64()},toBuffer:e,toString:function(t,A,r,n){return e(t).toString(A,r,n)},write:function(t,A,r,n,s){return e(t).write(A,r,n,s)},writeDoubleLE:function(t,A,r){return e(t).writeDoubleLE(A,r)},writeFloatLE:function(t,A,r){return e(t).writeFloatLE(A,r)},writeUInt32LE:function(t,A,r){return e(t).writeUInt32LE(A,r)},writeInt32LE:function(t,A,r){return e(t).writeInt32LE(A,r)},readDoubleLE:function(t,A){return e(t).readDoubleLE(A)},readFloatLE:function(t,A){return e(t).readFloatLE(A)},readUInt32LE:function(t,A){return e(t).readUInt32LE(A)},readInt32LE:function(t,A){return e(t).readInt32LE(A)}},Wt}var nA=function(){if(tA)return AA.exports;tA=1;var e=function(){if(qt)return zt;qt=1,zt=function t(A,r){if(!A){var n=new e(r);throw Error.captureStackTrace&&Error.captureStackTrace(n,t),n}};class e extends Error{}return e.prototype.name="AssertionError",zt}(),t=rA(),A=null,r="undefined"!=typeof WebAssembly&&function(){if(eA)return $t;eA=1;var e,t,A=(()=>{for(var e=new Uint8Array(128),t=0;t<64;t++)e[t<26?t+65:t<52?t+71:t<62?t-4:4*t-205]=t;return t=>{for(var A=t.length,r=new Uint8Array(3*(A-("="==t[A-1])-("="==t[A-2]))/4|0),n=0,s=0;n<A;){var o=e[t.charCodeAt(n++)],i=e[t.charCodeAt(n++)],a=e[t.charCodeAt(n++)],g=e[t.charCodeAt(n++)];r[s++]=o<<2|i>>4,r[s++]=i<<4|a>>2,r[s++]=a<<6|g}return r}})(),r=(e={"wasm-binary:./blake2b.wat"(e,t){t.exports=A("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")}},function(){return t||(0,e[Object.keys(e)[0]])((t={exports:{}}).exports,t),t.exports})(),n=WebAssembly.compile(r);return $t=async e=>(await WebAssembly.instantiate(await n,e)).exports}()().then(e=>{A=e}),n=64,s=[];AA.exports=I;var o=AA.exports.BYTES_MIN=16,i=AA.exports.BYTES_MAX=64;AA.exports.BYTES=32;var a=AA.exports.KEYBYTES_MIN=16,g=AA.exports.KEYBYTES_MAX=64;AA.exports.KEYBYTES=32;var c=AA.exports.SALTBYTES=16,u=AA.exports.PERSONALBYTES=16;function I(t,r,d,p,l){if(!(this instanceof I))return new I(t,r,d,p,l);if(!A)throw new Error("WASM not loaded. Wait for Blake2b.ready(cb)");t||(t=32),!0!==l&&(e(t>=o,"digestLength must be at least "+o+", was given "+t),e(t<=i,"digestLength must be at most "+i+", was given "+t),null!=r&&(e(r instanceof Uint8Array,"key must be Uint8Array or Buffer"),e(r.length>=a,"key must be at least "+a+", was given "+r.length),e(r.length<=g,"key must be at least "+g+", was given "+r.length)),null!=d&&(e(d instanceof Uint8Array,"salt must be Uint8Array or Buffer"),e(d.length===c,"salt must be exactly "+c+", was given "+d.length)),null!=p&&(e(p instanceof Uint8Array,"personal must be Uint8Array or Buffer"),e(p.length===u,"personal must be exactly "+u+", was given "+p.length))),s.length||(s.push(n),n+=216),this.digestLength=t,this.finalized=!1,this.pointer=s.pop(),this._memory=new Uint8Array(A.memory.buffer),this._memory.fill(0,0,64),this._memory[0]=this.digestLength,this._memory[1]=r?r.length:0,this._memory[2]=1,this._memory[3]=1,d&&this._memory.set(d,32),p&&this._memory.set(p,48),this.pointer+216>this._memory.length&&this._realloc(this.pointer+216),A.blake2b_init(this.pointer,this.digestLength),r&&(this.update(r),this._memory.fill(0,n,n+r.length),this._memory[this.pointer+200]=128)}function d(){}return I.prototype._realloc=function(e){A.memory.grow(Math.max(0,Math.ceil(Math.abs(e-this._memory.length)/65536))),this._memory=new Uint8Array(A.memory.buffer)},I.prototype.update=function(t){return e(!1===this.finalized,"Hash instance finalized"),e(t instanceof Uint8Array,"input must be Uint8Array or Buffer"),n+t.length>this._memory.length&&this._realloc(n+t.length),this._memory.set(t,n),A.blake2b_update(this.pointer,n,n+t.length),this},I.prototype.digest=function(r){if(e(!1===this.finalized,"Hash instance finalized"),this.finalized=!0,s.push(this.pointer),A.blake2b_final(this.pointer),!r||"binary"===r)return this._memory.slice(this.pointer+128,this.pointer+128+this.digestLength);if("string"==typeof r)return t.toString(this._memory,r,this.pointer+128,this.pointer+128+this.digestLength);e(r instanceof Uint8Array&&r.length>=this.digestLength,"input must be Uint8Array or Buffer");for(var n=0;n<this.digestLength;n++)r[n]=this._memory[this.pointer+128+n];return r},I.prototype.final=I.prototype.digest,I.WASM=A,I.SUPPORTED="undefined"!=typeof WebAssembly,I.ready=function(e){return e||(e=d),r?r.then(()=>e(),e):e(new Error("WebAssembly not supported"))},I.prototype.ready=I.ready,I.prototype.getPartialHash=function(){return this._memory.slice(this.pointer,this.pointer+216)},I.prototype.setPartialHash=function(e){this._memory.set(e,this.pointer)},AA.exports}(),sA=yt(nA);const oA="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IAAgATYCACAAIAI2AgQgA0EgaiQADwsQMwALmQEBAX8CQAJAIAEEQCACQQBIDQECfyADKAIEBEACQCADKAIIIgRFBEAMAQsgAygCACAEIAEgAhA3DAILCyABIAJFDQAaQe2MwAAtAAAaIAIgARA5CyIDBEAgACACNgIIIAAgAzYCBCAAQQA2AgAPCyAAIAI2AgggACABNgIEDAILIABBADYCBAwBCyAAQQA2AgQLIABBATYCAAuSAQEDfyMAQeAFayIDJAAgA0EIaiABIAIQMCADKAIMIQEgAygCCCECIANBIGoiBEHcAhBJGiADQeABOwH8AiAEIAIgARAGIANBgANqIgUgBEHgAhBKGiADQRRqIAUQKCABBEAgAiABED8LIAMgA0EUahA6IAMoAgQhASAAIAMoAgA2AgAgACABNgIEIANB4AVqJAALkgEBA38jAEHgBWsiAyQAIANBCGogASACEDAgAygCDCEBIAMoAgghAiADQSBqIgRB3AIQSRogA0HgATsB/AIgBCACIAEQBiADQYADaiIFIARB4AIQShogA0EQaiAFEB4gAQRAIAIgARA/CyADIANBEGoQOiADKAIEIQEgACADKAIANgIAIAAgATYCBCADQeAFaiQAC5IBAQN/IwBB4AVrIgMkACADQQhqIAEgAhAwIAMoAgwhASADKAIIIQIgA0EgaiIEQdwCEEkaIANBgAI7AfwCIAQgAiABEAYgA0GAA2oiBSAEQeACEEoaIANBFGogBRAoIAEEQCACIAEQPwsgAyADQRRqEDogAygCBCEBIAAgAygCADYCACAAIAE2AgQgA0HgBWokAAuSAQEDfyMAQeAFayIDJAAgA0EIaiABIAIQMCADKAIMIQEgAygCCCECIANBIGoiBEHcAhBJGiADQYACOwH8AiAEIAIgARAGIANBgANqIgUgBEHgAhBKGiADQRBqIAUQHiABBEAgAiABED8LIAMgA0EQahA6IAMoAgQhASAAIAMoAgA2AgAgACABNgIEIANB4AVqJAALkgEBA38jAEHgBWsiAyQAIANBCGogASACEDAgAygCDCEBIAMoAgghAiADQSBqIgRB3AIQSRogA0GAAzsB/AIgBCACIAEQBiADQYADaiIFIARB4AIQShogA0EUaiAFECggAQRAIAIgARA/CyADIANBFGoQOiADKAIEIQEgACADKAIANgIAIAAgATYCBCADQeAFaiQAC5IBAQN/IwBB4AVrIgMkACADQQhqIAEgAhAwIAMoAgwhASADKAIIIQIgA0EgaiIEQdwCEEkaIANBgAM7AfwCIAQgAiABEAYgA0GAA2oiBSAEQeACEEoaIANBEGogBRAeIAEEQCACIAEQPwsgAyADQRBqEDogAygCBCEBIAAgAygCADYCACAAIAE2AgQgA0HgBWokAAuSAQEDfyMAQeAFayIDJAAgA0EIaiABIAIQMCADKAIMIQEgAygCCCECIANBIGoiBEHcAhBJGiADQYAEOwH8AiAEIAIgARAGIANBgANqIgUgBEHgAhBKGiADQRRqIAUQKCABBEAgAiABED8LIAMgA0EUahA6IAMoAgQhASAAIAMoAgA2AgAgACABNgIEIANB4AVqJAALkgEBA38jAEHgBWsiAyQAIANBCGogASACEDAgAygCDCEBIAMoAgghAiADQSBqIgRB3AIQSRogA0GABDsB/AIgBCACIAEQBiADQYADaiIFIARB4AIQShogA0EQaiAFEB4gAQRAIAIgARA/CyADIANBEGoQOiADKAIEIQEgACADKAIANgIAIAAgATYCBCADQeAFaiQAC90BAQV/IAAoAtgCIgFByAEgAC8B3AJBAnZB/gFxIgRrIgVBeHEiA0kEQCABIABByAFqIgJqQQE6AAAgAiADakEBayIBIAEtAABBgAFyOgAAIAAgAiAFQQN2EAMgAkHAASAEa0F4cUEIahBJGiAAQQA2AtgCDwsjAEEwayIAJAAgACADNgIEIAAgATYCACAAQSxqQQE2AgAgAEECNgIMIABBpInAADYCCCAAQgI3AhQgAEEBNgIkIAAgAEEgajYCECAAIAA2AiggACAAQQRqNgIgIABBCGpBuILAABAxAAuKAQIDfwF+IwBBIGsiAiQAIAEoAgBBgICAgHhGBEAgASgCDCEDIAJBHGoiBEEANgIAIAJCgICAgBA3AhQgAkEUaiADEAUaIAJBEGogBCgCACIDNgIAIAIgAikCFCIFNwMIIAFBCGogAzYCACABIAU3AgALIABBlIfAADYCBCAAIAE2AgAgAkEgaiQAC3gBAn8jAEEgayICJAACQCABBEAgASgCACIDQX9GDQEgASADQQFqNgIAIAJBFGoiAyABQQhqQcgBECUgASABKAIAQQFrNgIAIAJBCGogAxA6IAIoAgwhASAAIAIoAgg2AgAgACABNgIEIAJBIGokAA8LEEUACxBGAAtjAQF/IwBBEGsiAyQAAkAgAARAIAAoAgANASAAQX82AgAgA0EIaiABIAIQMCAAQQhqIAMoAggiAiADKAIMIgEQBiABBEAgAiABED8LIABBADYCACADQRBqJAAPCxBFAAsQRgALZwECfyMAQSBrIgIkAAJAIAEEQCABKAIADQEgAUF/NgIAIAJBFGoiAyABQQhqECggAUEANgIAIAJBCGogAxA6IAIoAgwhASAAIAIoAgg2AgAgACABNgIEIAJBIGokAA8LEEUACxBGAAuWBgEJfyMAQRBrIggkACABEBkgCCABLwHcAkEDdjYCDCAIIAE2AggjAEEgayIHJAAgCEEIaiIDKAIAIQQgAygCBCEFIAdBBGoiAiIDQciCwAA2AgwgAyAENgIEIANBgIDEADYCACADIAQgBWo2AgggB0EcaiIJQQA2AgAgB0KAgICAEDcCFCMAQTBrIgMkACADQRBqIgUgAkEIaikCADcDACADIAIpAgA3AwggA0EYaiIEQQE2AgQgBCADQQhqIgIoAgggAigCBGtBAXQgAigCAEGAgMQAR3IiAjYCCCAEIAI2AgAgAygCGCICIAdBFGoiBCgCACAEKAIIIgZrSwRAIAQgBiACECkLIANBIGogBSkDADcDACADIAMpAwg3AxggA0EYahAiIgJBgIDEAEcEQANAAkACfwJAIAJBgAFPBEAgA0EANgIsIAJBgBBJDQEgAkGAgARJBEAgAyACQQx2QeABcjoALCADIAJBBnZBP3FBgAFyOgAtQQIhBUEDDAMLIAMgAkESdkHwAXI6ACwgAyACQQZ2QT9xQYABcjoALiADIAJBDHZBP3FBgAFyOgAtQQMhBUEEDAILIAQoAggiBiAEKAIARgR/IwBBEGsiBSQAIAVBCGogBCAGQQEQDQJAAkAgBSgCCCIGQYGAgIB4RwRAIAZFDQEgBiAFKAIMEEgACyAFQRBqJAAMAQsQMwALIAQoAggFIAYLIAQoAgRqIAI6AAAgBCAEKAIIQQFqNgIIDAILIAMgAkEGdkHAAXI6ACxBASEFQQILIQogBSADQSxqIgZyIAJBP3FBgAFyOgAAIAYgCmogBmsiAiAEKAIAIAQoAggiBWtLBH8gBCAFIAIQKSAEKAIIBSAFCyAEKAIEaiAGIAIQShogBCAEKAIIIAJqNgIICyADQRhqECIiAkGAgMQARw0ACwsgA0EwaiQAIABBCGogCSgCADYCACAAIAcpAhQ3AgAgB0EgaiQAIAFByAFqQcABIAEvAdwCQQJ2Qf4BcWtBeHFBCGoQSRogAUEANgLYAiABQcgBEEkaIAhBEGokAAucAgEDfyMAQeACayICJAAgAgJ/AkACQAJAAkACQAJAIAFB4AFrQRt3DgoBAgAAAAMAAAAEAAsgAkGAgMAAQSkQADYCBEEBDAULIAJB4AE7AQIMAwsgAkGAAjsBAgwCCyACQYADOwECDAELIAJBgAQ7AQILQQALOwEAAn8gAi8BACIERQRAIAIvAQIhAyACQdwCEEkiASADOwHcAiMAQfACayIDJAAgA0EQaiABQeACEEoaQe2MwAAtAAAaQegCQQgQOSIBRQRAQQhB6AIQSAALIAFBADYCACABQQRqIANBDGpB5AIQShogA0HwAmokACABIQNBAAwBCyACKAIECyEBIAAgBDYCCCAAIAE2AgQgACADNgIAIAJB4AJqJAALWQECfyMAQSBrIgIkAAJAIAEEQCABKAIADQEgAUF/NgIAIAJBEGoiAyABQQhqEB4gAUEANgIAIAJBCGogAxA6IAAgAikDCDcDACACQSBqJAAPCxBFAAsQRgALVAEBfyMAQfACayICJAACQCABBEAgASgCAA0BIAFBADYCACACQQhqIAFB6AIQShogACACQRBqQeACEEoaIAFB6AIQPyACQfACaiQADwsQRQALEEYAC2sBAn8gACgCACEBIABBgIDEADYCAAJAIAFBgIDEAEcNAEGAgMQAIQEgACgCBCICIAAoAghGDQAgACACQQFqNgIEIAAgACgCDCIAIAItAAAiAUEPcWotAAA2AgAgACABQQR2ai0AACEBCyABC2QAIwBBMGsiACQAQeyMwAAtAAAEQCAAQQI2AhAgAEGwhsAANgIMIABCATcCGCAAQQE2AiggACABNgIsIAAgAEEkajYCFCAAIABBLGo2AiQgAEEMakHYhsAAEDEACyAAQTBqJAALUgACQCAABEAgACgCAA0BIABB0AFqQcABIAAvAeQCQQJ2Qf4BcWtBeHFBCGoQSRogAEEANgLgAiAAQQhqQcgBEEkaIABBADYCAA8LEEUACxBGAAteAQF/AkACQAJAIAJFBEBBASEDDAELIAJBAEgNAUHtjMAALQAAGiACQQEQOSIDRQ0CCyADIAEgAhBKIQEgACACNgIIIAAgATYCBCAAIAI2AgAPCxAzAAtBASACEEgAC4UCAQd/IwBBEGsiAyQAAkACQCAAKAIIIgIgACgCAE8NACADQQhqIQUjAEEgayIBJAACQCACIAAoAgAiBE0EQAJ/QYGAgIB4IARFDQAaIAAoAgQhBgJAIAJFBEBBASEHIAYgBBA/DAELQQEgBiAEQQEgAhA3IgdFDQEaCyAAIAI2AgAgACAHNgIEQYGAgIB4CyEAIAUgAjYCBCAFIAA2AgAgAUEgaiQADAELIAFBATYCDCABQfyCwAA2AgggAUIANwIUIAFB2ILAADYCECABQQhqQdCDwAAQMQALIAMoAggiAEGBgICAeEYNACAARQ0BIAAgAygCDBBIAAsgA0EQaiQADwsQMwALTgECfyMAQYADayICJAAgAkEQaiIDIAEQISACQfQCaiIBIAMQKCACQQhqIAEQOiACKAIMIQEgACACKAIINgIAIAAgATYCBCACQYADaiQAC0UAIAEQGSAAIAEgAS8B3AJBA3YQJSABQcgBakHAASABLwHcAkECdkH+AXFrQXhxQQhqEEkaIAFBADYC2AIgAUHIARBJGgtIAQF/IwBBEGsiAyQAIANBCGogACABIAIQDQJAIAMoAggiAEGBgICAeEcEQCAARQ0BIAAgAygCDBBIAAsgA0EQaiQADwsQMwALQAECfyMAQYADayICJAAgAkEQaiIDIAEQISACQfACaiIBIAMQHiACQQhqIAEQOiAAIAIpAwg3AwAgAkGAA2okAAtBAQF/IAIgACgCACAAKAIIIgNrSwRAIAAgAyACEA8gACgCCCEDCyAAKAIEIANqIAEgAhBKGiAAIAIgA2o2AghBAAtNAQJ/Qe2MwAAtAAAaIAEoAgQhAiABKAIAIQNBCEEEEDkiAUUEQEEEQQgQSAALIAEgAjYCBCABIAM2AgAgAEGkh8AANgIEIAAgATYCAAs3AAJAIAFpQQFHQYCAgIB4IAFrIABJcg0AIAAEQEHtjMAALQAAGiAAIAEQOSIBRQ0BCyABDwsAC0QBAX8jAEEgayIDJAAgA0EBNgIEIANCADcCDCADQbSIwAA2AgggAyABNgIcIAMgADYCGCADIANBGGo2AgAgAyACEDEACzkAAkACfyACQYCAxABHBEBBASAAIAIgASgCEBECAA0BGgsgAw0BQQALDwsgACADQQAgASgCDBEDAAs6AQF/IwBBEGsiAyQAIAMgAjYCDCADIAE2AgggAyACNgIEIANBBGoQJiAAIAMpAgg3AwAgA0EQaiQAC7YCAQJ/IwBBIGsiAiQAIAJBATsBHCACIAE2AhggAiAANgIUIAJB4IjAADYCECACQbSIwAA2AgwjAEEQayIBJAAgAkEMaiIAKAIIIgJFBEBBtYjAAEErQYSHwAAQLgALIAEgACgCDDYCDCABIAA2AgggASACNgIEIwBBEGsiACQAIAFBBGoiASgCACICKAIMIQMCQAJAAkACQCACKAIEDgIAAQILIAMNAUHMhMAAIQJBACEDDAILIAMNACACKAIAIgIoAgQhAyACKAIAIQIMAQsgACACNgIMIABBgICAgHg2AgAgAEHIh8AAIAEoAgQiACgCCCABKAIIIAAtABAgAC0AERAOAAsgACADNgIEIAAgAjYCACAAQbSHwAAgASgCBCIAKAIIIAEoAgggAC0AECAALQAREA4ACy0AAkAgA2lBAUdBgICAgHggA2sgAUlyRQRAIAAgASADIAIQNyIADQELAAsgAAs8AQF/IwBBIGsiACQAIABBATYCDCAAQYCIwAA2AgggAEIANwIUIABB7IfAADYCECAAQQhqQaSIwAAQMQALJQEBfyAAKAIAIgFBgICAgHhyQYCAgIB4RwRAIAAoAgQgARA/CwscAQF/IwBB4AJrIgEkACABIAAQISABQeACaiQACxcBAX8gACgCACIBBEAgACgCBCABED8LC9YGAQZ/An8CQAJAAkACQAJAIABBBGsiBSgCACIGQXhxIgRBBEEIIAZBA3EiBxsgAWpPBEAgB0EAIAFBJ2oiCSAESRsNAQJAAkAgAkEJTwRAIAIgAxAIIggNAUEADAkLIANBzP97Sw0BQRAgA0ELakF4cSADQQtJGyEBAkAgB0UEQCABQYACSSAEIAFBBHJJciAEIAFrQYGACE9yDQEMCQsgAEEIayICIARqIQcCQAJAAkACQCABIARLBEAgB0HQkMAAKAIARg0EIAdBzJDAACgCAEYNAiAHKAIEIgZBAnENBSAGQXhxIgYgBGoiBCABSQ0FIAcgBhAJIAQgAWsiA0EQSQ0BIAUgASAFKAIAQQFxckECcjYCACABIAJqIgEgA0EDcjYCBCACIARqIgIgAigCBEEBcjYCBCABIAMQBwwNCyAEIAFrIgNBD0sNAgwMCyAFIAQgBSgCAEEBcXJBAnI2AgAgAiAEaiIBIAEoAgRBAXI2AgQMCwtBxJDAACgCACAEaiIEIAFJDQICQCAEIAFrIgNBD00EQCAFIAZBAXEgBHJBAnI2AgAgAiAEaiIBIAEoAgRBAXI2AgRBACEDQQAhAQwBCyAFIAEgBkEBcXJBAnI2AgAgASACaiIBIANBAXI2AgQgAiAEaiICIAM2AgAgAiACKAIEQX5xNgIEC0HMkMAAIAE2AgBBxJDAACADNgIADAoLIAUgASAGQQFxckECcjYCACABIAJqIgEgA0EDcjYCBCAHIAcoAgRBAXI2AgQgASADEAcMCQtByJDAACgCACAEaiIEIAFLDQcLIAMQAiIBRQ0BIAEgAEF8QXggBSgCACIBQQNxGyABQXhxaiIBIAMgASADSRsQSiAAEAQMCAsgCCAAIAEgAyABIANJGxBKGiAFKAIAIgJBeHEiAyABQQRBCCACQQNxIgIbakkNAyACQQAgAyAJSxsNBCAAEAQLIAgMBgtBjYXAAEEuQbyFwAAQLgALQcyFwABBLkH8hcAAEC4AC0GNhcAAQS5BvIXAABAuAAtBzIXAAEEuQfyFwAAQLgALIAUgASAGQQFxckECcjYCACABIAJqIgIgBCABayIBQQFyNgIEQciQwAAgATYCAEHQkMAAIAI2AgAgAAwBCyAACwsNACABBEAgACABED8LCxkAAn8gAUEJTwRAIAEgABAIDAELIAAQAgsLEAAgARAmIAAgASkCBDcDAAsgACAAQo3TgKfU26LGPDcDCCAAQtWexOPcg8GJezcDAAsiACAAQuKrzsDB0cGUqX83AwggAEKK9KeVra/7nu4ANwMACyAAIABCwff56MyTstFBNwMIIABC5N7HhZDQhd59NwMACxMAIABBpIfAADYCBCAAIAE2AgALXwECfwJAAkAgAEEEaygCACICQXhxIgNBBEEIIAJBA3EiAhsgAWpPBEAgAkEAIAMgAUEnaksbDQEgABAEDAILQY2FwABBLkG8hcAAEC4AC0HMhcAAQS5B/IXAABAuAAsLDgAgACgCABoDQAwACwALaQEBfyMAQTBrIgMkACADIAE2AgQgAyAANgIAIANBLGpBATYCACADQQI2AgwgA0HQi8AANgIIIANCAjcCFCADQQE2AiQgAyADQSBqNgIQIAMgA0EEajYCKCADIAM2AiAgA0EIaiACEDEAC68GAgt/An4gADUCACENIwBBMGsiBSQAQSchAgJAIA1CkM4AVARAIA0hDgwBCwNAIAVBCWogAmoiBEEEayANIA1CkM4AgCIOQpDOAH59pyIDQf//A3FB5ABuIgBBAXRBtInAAGovAAA7AAAgBEECayADIABB5ABsa0H//wNxQQF0QbSJwABqLwAAOwAAIAJBBGshAiANQv/B1y9WIA4hDQ0ACwsgDqciA0HjAEsEQCACQQJrIgIgBUEJamogDqciACAAQf//A3FB5ABuIgNB5ABsa0H//wNxQQF0QbSJwABqLwAAOwAACwJAIANBCk8EQCACQQJrIgIgBUEJamogA0EBdEG0icAAai8AADsAAAwBCyACQQFrIgIgBUEJamogA0EwcjoAAAsCfyAFQQlqIAJqIQhBK0GAgMQAIAEoAhwiA0EBcSIAGyEGIABBJyACayIJaiEKQbSIwABBACADQQRxGyEHAkACQCABKAIARQRAQQEhACABKAIUIgIgASgCGCIDIAYgBxAvDQEMAgsgCiABKAIEIgtPBEBBASEAIAEoAhQiAiABKAIYIgMgBiAHEC8NAQwCCyADQQhxBEAgASgCECEDIAFBMDYCECABLQAgIQJBASEAIAFBAToAICABKAIUIgwgASgCGCIEIAYgBxAvDQEgCyAKa0EBaiEAAkADQCAAQQFrIgBFDQEgDEEwIAQoAhARAgBFDQALQQEMBAtBASEAIAwgCCAJIAQoAgwRAwANASABIAI6ACAgASADNgIQQQAhAAwBCyALIAprIQICQAJAAkAgAS0AICIAQQFrDgMAAQACCyACIQBBACECDAELIAJBAXYhACACQQFqQQF2IQILIABBAWohACABKAIQIQMgASgCGCEEIAEoAhQhAQJAA0AgAEEBayIARQ0BIAEgAyAEKAIQEQIARQ0AC0EBDAMLQQEhACABIAQgBiAHEC8NACABIAggCSAEKAIMEQMADQBBACEAA0BBACAAIAJGDQMaIABBAWohACABIAMgBCgCEBECAEUNAAsgAEEBayACSQwCCyAADAELIAIgCCAJIAMoAgwRAwALIAVBMGokAAsLACAAIwBqJAAjAAsJACAAIAEQAQALDABB4IPAAEEbEEQACw0AQfuDwABBzwAQRAALCAAgACABEAULGQAgACABQZCNwAAoAgAiAEECIAAbEQAAAAufAQEDfwJAIAEiAkEQSQRAIAAhAQwBCyAAQQAgAGtBA3EiBGohAyAEBEAgACEBA0AgAUEAOgAAIAFBAWoiASADSQ0ACwsgAyACIARrIgJBfHEiBGohASAEQQBKBEADQCADQQA2AgAgA0EEaiIDIAFJDQALCyACQQNxIQILIAIEQCABIAJqIQIDQCABQQA6AAAgAUEBaiIBIAJJDQALCyAAC7gCAQd/AkAgAiIEQRBJBEAgACECDAELIABBACAAa0EDcSIDaiEFIAMEQCAAIQIgASEGA0AgAiAGLQAAOgAAIAZBAWohBiACQQFqIgIgBUkNAAsLIAUgBCADayIIQXxxIgdqIQICQCABIANqIgNBA3EEQCAHQQBMDQEgA0EDdCIEQRhxIQkgA0F8cSIGQQRqIQFBACAEa0EYcSEEIAYoAgAhBgNAIAUgBiAJdiABKAIAIgYgBHRyNgIAIAFBBGohASAFQQRqIgUgAkkNAAsMAQsgB0EATA0AIAMhAQNAIAUgASgCADYCACABQQRqIQEgBUEEaiIFIAJJDQALCyAIQQNxIQQgAyAHaiEBCyAEBEAgAiAEaiEDA0AgAiABLQAAOgAAIAFBAWohASACQQFqIgIgA0kNAAsLIAALAwABCwvzDAEAQYCAwAAL6QxLZWNjYWtCaXRzIG11c3QgYmUgMjI0LCAyNTYsIDM4NCwgb3IgNTEyLnNyYy9saWIucnMAKQAQAAoAAAB4AAAAIwAAACkAEAAKAAAAdAAAACMAAAApABAACgAAAJkAAAA2AAAAKQAQAAoAAACPAAAAKAAAAAAAAAABAAAAAAAAAIKAAAAAAAAAioAAAAAAAIAAgACAAAAAgIuAAAAAAAAAAQAAgAAAAACBgACAAAAAgAmAAAAAAACAigAAAAAAAACIAAAAAAAAAAmAAIAAAAAACgAAgAAAAACLgACAAAAAAIsAAAAAAACAiYAAAAAAAIADgAAAAAAAgAKAAAAAAACAgAAAAAAAAIAKgAAAAAAAAAoAAIAAAACAgYAAgAAAAICAgAAAAAAAgAEAAIAAAAAACIAAgAAAAIApABAACgAAABMBAAAJAAAAMDEyMzQ1Njc4OWFiY2RlZlRyaWVkIHRvIHNocmluayB0byBhIGxhcmdlciBjYXBhY2l0eVgBEAAkAAAAL3J1c3RjLzliMDA5NTZlNTYwMDliYWIyYWExNWQ3YmZmMTA5MTY1OTllM2Q2ZDYvbGlicmFyeS9hbGxvYy9zcmMvcmF3X3ZlYy5yc4QBEABMAAAA5wEAAAkAAABudWxsIHBvaW50ZXIgcGFzc2VkIHRvIHJ1c3RyZWN1cnNpdmUgdXNlIG9mIGFuIG9iamVjdCBkZXRlY3RlZCB3aGljaCB3b3VsZCBsZWFkIHRvIHVuc2FmZSBhbGlhc2luZyBpbiBydXN0AAADAAAADAAAAAQAAAAEAAAABQAAAAYAAAAvcnVzdC9kZXBzL2RsbWFsbG9jLTAuMi42L3NyYy9kbG1hbGxvYy5yc2Fzc2VydGlvbiBmYWlsZWQ6IHBzaXplID49IHNpemUgKyBtaW5fb3ZlcmhlYWQAZAIQACkAAACoBAAACQAAAGFzc2VydGlvbiBmYWlsZWQ6IHBzaXplIDw9IHNpemUgKyBtYXhfb3ZlcmhlYWQAAGQCEAApAAAArgQAAA0AAABtZW1vcnkgYWxsb2NhdGlvbiBvZiAgYnl0ZXMgZmFpbGVkAAAMAxAAFQAAACEDEAANAAAAbGlicmFyeS9zdGQvc3JjL2FsbG9jLnJzQAMQABgAAABiAQAACQAAAGxpYnJhcnkvc3RkL3NyYy9wYW5pY2tpbmcucnNoAxAAHAAAAIQCAAAeAAAAAwAAAAwAAAAEAAAABwAAAAgAAAAIAAAABAAAAAkAAAAIAAAACAAAAAQAAAAKAAAACwAAAAwAAAAQAAAABAAAAA0AAAAOAAAADwAAAAAAAAABAAAAEAAAAGNhcGFjaXR5IG92ZXJmbG93AAAA7AMQABEAAABsaWJyYXJ5L2FsbG9jL3NyYy9yYXdfdmVjLnJzCAQQABwAAAAZAAAABQAAACljYWxsZWQgYE9wdGlvbjo6dW53cmFwKClgIG9uIGEgYE5vbmVgIHZhbHVlEgAAAAAAAAABAAAAEwAAAGluZGV4IG91dCBvZiBib3VuZHM6IHRoZSBsZW4gaXMgIGJ1dCB0aGUgaW5kZXggaXMgAABwBBAAIAAAAJAEEAASAAAAMDAwMTAyMDMwNDA1MDYwNzA4MDkxMDExMTIxMzE0MTUxNjE3MTgxOTIwMjEyMjIzMjQyNTI2MjcyODI5MzAzMTMyMzMzNDM1MzYzNzM4Mzk0MDQxNDI0MzQ0NDU0NjQ3NDg0OTUwNTE1MjUzNTQ1NTU2NTc1ODU5NjA2MTYyNjM2NDY1NjY2NzY4Njk3MDcxNzI3Mzc0NzU3Njc3Nzg3OTgwODE4MjgzODQ4NTg2ODc4ODg5OTA5MTkyOTM5NDk1OTY5Nzk4OTlyYW5nZSBzdGFydCBpbmRleCAgb3V0IG9mIHJhbmdlIGZvciBzbGljZSBvZiBsZW5ndGggfAUQABIAAACOBRAAIgAAAHJhbmdlIGVuZCBpbmRleCDABRAAEAAAAI4FEAAiAAAAc2xpY2UgaW5kZXggc3RhcnRzIGF0ICBidXQgZW5kcyBhdCAA4AUQABYAAAD2BRAADQAAAHNvdXJjZSBzbGljZSBsZW5ndGggKCkgZG9lcyBub3QgbWF0Y2ggZGVzdGluYXRpb24gc2xpY2UgbGVuZ3RoICgUBhAAFQAAACkGEAArAAAANAQQAAEAbwlwcm9kdWNlcnMCCGxhbmd1YWdlAQRSdXN0AAxwcm9jZXNzZWQtYnkDBXJ1c3RjHTEuNzguMCAoOWIwMDk1NmU1IDIwMjQtMDQtMjkpBndhbHJ1cwYwLjIwLjMMd2FzbS1iaW5kZ2VuBjAuMi45MgAsD3RhcmdldF9mZWF0dXJlcwIrD211dGFibGUtZ2xvYmFscysIc2lnbi1leHQ=",iA="undefined"!=typeof Buffer?Buffer.from(oA,"base64"):new Uint8Array([...atob(oA)].map(e=>e.charCodeAt(0)));var aA=Object.freeze({__proto__:null,WASM_BINARY:iA});let gA;const cA="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&cA.decode();let uA=null;function IA(){return null!==uA&&0!==uA.byteLength||(uA=new Uint8Array(gA.memory.buffer)),uA}function dA(e,t){return e>>>=0,cA.decode(IA().subarray(e,e+t))}const pA=new Array(128).fill(void 0);pA.push(void 0,null,!0,!1);let lA=pA.length;let yA=null;function hA(){return null!==yA&&0!==yA.byteLength||(yA=new Int32Array(gA.memory.buffer)),yA}let CA=0;const EA="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}};function mA(e){try{const o=gA.__wbindgen_add_to_stack_pointer(-16),i=function(e,t){const A=t(1*e.length,1)>>>0;return IA().set(e,A/1),CA=e.length,A}(e,gA.__wbindgen_malloc),a=CA;gA.keccak256(o,i,a);var t=hA()[o/4+0],A=hA()[o/4+1],r=(n=t,s=A,n>>>=0,IA().subarray(n/1,n/1+s)).slice();return gA.__wbindgen_free(t,1*A,1),r}finally{gA.__wbindgen_add_to_stack_pointer(16)}var n,s}function BA(){const e={wbg:{}};return e.wbg.__wbindgen_error_new=function(e,t){return function(e){lA===pA.length&&pA.push(pA.length+1);const t=lA;return lA=pA[t],pA[t]=e,t}(new Error(dA(e,t)))},e.wbg.__wbindgen_throw=function(e,t){throw new Error(dA(e,t))},e}async function QA(e){if(void 0!==gA)return gA;void 0===e&&(e=new URL("keccak_wasm_bg.wasm",import.meta.url));const t=BA();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:A,module:r}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const A=await e.arrayBuffer();return await WebAssembly.instantiate(A,t)}{const A=await WebAssembly.instantiate(e,t);return A instanceof WebAssembly.Instance?{instance:A,module:e}:A}}(await e,t);return function(e,t){return gA=e.exports,QA.__wbindgen_wasm_module=t,yA=null,uA=null,gA}(A,r)}EA.encodeInto,"undefined"==typeof FinalizationRegistry||new FinalizationRegistry(e=>gA.__wbg_keccakhash_free(e>>>0)),await QA(Promise.resolve().then(function(){return aA}).then(e=>e.WASM_BINARY));const fA={verifySignature:(e,t,A,r)=>I(t,r,A,e),sign:(e,t,A)=>u(e,A,t),vrfOutputSignature:e=>c(e),vrfOutputSeed:(e,t)=>g(e,t),vrfOutputRingProof:e=>a(e),verifyVrfProof:(e,t,A)=>i(e,A,new Uint8Array(0),Buffer.from(t),O),ringRoot(e){const t=Buffer.alloc(32*e.length);return e.forEach((e,A)=>{t.set(e,32*A)}),o(t)},publicKey:e=>s(e),privKey:e=>n(e)},_A={verifySignature:(e,t,A)=>d.crypto_sign_verify_detached(Buffer.from(e),Buffer.from(A),Buffer.from(t)),sign(e,t){const A=Buffer.alloc(64);return d.crypto_sign_detached(A,Buffer.from(e),Buffer.from(t)),A},keypair(e){const t=Buffer.alloc(32),A=Buffer.alloc(64);return d.crypto_sign_seed_keypair(t,A,Buffer.from(e)),{public:t,privateKey:A}}};sA.ready(e=>{if(e)throw e});const wA={blake2b:e=>sA().update(e).digest(),keccak256:e=>mA(e)};function vA(e,t,A,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,A):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,A,r);else for(var i=e.length-1;i>=0;i--)(n=e[i])&&(o=(s<3?n(o):s>3?n(t,A,o):n(t,A))||o);return s>3&&o&&Object.defineProperty(t,A,o),o}function bA(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function SA(e,t,A,r){if("a"===A&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===A?r:"a"===A?r.call(e):r?r.value:t.get(e)}function DA(e,t,A,r,n){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,A),A}"function"==typeof SuppressedError&&SuppressedError;const NA=$e(32),OA=e=>"string"==typeof e||"number"==typeof e||"boolean"==typeof e||"bigint"==typeof e||"symbol"==typeof e;var kA;class MA{constructor(e){if(this.internalSet=new Set,this.keyLookupMap=new Map,this[kA]="IdentitySet",e)for(const t of e)this.add(t)}getInternalKey(e){return OA(e)?e:ut.arrayToLittleEndian(e)}lookupValue(e){if(this.keyLookupMap.has(e))return this.keyLookupMap.get(e);throw new Error("lookupValue called with unknown key")}add(e){const t=this.getInternalKey(e);return this.internalSet.add(t),this.keyLookupMap.set(t,e),this}has(e){const t=this.getInternalKey(e);return this.internalSet.has(t)}delete(e){const t=this.getInternalKey(e),A=this.internalSet.delete(t);return this.keyLookupMap.delete(t)&&A}clear(){this.internalSet.clear(),this.keyLookupMap.clear()}get size(){return this.internalSet.size}keys(){return[...this.internalSet.keys()].map(e=>this.lookupValue(e)).values()}values(){return this.keys()}entries(){return[...this.internalSet.keys()].map(e=>{const t=this.lookupValue(e);return[t,t]}).values()}forEach(e,t){this.internalSet.forEach(A=>{const r=this.lookupValue(A);e.call(t,r,r,this)})}[(kA=Symbol.toStringTag,Symbol.iterator)](){return this.values()}}const xA=e=>({...ae(rt(e),e=>new MA(e),e=>Array.from(e.values()).sort(lt)),...Ne(be(e),{fromJSON:e=>new MA(e),toJSON:e=>Array.from(e.values()).sort(lt)})}),RA=(e,t)=>function(A,r){ye(xA(e),t)(A,r)};let FA=class extends ue{constructor(e){super(),Object.assign(this,e)}};var UA;vA([ye(NA,"hash"),bA("design:type",Object)],FA.prototype,"packageHash",void 0),vA([He(4,"length"),bA("design:type",Object)],FA.prototype,"bundleLength",void 0),vA([ye(NA,"erasure_root"),bA("design:type",Object)],FA.prototype,"erasureRoot",void 0),vA([ye(NA,"exports_root"),bA("design:type",Object)],FA.prototype,"segmentRoot",void 0),vA([He(2,"exports_count"),bA("design:type",Number)],FA.prototype,"segmentCount",void 0),FA=vA([he(),bA("design:paramtypes",[Object])],FA);let TA=UA=class extends ue{constructor(e){super(),this.value=e}safeKey(){return this.value}epochIndex(){return Math.floor(this.value/R)}slotPhase(){return this.value%R}isSameEra(e){return this.epochIndex()===e.epochIndex()}isNewerEra(e){return this.epochIndex()>e.epochIndex()}isNextEra(e){return this.epochIndex()===e.epochIndex()+1}checkPTauValid(e){return this.value<=e.value?Ut(GA.POSTERIOR_TAU_LESS_OR_EQUAL_TAU):this.value>UA.posteriorTau().value?Ut(GA.POSTERIOR_TAU_IN_FUTURE):Ft(this)}static posteriorTau(){return new UA(Math.floor(this.bigT()/N))}static bigT(){return(Date.now()/1e3|0)-1704110400}};var GA;vA([He(4,ce),bA("design:type",Number)],TA.prototype,"value",void 0),TA=UA=vA([he(),bA("design:paramtypes",[Number])],TA),function(e){e.POSTERIOR_TAU_LESS_OR_EQUAL_TAU="POSTERIOR_TAU_LESS_OR_EQUAL_TAU",e.POSTERIOR_TAU_IN_FUTURE="POSTERIOR_TAU_IN_FUTURE"}(GA||(GA={}));let jA=class extends ue{};vA([ye($e(32),"anchor"),bA("design:type",Object)],jA.prototype,"anchorHash",void 0),vA([ye($e(32),"state_root"),bA("design:type",Object)],jA.prototype,"anchorPostState",void 0),vA([ye($e(32),"beefy_root"),bA("design:type",Object)],jA.prototype,"anchorAccOutLog",void 0),vA([ye($e(32),"lookup_anchor"),bA("design:type",Object)],jA.prototype,"lookupAnchorHash",void 0),vA([ye(TA,"lookup_anchor_slot"),bA("design:type",TA)],jA.prototype,"lookupAnchorSlot",void 0),vA([nt($e(32)),bA("design:type",Array)],jA.prototype,"prerequisites",void 0),jA=vA([he()],jA);class HA extends ue{constructor(e){super(),void 0!==e&&(e instanceof Uint8Array?this.success=e:this.error=e)}isError(){return!(this.success instanceof Uint8Array)}isSuccess(){return this.success instanceof Uint8Array}isPanic(){return this.error===Jt.Panic}isOutOfGas(){return this.error===Jt.OutOfGas}static big(){return new HA(Jt.Big)}static badExports(){return new HA(Jt.BadExports)}static bad(){return new HA(Jt.Bad)}static outOfGas(){return new HA(Jt.OutOfGas)}static panic(){return new HA(Jt.Panic)}static oversize(){return new HA(Jt.Oversize)}static encode(e,t){let A=0;const r=e;if(r.isSuccess())A=Ye.encode(0n,t),A+=At.encode(r.success,t.subarray(A));else switch(r.error){case Jt.OutOfGas:A=Ye.encode(1n,t);break;case Jt.Panic:A=Ye.encode(2n,t);break;case Jt.BadExports:A=Ye.encode(3n,t);break;case Jt.Oversize:A=Ye.encode(4n,t);break;case Jt.Bad:A=Ye.encode(5n,t);break;case Jt.Big:A=Ye.encode(6n,t)}return A}static encodedSize(e){const t=e;return t.isSuccess()?Ye.encodedSize(0n)+At.encodedSize(t.success):Ye.encodedSize(1n)}static decode(e){if(0===e[0]){const t=At.decode(e.subarray(1));return{value:new HA(t.value),readBytes:t.readBytes+1}}switch(e[0]){case 1:return{value:HA.outOfGas(),readBytes:1};case 2:return{value:HA.panic(),readBytes:1};case 3:return{value:HA.badExports(),readBytes:1};case 4:return{value:HA.oversize(),readBytes:1};case 5:return{value:HA.bad(),readBytes:1};case 6:return{value:HA.big(),readBytes:1};default:throw new Error(`Invalid value ${e[0]}`)}}toBinary(){return oe(HA,this)}toJSON(){if(this.isSuccess())return{ok:we().toJSON(this.success)};switch(this.error){case Jt.OutOfGas:return{"out-of-gas":null};case Jt.Panic:return{panic:null};case Jt.BadExports:return{"bad-exports":null};case Jt.Oversize:return{oversize:null};case Jt.Bad:return{"bad-code":null};case Jt.Big:return{"code-oversize":null}}}static fromJSON(e){const t=new HA;if("ok"in e)t.success=we().fromJSON(e.ok);else if("out-of-gas"in e)t.error=Jt.OutOfGas;else if("panic"in e)t.error=Jt.Panic;else if("bad-exports"in e)t.error=Jt.BadExports;else if("bad-code"in e)t.error=Jt.Bad;else{if(!("code-oversize"in e))throw new Error("wrong json encoding of work output");t.error=Jt.Big}return t}static toJSON(e){if(e instanceof HA)return e.toJSON();throw new Error(`Cannot convert ${e} to JSON`)}}let LA=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}};var YA;vA([He(4,"service_id"),bA("design:type",Number)],LA.prototype,"serviceIndex",void 0),vA([ye($e(32),"code_hash"),bA("design:type",Object)],LA.prototype,"codeHash",void 0),vA([ye($e(32),"payload_hash"),bA("design:type",Object)],LA.prototype,"payloadHash",void 0),vA([je(8,"accumulate_gas"),bA("design:type",BigInt)],LA.prototype,"gasLimit",void 0),vA([ye(HA),bA("design:type",HA)],LA.prototype,"result",void 0),vA([le(de([["gasUsed","gas_used",_e()],["importCount","imports",{fromJSON:e=>e,toJSON:e=>e}],["extrinsicCount","extrinsic_count",{fromJSON:e=>e,toJSON:e=>e}],["extrinsicSize","extrinsic_size",{fromJSON:e=>e,toJSON:e=>e}],["exportCount","exports",{fromJSON:e=>e,toJSON:e=>e}]]),"refine_load"),pe(ie([["gasUsed",Ke()],["importCount",Je()],["extrinsicCount",Je()],["extrinsicSize",Je()],["exportCount",Je()]])),bA("design:type",Object)],LA.prototype,"refineLoad",void 0),LA=vA([he(),bA("design:paramtypes",[Object])],LA);class KA{constructor(e){if(this.internalMap=new Map,this.keyLookupMap=new Map,this[YA]="SafeMap",e)for(const[t,A]of e)this.set(t,A)}getInternalKey(e){return ut.arrayToLittleEndian(e)}lookupKey(e){if(this.keyLookupMap.has(e))return this.keyLookupMap.get(e);throw new Error("lookupKey called with unknown key")}set(e,t){const A=this.getInternalKey(e);return this.internalMap.set(A,t),this.keyLookupMap.set(A,e),this}get(e){const t=this.getInternalKey(e);return this.internalMap.get(t)}has(e){const t=this.getInternalKey(e);return this.internalMap.has(t)}delete(e){const t=this.getInternalKey(e),A=this.internalMap.delete(t);return this.keyLookupMap.delete(t)&&A}clear(){this.internalMap.clear(),this.keyLookupMap.clear()}get size(){return this.internalMap.size}keys(){return[...this.internalMap.keys()].map(e=>this.lookupKey(e)).values()}values(){return this.internalMap.values()}entries(){return[...this.internalMap.entries()].map(([e,t])=>[this.lookupKey(e),t]).values()}forEach(e,t){this.internalMap.forEach((A,r)=>{e.call(t,A,this.lookupKey(r),this)})}[(YA=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}clone(){const e=new KA;for(const[t,A]of this.entries())e.set(t,A);return e}}const JA=(e,t,A)=>({...ae(it(e,t,(e,t)=>lt(e,t)),e=>new KA([...e.entries()]),e=>e),...Ne(Se(A,e,t),{fromJSON:e=>new KA([...e.entries()]),toJSON:e=>e})});let PA=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}hash(){return wA.blake2b(this.toBinary())}static extractWorkPackageHashes(e){return new MA(e.map(e=>e.avSpec.packageHash))}static computeRequiredWorkReports(e,t){const A=[],r=new Set(t.elements.map(e=>e.hash()));for(let t=0;t<M;t++){const n=e.elementAt(t);n&&r.has(n.workReport.hash())?A.push(n.workReport):A.push(void 0)}return A}};var VA;vA([ye(FA,"package_spec"),bA("design:type",FA)],PA.prototype,"avSpec",void 0),vA([ye(jA),bA("design:type",jA)],PA.prototype,"context",void 0),vA([le({fromJSON:e=>e,toJSON:e=>e},"core_index"),pe(Je()),bA("design:type",Number)],PA.prototype,"core",void 0),vA([ye(NA,"authorizer_hash"),bA("design:type",Object)],PA.prototype,"authorizerHash",void 0),vA([le(_e(),"auth_gas_used"),pe(Ye),bA("design:type",BigInt)],PA.prototype,"authGasUsed",void 0),vA([ye(At,"auth_output"),bA("design:type",Uint8Array)],PA.prototype,"authTrace",void 0),vA([ye(JA(NA,NA,{key:"work_package_hash",value:"segment_tree_root"}),"segment_root_lookup"),bA("design:type",KA)],PA.prototype,"srLookup",void 0),vA([le(be(LA),"results"),pe(rt(LA)),bA("design:type",Object)],PA.prototype,"digests",void 0),PA=vA([he(),bA("design:paramtypes",[Object])],PA);let XA=VA=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}union(){return new MA(this.elements.map(e=>[...e.values()]).flat())}toPosterior(e){const t=Ie(this),A=e.r_star.slice(0,e.nAccumulatedWork);t.elements[R-1]=PA.extractWorkPackageHashes(A);for(let e=0;e<R-1;e++)t.elements[e]=this.elements[e+1];return t}static newEmpty(){return new VA({elements:Array.from({length:R},()=>new MA)})}};vA([ot(R,xA(NA),ce),bA("design:type",Object)],XA.prototype,"elements",void 0),XA=VA=vA([he(),bA("design:paramtypes",[Object])],XA);class zA{constructor(e){Object.assign(this,e)}}let qA=class extends ue{constructor(e){super(),Object.assign(this,e)}};vA([ye(PA,"report"),bA("design:type",PA)],qA.prototype,"workReport",void 0),vA([RA(NA),bA("design:type",MA)],qA.prototype,"dependencies",void 0),qA=vA([he(),bA("design:paramtypes",[Object])],qA);class WA{constructor(e=[]){this.elements=e}immediatelyAccumulable(){return this.elements.filter(e=>0===e.context.prerequisites.length&&0==e.srLookup.size)}queueable(e){return ZA(this.elements.filter(e=>e.context.prerequisites.length>0||e.srLookup.size>0).map(e=>{const t=new MA([...e.srLookup.keys()]);return e.context.prerequisites.forEach(e=>t.add(e)),new qA({workReport:e,dependencies:t})}),e.union())}accumulatableReports(e){const t=this.immediatelyAccumulable(),A=this.queueable(e.accHistory),r=e.p_tau.slotPhase(),n=$A(ZA([...e.accQueue.elements.slice(r).flat(),...e.accQueue.elements.slice(0,r).flat(),...A],PA.extractWorkPackageHashes(t)));return[...t,...n]}}const ZA=(e,t)=>{const A=[];for(const{workReport:r,dependencies:n}of e){if(t.has(r.avSpec.packageHash))continue;const e=new MA([...n.values()]);t.forEach(t=>e.delete(t)),A.push(new qA({workReport:r,dependencies:e}))}return A},$A=e=>{const t=e.filter(({dependencies:e})=>0===e.size).map(({workReport:e})=>e);return 0===t.length?[]:[...t,...$A(ZA(e,PA.extractWorkPackageHashes(t)))]};var er;let tr=er=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}toPosterior(e){const t=Ie(this),A=e.p_tau.slotPhase();for(let r=0;r<R;r++){const n=(A-r+R)%R;0===r?t.elements[n]=Kt(ZA(e.r_q,e.p_accumulationHistory.elements[R-1])):r<e.p_tau.value-e.tau.value?t.elements[n]=Kt([]):t.elements[n]=Kt(ZA(this.elements[n],e.p_accumulationHistory.elements[R-1]))}return t}static newEmpty(){return new er({elements:Array.from({length:R},()=>new Array)})}};vA([le(be(be(qA)),ce),pe(st(R,rt(qA))),bA("design:type",Object)],tr.prototype,"elements",void 0),tr=er=vA([he(),bA("design:paramtypes",[Object])],tr);class Ar{constructor(e){e?Object.assign(this,e):this.elements=new Map}has(e){return this.elements.has(e)}get(e){return this.elements.get(e)}services(){return Array.from(this.elements.keys())}static compute(e){const t=new Ar;t.elements=new Map,e.gasUsed.elements.forEach(({serviceIndex:e,gasUsed:A})=>{t.elements.has(e)||t.elements.set(e,{gasUsed:0n,count:0});const r=t.elements.get(e);r.gasUsed=r.gasUsed+A});const A=e.r_star.slice(0,e.nAccumulatedWork);for(const e of t.elements.keys()){const r=A.map(e=>e.digests).flat().filter(t=>t.serviceIndex===e);0===r.length?t.elements.delete(e):t.elements.get(e).count=r.length}return t}}var rr;const nr=rt(NA);let sr=rr=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}elementAt(e){return this.elements[e]}toPosterior(e){const t=new rr;t.elements=[];for(let A=0;A<this.elements.length;A++){const r=e.p_queue.queueAtCore(A)[e.p_tau.value%V];let n;const s=e.eg.elementForCore(A);if(void 0===s)n=[...this.elements[A],r];else{const e=s.report.authorizerHash,t=this.elements[A].findIndex(t=>0===Buffer.compare(t,e));n=[...this.elements[A].slice(0,t),...this.elements[A].slice(t+1),r]}t.elements.push(Yt(n.reverse().slice(0,8).reverse()))}return t}static newEmpty(){return new rr({elements:Array.from({length:M},()=>new Array)})}};var or;vA([ot(M,{encode:nr.encode.bind(nr),decode:nr.decode.bind(nr),encodedSize:nr.encodedSize.bind(nr),...be(NA)},ce),bA("design:type",Object)],sr.prototype,"elements",void 0),sr=rr=vA([he(),bA("design:paramtypes",[Object])],sr);let ir=or=class extends ue{constructor(e){super(),Object.assign(this,e)}queueAtCore(e){return this.elements[e]}static newEmpty(){return new or({elements:Array.from({length:M},()=>Array.from({length:V},()=>new Uint8Array(32).fill(0)))})}};vA([ot(M,{...st(V,NA),...be(NA)},ce),bA("design:type",Object)],ir.prototype,"elements",void 0),ir=or=vA([he(),bA("design:paramtypes",[Object])],ir);const ar=(new TextEncoder).encode("node"),gr=(e,t=wA.blake2b)=>{if(0===e.length)return new Uint8Array(32).fill(0);if(1===e.length)return e[0];const A=Math.ceil(e.length/2);return t(new Uint8Array([...ar,...gr(e.slice(0,A),t),...gr(e.slice(A),t)]))},cr=(e,t=wA.blake2b)=>1===e.length?t(e[0]):gr(e,t),ur=(e,t,A,r)=>{if(A>=e.length)return e.slice().concat(t);if(A<e.length&&void 0===e[A])return Ir(e,A,t);{const n=function(e,t){if(0===e.length)return new Uint8Array(0);t??=e.reduce((e,t)=>e+t.length,0);const A=new Uint8Array(t);let r=0;for(const t of e)pt(t),A.set(t,r),r+=t.length;return A}([e[A],t]);return ur(Ir(e,A,void 0),r(n),A+1,r)}},Ir=(e,t,A)=>{const r=e.slice();return r[t]=A,r},dr=(new TextEncoder).encode("peak"),pr=e=>0===e.length?new Uint8Array(32).fill(0):1===e.length?e[0]:wA.keccak256(new Uint8Array([...dr,...pr(e.slice(0,e.length-1)),...e[e.length-1]]));let lr=class extends ue{constructor(e){super(),Object.assign(this,e)}packageHashes(){return new MA([...this.reportedPackages.keys()])}};var yr;vA([ye(NA,"header_hash"),bA("design:type",Object)],lr.prototype,"headerHash",void 0),vA([ye(NA,"beefy_root"),bA("design:type",Object)],lr.prototype,"accumulationResultMMB",void 0),vA([ye(NA,"state_root"),bA("design:type",Object)],lr.prototype,"stateRoot",void 0),vA([ye(JA(NA,NA,{key:"hash",value:"exports_root"}),"reported"),bA("design:type",KA)],lr.prototype,"reportedPackages",void 0),lr=vA([he(),bA("design:paramtypes",[Object])],lr);let hr=yr=class extends ue{constructor(e=[]){super(),this.elements=e}findHeader(e){return this.elements.find(t=>t.headerHash===e)}toDagger(e){if(0===this.elements.length)return this;const t=Ie(this);return t.elements[t.elements.length-1].stateRoot=e,t}allPackageHashes(){return this.elements.map(e=>e.packageHashes()).reduce((e,t)=>(t.forEach(t=>e.add(t)),e))}toPosterior(e){const t=Ie(this),A=(e=>{const t=e.filter(e=>void 0!==e);return 0===t.length?new Uint8Array(32).fill(0):pr(t)})(e.p_beefyBelt),r=new Map(e.eg.workReports().map(e=>e.avSpec).flat().map(e=>[e.packageHash,e.segmentRoot]));return t.elements.push(new lr({reportedPackages:r,headerHash:e.headerHash,stateRoot:new Uint8Array(32).fill(0),accumulationResultMMB:A})),t.elements.length>8&&(t.elements=t.elements.slice(t.elements.length-8)),t}static newEmpty(){return new yr([])}};var Cr;vA([nt(lr,ce),bA("design:type",Object)],hr.prototype,"elements",void 0),hr=yr=vA([he(),bA("design:paramtypes",[Array])],hr);let Er=Cr=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}toDagger(e){return new Cr({recentHistory:this.recentHistory.toDagger(e),beefyBelt:this.beefyBelt})}toPosterior(e){const t=e.p_theta.elements.map(e=>e.toBinary()),A=(r=this.beefyBelt,n=cr(t,wA.keccak256),s=wA.keccak256,ur(r,n,0,s));var r,n,s;return new Cr({beefyBelt:A,recentHistory:this.recentHistory.toPosterior({p_beefyBelt:A,eg:e.eg,headerHash:e.headerHash})})}static newEmpty(){return new Cr({recentHistory:hr.newEmpty(),beefyBelt:[]})}};vA([ye(hr,"history"),bA("design:type",hr)],Er.prototype,"recentHistory",void 0),vA([le(((e,t)=>({fromJSON:A=>t.fromJSON(A[e]),toJSON:A=>({[e]:t.toJSON(A)})}))("peeks",be(De(NA))),"mmr"),pe(rt(new ze(NA))),bA("design:type",Array)],Er.prototype,"beefyBelt",void 0),Er=Cr=vA([he(),bA("design:paramtypes",[Object])],Er);let mr=class extends ue{constructor(e){super(),Object.assign(this,e)}};var Br;vA([Ve("da_load"),bA("design:type",Number)],mr.prototype,"daLoad",void 0),vA([Ve(),bA("design:type",Number)],mr.prototype,"popularity",void 0),vA([Ve("imports"),bA("design:type",Number)],mr.prototype,"importCount",void 0),vA([Ve("exports"),bA("design:type",Number)],mr.prototype,"exportCount",void 0),vA([Ve("extrinsic_size"),bA("design:type",Number)],mr.prototype,"extrinsicSize",void 0),vA([Ve("extrinsic_count"),bA("design:type",Number)],mr.prototype,"extrinsicCount",void 0),vA([Ve("bundle_size"),bA("design:type",Number)],mr.prototype,"bundleSize",void 0),vA([Pe("gas_used"),bA("design:type",BigInt)],mr.prototype,"gasUsed",void 0),mr=vA([he(),bA("design:paramtypes",[Object])],mr);let Qr=Br=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}toPosterior(e){const t=Ie(this);for(let A=0;A<M;A++)t.elements[A]=new mr({..._r(A,e.bold_I),daLoad:fr(A,e.bold_R),popularity:e.ea.nPositiveVotes(A),bundleSize:e.bold_I.filter(e=>e.core===A).map(e=>e.avSpec.bundleLength).reduce((e,t)=>e+t,0)});return t}static newEmpty(){return new Br({elements:Array.from({length:M},()=>new mr({daLoad:0,popularity:0,importCount:0,exportCount:0,extrinsicSize:0,extrinsicCount:0,bundleSize:0,gasUsed:0n}))})}};vA([ot(M,mr,ce),bA("design:type",Object)],Qr.prototype,"elements",void 0),Qr=Br=vA([he(),bA("design:paramtypes",[Object])],Qr);const fr=(e,t)=>t.elements.filter(t=>t.core===e).map(e=>e.avSpec.bundleLength+Z*Math.ceil(65*e.avSpec.segmentCount/64)).reduce((e,t)=>e+t,0),_r=(e,t)=>{const A=t.filter(t=>t.core===e),r={importCount:0,exportCount:0,extrinsicSize:0,extrinsicCount:0,gasUsed:0n};for(const{digests:e}of A)for(const t of e)r.importCount=r.importCount+t.refineLoad.importCount,r.exportCount=r.exportCount+t.refineLoad.exportCount,r.extrinsicSize=r.extrinsicSize+t.refineLoad.extrinsicSize,r.extrinsicCount=r.extrinsicCount+t.refineLoad.extrinsicCount,r.gasUsed=r.gasUsed+t.refineLoad.gasUsed;return r};var wr;let vr=wr=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}static newEmpty(){return new wr({source:0,destination:0,amount:0n,memo:new Uint8Array(z).fill(0),gas:0n})}};vA([He(4),bA("design:type",Number)],vr.prototype,"source",void 0),vA([He(4),bA("design:type",Number)],vr.prototype,"destination",void 0),vA([je(8),bA("design:type",BigInt)],vr.prototype,"amount",void 0),vA([le(we()),pe(Ze(z)),bA("design:type",Object)],vr.prototype,"memo",void 0),vA([je(8),bA("design:type",BigInt)],vr.prototype,"gas",void 0),vr=wr=vA([he(),bA("design:paramtypes",[Object])],vr);class br{constructor(e){Object.assign(this,e)}isHostCall(){return this.reason===Vt.HostCall}isPageFault(){return this.reason===Vt.PageFault}isPanic(){return this.reason===Pt.Panic}isHalt(){return this.reason===Pt.Halt}isOutOfGas(){return this.reason===Pt.OutOfGas}toString(){return this.isHostCall()?`HostCall[${this.opCode}]`:this.isOutOfGas()?"OutOfGas":this.isHalt()?"Halt":this.isPanic()?"Panic":this.isPageFault()?`PageFault[x${this.address.toString(16)}][${this.address}]`:"Unknon Exit Reason"}static panic(){return new br({reason:Pt.Panic})}static halt(){return new br({reason:Pt.Halt})}static outOfGas(){return new br({reason:Pt.OutOfGas})}static hostCall(e){return new br({reason:Vt.HostCall,opCode:e})}static pageFault(e){return new br({reason:Vt.PageFault,address:e})}}const Sr=e=>t=>t+t/2n**(8n*e-1n)*(2n**64n-2n**(8n*e)),Dr=Sr(4n),Nr=Sr(8n),Or=(e,t)=>{if(0n===t)return e;return(e<0n?-1n:1n)*((e=e<0n?-e:e)%(t=t<0n?-t:t))},kr={ip:e=>({type:"ip",data:e}),hostCall:e=>({type:"exit",data:br.hostCall(e)}),pageFault:(e,t)=>[kr.gas(1n),kr.ip(t),{type:"exit",data:br.pageFault(e)}],skip:(e,t)=>({type:"ip",data:e+t}),gas:e=>({type:"gas",data:e}),reg:(e,A)=>(t(e>=0&&e<13,`${e} not in bounds`),{type:"register",data:{index:e,value:BigInt(A)}}),w7:e=>kr.reg(7,e),w8:e=>kr.reg(8,e),memory:(e,t)=>({type:"memory",data:{from:Number(e),data:t}}),outOfGas:()=>({type:"exit",data:br.outOfGas()}),halt:()=>({type:"exit",data:br.halt()}),panic:()=>({type:"exit",data:br.panic()}),obj:e=>({type:"object",data:e})},Mr=e=>{const t=[];for(let A=0;A<R/2;A++)t.push(e[A]),t.push(e[R-A-1]);return t},xr="true"==process.env.DEBUG_FS;xr&&p.existsSync("/tmp/trace.txt")&&p.unlinkSync("/tmp/trace.txt");const Rr=(e,t)=>{if(!t)return;let A;A="string"==typeof e?e:"toJSON"in e&&"function"==typeof e.toJSON?e.toJSON():JSON.stringify(e,(e,t)=>"bigint"==typeof t?t.toString():t instanceof Uint8Array||Buffer.isBuffer(t)?$e(t.length).toJSON(t):"function"==typeof t.toJSON?t.toJSON():t),xr&&p.appendFileSync("/tmp/trace.txt",A+"\n"),console.log(A)},Fr={byCode:new Map,byIdentifier:new Map},Ur=(e,t=10n)=>(A,r,n)=>{const s=(e=>{if(Fr.byCode.has(e.fn.opCode))throw new Error(`duplicate opCode ${e.fn.opCode} ${e.fn.identifier}`);if(Fr.byIdentifier.has(e.fn.identifier))throw new Error(`duplicate identifier ${e.fn.identifier}`);const t=(t,A)=>{const r="function"==typeof e.fn.gasCost?e.fn.gasCost(t,A):e.fn.gasCost;return r>t.gas?[kr.outOfGas()]:[kr.gas(r),...e.fn.execute(t,A)]};return Fr.byCode.set(e.fn.opCode,e.fn.identifier),Fr.byIdentifier.set(e.fn.identifier,t),t})({fn:{opCode:e,identifier:r,execute:n.value,gasCost:t}});return n.value=function(e,t){Rr(`HostCall[${r}]`,"true"==process.env.DEBUG_STEPS);return s.call(this,e,t)},n},Tr={encode(e,t){if(e.k.length!==e.c.length)throw new Error("k and c must have the same length");let A=0;A+=Ye.encode(BigInt(e.j.length),t.subarray(A)),A+=ke.encode(BigInt(e.z),t.subarray(A,A+1)),A+=Ye.encode(BigInt(e.c.length),t.subarray(A));for(let r=0;r<e.j.length;r++)A+=Ye.encode(BigInt(e.j[r]),t.subarray(A,A+e.z));return t.set(e.c,A),A+=e.c.length,A+=Xe(e.k.length).encode(e.k,t.subarray(A)),A},decode(t){let A=0;const r={},n=Ye.decode(t.subarray(A));A+=n.readBytes;const s=ke.decode(t.subarray(A,A+1));A+=s.readBytes,r.z=Number(s.value);const o=Ye.decode(t.subarray(A));A+=o.readBytes,r.j=[];for(let e=0;e<n.value;e++){const e=Oe(r.z).decode(t.subarray(A,A+r.z));r.j.push(Number(e.value)),A+=e.readBytes}r.c=t.subarray(A,A+Number(o.value)),A+=Number(o.value);const i=Math.ceil(Number(o.value)/8);return r.k=Xe(Number(o.value)).decode(t.subarray(A,A+i)).value,A+=i,e(A<=t.length,"deblob couldnt decode properly"),{value:r,readBytes:A}},encodedSize:e=>Ye.encodedSize(BigInt(e.j.length))+1+Ye.encodedSize(BigInt(e.c.length))+e.c.length+e.j.length*e.z+Math.ceil(e.k.length/8)};class Gr{constructor(e){this.elements=e??new Map}services(){return new Set(this.elements.keys())}has(e){return this.elements.has(e)}get(e){return this.elements.get(e)}set(e,t){return this.elements.set(e,t),this}clone(){const e=new Gr;return e.elements=new Map([...this.elements].map(([e,t])=>[e,t.clone()])),e}delete(e){return this.elements.delete(e)}preimageIntegration(e,t){const A=this.clone();for(const{serviceId:r,blob:n}of e){const e=wA.blake2b(n),s=Yt(n.length);0===this.get(r)?.requests.get(e,s)?.length&&(A.get(r).requests.set(e,s,Yt([t])),A.get(r).preimages.set(e,n))}return A}toDoubleDagger(e){const t=new Gr;for(const[A,r]of e.invokedTransfers){const n=r.serviceAccount.clone();e.accumulationStatistics.has(A)&&(n.lastAcc=e.p_tau),t.set(A,n)}return t}toPosterior(e){const t=e.ep.elements.filter(e=>this.get(e.requester).isPreimageSolicitedButNotYetProvided(wA.blake2b(e.blob),e.blob.length)),A=this.clone();for(const{requester:r,blob:n}of t){const t=A.get(r);t.preimages=t.preimages.clone();const s=wA.blake2b(n);t.preimages.set(s,n),t.requests.set(s,Yt(n.length),Yt([e.p_tau]))}return A}static union(e,t){return new Gr(new Map([...e.elements,...t.elements]))}static newEmpty(){return new Gr(new Map)}}var jr;let Hr=jr=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}static newEmpty(){return new jr({manager:0,assigners:Array.from({length:M},()=>0),delegator:0,alwaysAccers:new Map})}};vA([He(4,"bless"),bA("design:type",Number)],Hr.prototype,"manager",void 0),vA([le(be({fromJSON:e=>e,toJSON:e=>e}),"assign"),pe(st(M,Fe(4))),bA("design:type",Object)],Hr.prototype,"assigners",void 0),vA([He(4,"designate"),bA("design:type",Number)],Hr.prototype,"delegator",void 0),vA([le(Se({key:"service",value:"gas"},{fromJSON:e=>e,toJSON:e=>e},{fromJSON:e=>e,toJSON:e=>e}),"always_acc"),pe(it(Fe(4),Oe(8),(e,t)=>e-t)),bA("design:type",Map)],Hr.prototype,"alwaysAccers",void 0),Hr=jr=vA([he(),bA("design:paramtypes",[Object])],Hr);let Lr=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}};vA([ye(NA),bA("design:type",Object)],Lr.prototype,"packageHash",void 0),vA([ye(NA),bA("design:type",Object)],Lr.prototype,"segmentRoot",void 0),vA([ye(NA),bA("design:type",Object)],Lr.prototype,"authorizerHash",void 0),vA([ye(NA),bA("design:type",Object)],Lr.prototype,"payloadHash",void 0),vA([Pe(),bA("design:type",BigInt)],Lr.prototype,"gasLimit",void 0),vA([ye(HA),bA("design:type",HA)],Lr.prototype,"result",void 0),vA([ye(At),bA("design:type",Uint8Array)],Lr.prototype,"authTrace",void 0),Lr=vA([he(),bA("design:paramtypes",[Object])],Lr);class Yr{constructor(e){Object.assign(this,e)}clone(){return new Yr({accounts:this.accounts.clone(),stagingSet:Ie(this.stagingSet),authQueue:Ie(this.authQueue),manager:this.manager,assigners:[...this.assigners],delegator:this.delegator,alwaysAccers:new Map(this.alwaysAccers)})}}class Kr{constructor(e){Object.assign(this,e)}clone(){const e=new Kr(this);return e.registers=Ie(this.registers),e.memory=this.memory.clone(),e}}var Jr,Pr,Vr,Xr,zr,qr,Wr;class Zr{constructor(e,t,A){if(Jr.add(this),this.acl=t,this.heap=A,Pr.set(this,new Map),e instanceof Map)DA(this,Pr,e);else{DA(this,Pr,new Map);for(const e of t.keys())SA(this,Pr,"f").set(e,new Uint8Array(Ae).fill(0));for(const{at:t,content:A}of e)SA(this,Jr,"m",qr).call(this,t,A)}}changeAcl(e,A){return this.acl.has(e)?A===Xt.Null?this.acl.delete(e):this.acl.set(e,A):(t(A===Xt.Read||A==Xt.Write),this.acl.set(e,A)),this}setBytes(e,A){return t(this.canWrite(e,A.length),"Memory is not writeable"),SA(this,Jr,"m",qr).call(this,e,A),this}getBytes(e,A){t(this.canRead(e,A),"Memory is not readable");return SA(this,Jr,"m",Wr).call(this,e,A)}canRead(e,t){if("bigint"==typeof e){if(e>=2n**32n)return!1;e=Number(e)}return void 0===this.firstUnreadable(e,t)}firstUnreadable(e,t){const A=SA(this,Jr,"m",Xr).call(this,e,t);for(const e of A)if(!this.acl.has(e))return e*Ae}canWrite(e,t){if("bigint"==typeof e){if(e>=2n**32n)return!1;e=Number(e)}return void 0===this.firstUnwriteable(e,t)}firstUnwriteable(e,t){const A=SA(this,Jr,"m",Xr).call(this,e,t);for(const e of A){if(!this.acl.has(e))return e*Ae;if(this.acl.get(e)===Xt.Read)return e*Ae}}firstWriteableInHeap(e){if(this.heap.pointer+e>=this.heap.end){for(let t=0;t<Math.ceil(e/Ae);t++)this.acl.set(this.heap.end/Ae+t,Xt.Write),SA(this,Pr,"f").set(this.heap.end/Ae+t,new Uint8Array(Ae).fill(0));this.heap.end=this.heap.end+Math.ceil(e/Ae)*Ae}const t=this.heap.pointer;return this.heap.pointer=t+e,t}clone(){return new Zr(new Map(SA(this,Pr,"f").entries()),new Map(this.acl.entries()),{...this.heap})}toString(){let e="";for(const[t,A]of SA(this,Pr,"f").entries())e+=`Page ${t}|0x${(t*Ae).toString(16)}: ${Buffer.from(A).toString("hex")}\n`;return e}}Pr=new WeakMap,Jr=new WeakSet,Vr=function(e){return{page:Math.floor(Number(e)/Ae),offset:Number(e)%Ae}},Xr=function(e,t){if(0===t)return[];const{page:A,offset:r}=SA(this,Jr,"m",Vr).call(this,e),n=[A];let s=t-(Ae-r);for(;s>0;)n.push((n[n.length-1]+1)%1048576),s-=Ae;return n},zr=function(e){const A=SA(this,Pr,"f").get(e);return t(A,`Page ${e}|0x${(e*Ae).toString(16)} is not allocated`),A},qr=function e(t,A){if(0===A.length)return;const{page:r,offset:n}=SA(this,Jr,"m",Vr).call(this,t),s=SA(this,Jr,"m",zr).call(this,r),o=Math.min(A.length,Ae-n);s.set(A.subarray(0,o),n),SA(this,Pr,"f").set(r,s),o<A.length&&SA(this,Jr,"m",e).call(this,$r(BigInt(t)+BigInt(o)),A.subarray(o))},Wr=function e(t,A){if(0===A)return new Uint8Array(0);const{page:r,offset:n}=SA(this,Jr,"m",Vr).call(this,t),s=SA(this,Jr,"m",zr).call(this,r),o=Math.min(A,Ae-n),i=s.subarray(n,n+o);if(o!==A){const r=SA(this,Jr,"m",e).call(this,$r(BigInt(t)+BigInt(o)),A-o),n=new Uint8Array(i.length+r.length);return n.set(i),n.set(r,i.length),n}return i.slice()};const $r=e=>Number(BigInt(e)%2n**32n);let en=class extends ue{constructor(e){super(),this.value=e??0n}checked_u32(){return t(this.fitsInU32(),"Value exceeds u32 range"),Number(this.value)}fitsInU32(){return this.value<2n**32n}u64(){return this.value}toSafeMemoryAddress(){return $r(this.value)}[Symbol.toPrimitive](e){return"number"===e?Number(this.value):`${this.value}`}};vA([je(8,ce),bA("design:type",BigInt)],en.prototype,"value",void 0),en=vA([he(),bA("design:paramtypes",[BigInt])],en);let tn=class extends ue{constructor(e){super(),this.elements=void 0!==e?e:new Array(13).fill(null).map(()=>new en(0n))}slice(e,t){return this.elements.slice(e,t)}w0(){return this.elements[0]}w1(){return this.elements[1]}w2(){return this.elements[2]}w3(){return this.elements[3]}w4(){return this.elements[4]}w5(){return this.elements[5]}w6(){return this.elements[6]}w7(){return this.elements[7]}w8(){return this.elements[8]}w9(){return this.elements[9]}w10(){return this.elements[10]}w11(){return this.elements[11]}w12(){return this.elements[12]}};vA([ot(13,en,ce),bA("design:type",Object)],tn.prototype,"elements",void 0),tn=vA([he(),bA("design:paramtypes",[Object])],tn);class An{constructor(e){Object.assign(this,e)}bold_s(){return this.state.accounts.get(this.id)}clone(){return new An({id:this.id,state:this.state.clone(),nextFreeID:this.nextFreeID,transfers:Ie(this.transfers),yield:this.yield,provisions:this.provisions.map(e=>({serviceId:e.serviceId,blob:e.blob.slice()}))})}}const rn=(e,t)=>{if(t instanceof Uint8Array){const A=t,r=wA.blake2b(A),n=oe(xe,BigInt(e));return new Uint8Array([n[0],r[0],n[1],r[1],n[2],r[2],n[3],r[3],...r.subarray(4,27)])}if("number"==typeof t){const A=oe(xe,BigInt(t));return new Uint8Array([e,A[0],0,A[1],0,A[2],0,A[3],...new Array(23).fill(0)])}return new Uint8Array([e,...new Array(30).fill(0)])};var nn,sn;class on{constructor(e){if(this.internalMap=new Map,this.keyLookupMap=new Map,this[nn]="SafeMap",e)for(const[t,A]of e)this.set(t,A)}setSafeKeyProvider(e){this.safeKeyProvider=e}getInternalKey(e){if(OA(e))return e;if(this.safeKeyProvider)return this.safeKeyProvider(e);if((e=>"object"==typeof e&&null!==e&&"function"==typeof e.safeKey)(e))return e.safeKey();throw new Error("cannot convert key to SafeKey did you set a provider or is key SafeKeyable?")}lookupKey(e){return this.keyLookupMap.has(e)?this.keyLookupMap.get(e):e}set(e,t){const A=this.getInternalKey(e);return this.internalMap.set(A,t),OA(e)||this.keyLookupMap.set(A,e),this}get(e){const t=this.getInternalKey(e);return this.internalMap.get(t)}has(e){const t=this.getInternalKey(e);return this.internalMap.has(t)}delete(e){const t=this.getInternalKey(e),A=this.internalMap.delete(t);return(OA(e)||this.keyLookupMap.delete(t))&&A}clear(){this.internalMap.clear(),this.keyLookupMap.clear()}get size(){return this.internalMap.size}keys(){return[...this.internalMap.keys()].map(e=>this.lookupKey(e)).values()}values(){return this.internalMap.values()}entries(){return[...this.internalMap.entries()].map(([e,t])=>[this.lookupKey(e),t]).values()}forEach(e,t){this.internalMap.forEach((A,r)=>{e.call(t,A,this.lookupKey(r),this)})}[(nn=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}}let an=class extends ue{isSignatureValid(e){const t=e.validatorSet.at(this.index).ed25519;let A;A=this.vote?new Uint8Array([...J,...e.target]):new Uint8Array([...P,...e.target]);return!!_A.verifySignature(this.signature,t,A)}checkValidity(e){return this.index>=O?Ut(In.INVALID_JUDGEMENT_INDEX):this.isSignatureValid(e)?Ft(this):Ut(In.JUDGEMENT_SIGNATURE_WRONG)}};vA([Le(),bA("design:type",Boolean)],an.prototype,"vote",void 0),vA([He(2),bA("design:type",Number)],an.prototype,"index",void 0),vA([ye($e(64)),bA("design:type",Object)],an.prototype,"signature",void 0),an=vA([he()],an);let gn=class extends ue{checkValidity(e){if(this.judgements.length!==k)return Ut(In.JUDGEMENTS_LENGTH);if(this.age!==e.tau.epochIndex()&&this.age!==e.tau.epochIndex()-1)return Ut(In.EPOCH_INDEX_WRONG);if(this.judgements.length!==k)return Ut(In.JUDGEMENTS_LENGTH_WRONG);const t=this.age===e.tau.epochIndex()?e.kappa:e.lambda;for(const e of this.judgements)if(!e.isSignatureValid({target:this.target,validatorSet:t}))return Ut(In.JUDGEMENT_SIGNATURE_WRONG);if(e.disputesState.good.has(this.target))return Ut(In.VERDICTS_IN_PSI_G);if(e.disputesState.bad.has(this.target))return Ut(In.VERDICTS_IN_PSI_B);if(e.disputesState.wonky.has(this.target))return Ut(In.VERDICTS_IN_PSI_W);for(let e=1;e<this.judgements.length;e++)if(this.judgements[e-1].index>=this.judgements[e].index)return Ut(In.JUDGEMENTS_NOT_ORDERED);const A=this.judgements.reduceRight((e,t)=>e+(t.vote?1:0),0);return 0!==A&&A!==Math.floor(O/3)&&A!==k?Ut(In.JUDGEMENTS_WRONG):Ft(this)}};vA([ye(NA),bA("design:type",Object)],gn.prototype,"target",void 0),vA([He(4),bA("design:type",Object)],gn.prototype,"age",void 0),vA([ot(k,an,"votes"),bA("design:type",Object)],gn.prototype,"judgements",void 0),gn=vA([he()],gn);let cn=sn=class extends ue{constructor(e=[]){super(),this.elements=e}votes(){return this.elements.map(e=>{const t=e.judgements.reduce((e,t)=>e+(t.vote?1:0),0);return{reportHash:e.target,votes:0===t?un.ZERO:t===k?un.TWO_THIRD_PLUS_ONE:t===Math.floor(O/3)?un.ONE_THIRD:t}})}checkValidity(e){for(let e=1;e<this.elements.length;e++){const[t,A]=[this.elements[e-1],this.elements[e]];if(lt(t.target,A.target)>=0)return Ut(In.VERDICTS_MUST_BE_ORDERED_UNIQUE_BY_HASH)}for(const t of this.elements){const[A]=t.checkValidity(e).safeRet();if(void 0!==A)return Ut(A)}return Ft(this)}static empty(){return new sn([])}};var un,In,dn;vA([nt(gn,ce),bA("design:type",Array)],cn.prototype,"elements",void 0),cn=sn=vA([he(),bA("design:paramtypes",[Array])],cn),function(e){e.ZERO="zero",e.ONE_THIRD="one-third",e.TWO_THIRD_PLUS_ONE="two-third-plus-one"}(un||(un={})),function(e){e.JUDGEMENTS_LENGTH="JUDGEMENTS_LENGTH",e.EPOCH_INDEX_WRONG="EPOCH_INDEX_WRONG",e.JUDGEMENTS_LENGTH_WRONG="JUDGEMENTS_LENGTH_WRONG",e.JUDGEMENT_SIGNATURE_WRONG="JUDGEMENT_SIGNATURE_WRONG",e.JUDGEMENTS_WRONG="JUDGEMENTS_WRONG",e.VERDICTS_MUST_BE_ORDERED_UNIQUE_BY_HASH="VERDICTS_MUST_BE_ORDERED_UNIQUE_BY_HASH",e.INVALID_JUDGEMENT_INDEX="INVALID_JUDGEMENT_INDEX",e.VERDICTS_IN_PSI_W="VERDICTS_IN_PSI_W",e.VERDICTS_IN_PSI_B="VERDICTS_IN_PSI_B",e.VERDICTS_IN_PSI_G="VERDICTS_IN_PSI_G",e.JUDGEMENTS_NOT_ORDERED="JUDGEMENTS_NOT_ORDERED"}(In||(In={}));let pn=dn=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}toPosterior(e){const t=e.extrinsic.verdicts.votes(),A=new dn({good:new MA([...this.good,...t.filter(({votes:e})=>e==un.TWO_THIRD_PLUS_ONE).map(({reportHash:e})=>e)]),bad:new MA([...this.bad,...t.filter(({votes:e})=>e==un.ZERO).map(({reportHash:e})=>e)]),wonky:new MA([...this.wonky,...t.filter(({votes:e})=>e==un.ONE_THIRD).map(({reportHash:e})=>e)]),offenders:new MA([...this.offenders,...e.extrinsic.culprits.elements.map(({key:e})=>e),...e.extrinsic.faults.elements.map(({key:e})=>e)])});for(let t=0;t<e.extrinsic.culprits.elements.length;t++){const{target:r}=e.extrinsic.culprits.elements[t];if(!A.bad.has(r))return Ut(ln.CULPRIT_NOT_IN_PSIB)}for(let t=0;t<e.extrinsic.faults.elements.length;t++){const{target:r,vote:n}=e.extrinsic.faults.elements[t];if(n){if(!A.bad.has(r)||A.good.has(r))return Ut(ln.VALID_REPORT_NOT_IN_PSIB_OR_IN_PSIO)}else if(A.bad.has(r)||!A.good.has(r))return Ut(ln.INVALID_REPORT_IN_PSIB_OR_NOT_IN_PSIO)}return Ft(A)}static newEmpty(){return new dn({good:new MA,bad:new MA,wonky:new MA,offenders:new MA})}};var ln,yn;vA([RA(NA),bA("design:type",MA)],pn.prototype,"good",void 0),vA([RA(NA),bA("design:type",MA)],pn.prototype,"bad",void 0),vA([RA(NA),bA("design:type",MA)],pn.prototype,"wonky",void 0),vA([RA($e(32)),bA("design:type",MA)],pn.prototype,"offenders",void 0),pn=dn=vA([he(),bA("design:paramtypes",[Object])],pn),function(e){e.EPOCH_INDEX_WRONG="epochIndex is wrong",e.CUPLRIT_SIGNATURE_INVALID="culprit signature is invalid",e.CULPRIT_HASH_MUST_REFERENCE_VERDICT="culprit.hash must reference a verdict",e.FAULT_SIGNATURE_INVALID="fault signature is invalid",e.VERDICTS_NOT_FROM_CURRENT_EPOCH="verdicts must be for the current or previous epoch",e.CULPRIT_NOT_ORDERED_BY_ED25519_PUBLIC_KEY="culprit must be ordered/unique by .ed25519PublicKey",e.FAULTS_NOT_ORDERED_BY_ED25519_PUBLIC_KEY="faults must be ordered/unique by .ed25519PublicKey",e.VERDICTS_IN_PSI_G="verdict.hash must not be in psi_g",e.VERDICTS_IN_PSI_B="verdict.hash must not be in psi_b",e.VERDICTS_IN_PSI_W="verdict.hash must not be in psi_w",e.JUDGEMENTS_NOT_ORDERED_BY_VALIDATOR_INDEX="judgements must be ordered/unique by .validatorIndex",e.VERDICTS_NUM_VALIDATORS="judgements must be 0 or 1/3 or 2/3+1 of NUM_VALIDATORS",e.POSITIVE_VERDICTS_NOT_IN_FAULTS="positive verdicts must be in faults",e.NEGATIVE_VERDICTS_NOT_IN_CULPRIT="negative verdicts must have at least 2 in culprit",e.VERDICT_SIGNATURE_INVALID="verdict signature is invalid",e.VALID_REPORT_NOT_IN_PSIB_OR_IN_PSIO="with fault validity 1, the report must be in psi_b' and not in psi_o'",e.INVALID_REPORT_IN_PSIB_OR_NOT_IN_PSIO="with fault validity 0, the report must NOT be in psi_b' and in psi_o'",e.CULPRIT_NOT_IN_PSIB="CULPRIT_NOT_IN_PSIB",e.CULPRITKEYNOTINK="one or more culprit key is not in bold_k",e.FAULTKEYNOTINK="one or more fault key is not in bold_k"}(ln||(ln={}));let hn=yn=class extends ue{constructor(e){super(),Object.assign(this,e)}static newEmpty(){return new yn({id:new Uint8Array(32).fill(0),attempt:0})}};var Cn,En;vA([ye(NA),bA("design:type",Object)],hn.prototype,"id",void 0),vA([Ve(),bA("design:type",Number)],hn.prototype,"attempt",void 0),hn=yn=vA([he(),bA("design:paramtypes",[Object])],hn),function(e){e.TICKET_NOT_IN_POSTERIOR_GAMMA_A="Ticket not in posterior gamma_a"}(En||(En={}));let mn=Cn=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}length(){return this.elements.length}toPosterior(e){const t=new Cn({elements:[...e.newTickets,...(()=>e.p_tau.isNewerEra(e.slot)?[]:this.elements)()].sort((e,t)=>lt(e.id,t.id)).slice(0,R)}),A=new Set(t.elements.map(e=>e.id));for(const t of e.newTickets)if(!A.has(t.id))return Ut(En.TICKET_NOT_IN_POSTERIOR_GAMMA_A);return Ft(t)}static newEmpty(){return new Cn({elements:new Array})}};var Bn;vA([nt(hn,ce),bA("design:type",Object)],mn.prototype,"elements",void 0),mn=Cn=vA([he(),bA("design:paramtypes",[Object])],mn);let Qn=Bn=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}static newEmpty(){return new Bn({banderSnatch:new Uint8Array(32).fill(0),ed25519:new Uint8Array(32).fill(0),blsKey:new Uint8Array(144).fill(0),metadata:new Uint8Array(128).fill(0)})}};var fn;vA([ye($e(32),"bandersnatch"),bA("design:type",Object)],Qn.prototype,"banderSnatch",void 0),vA([ye($e(32)),bA("design:type",Object)],Qn.prototype,"ed25519",void 0),vA([ye($e(144),"bls"),bA("design:type",Object)],Qn.prototype,"blsKey",void 0),vA([ye($e(128)),bA("design:type",Object)],Qn.prototype,"metadata",void 0),Qn=Bn=vA([he(),bA("design:paramtypes",[Object])],Qn);let _n=fn=class extends ue{constructor(e){super(),void 0!==e?Object.assign(this,e):this.elements=[]}at(t){return e(t>=0&&t<O,"Index out of bounds"),this.elements[t]}phi(e){return new fn({elements:this.elements.map(t=>e.has(t.ed25519)?Qn.newEmpty():t)})}static newEmpty(){return new fn({elements:Array.from({length:O},()=>Qn.newEmpty())})}};var wn;vA([ot(O,Qn,ce),bA("design:type",Object)],_n.prototype,"elements",void 0),_n=fn=vA([he(),bA("design:paramtypes",[Object])],_n);let vn=wn=class extends _n{toPosterior(e){return e.p_tau.isNewerEra(e.slot)?new wn({elements:e.iota.phi(e.p_offenders).elements}):this}static fromEpochMarker(e){const t=new wn;return t.elements=e.validators.map(e=>new Qn({ed25519:e.ed25519,banderSnatch:e.bandersnatch,blsKey:new Uint8Array(144).fill(0),metadata:new Uint8Array(128).fill(0)})),t}static newEmpty(){return new wn({elements:Array.from({length:O},()=>Qn.newEmpty())})}};var bn;vn=wn=vA([he()],vn);let Sn=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}};vA([ye($e(32)),bA("design:type",Object)],Sn.prototype,"bandersnatch",void 0),vA([ye($e(32)),bA("design:type",Object)],Sn.prototype,"ed25519",void 0),Sn=vA([he(),bA("design:paramtypes",[Object])],Sn);let Dn=bn=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}static build(e){if(e.p_tau.isNewerEra(e.tau)){const t=new bn;t.entropy=e.entropy._0,t.entropy2=e.entropy._1,t.validators=[];for(let A=0;A<O;A++)t.validators.push(new Sn({bandersnatch:e.p_gamma_p.at(A).banderSnatch,ed25519:e.p_gamma_p.at(A).ed25519}));return t}}static validate(e,t){if(t.p_tau.isNewerEra(t.tau)){if(void 0===e)return!1;if(0!==lt(e.entropy,t.entropy._0))return!1;if(0!==lt(e.entropy2,t.entropy._1))return!1;if(e.validators.length!==O)return!1;for(let A=0;A<O;A++)if(0!==lt(e.validators[A].bandersnatch,t.p_gamma_p.at(A).banderSnatch)||0!==lt(e.validators[A].ed25519,t.p_gamma_p.at(A).ed25519))return!1}else if(void 0!==e)return!1;return!0}};var Nn;vA([ye(NA),bA("design:type",Object)],Dn.prototype,"entropy",void 0),vA([ye(NA,"tickets_entropy"),bA("design:type",Object)],Dn.prototype,"entropy2",void 0),vA([ot(O,Sn),bA("design:type",Object)],Dn.prototype,"validators",void 0),Dn=bn=vA([he(),bA("design:paramtypes",[Object])],Dn);let On=Nn=class extends ue{constructor(e=[]){super(),this.elements=e}static build(e){return new Nn([...e.culprits.elements.map(e=>e.key),...e.faults.elements.map(e=>e.key)])}checkValidity(e){const t=Nn.build(e);if(this.elements.length!==t.elements.length)return!1;for(let e=0;e<this.elements.length;e++)if(0!==lt(this.elements[e],t.elements[e]))return!1;return!0}};var kn;vA([nt($e(32),ce),bA("design:type",Array)],On.prototype,"elements",void 0),On=Nn=vA([he(),bA("design:paramtypes",[Array])],On);let Mn=kn=class extends ue{constructor(e=[]){super(),Object.assign(this,e)}static build(e){return e.p_tau.isSameEra(e.tau)&&e.tau.slotPhase()<x&&x<=e.p_tau.slotPhase()&&e.gamma_a.length()===R?new kn(Mr(e.gamma_a.elements)):void 0}static validate(e,t){if(t.p_tau.isSameEra(t.tau)&&t.tau.slotPhase()<x&&x<=t.p_tau.slotPhase()&&t.gamma_a.length()===R){if(e?.elements.length!==R)return!1;const A=Mr(t.gamma_a.elements);for(let t=0;t<R;t++)if(0!==lt(e.elements[t].id,A[t].id)||e.elements[t].attempt!==A[t].attempt)return!1}else if(void 0!==e)return!1;return!0}};var xn;vA([ot(R,hn,ce),bA("design:type",Object)],Mn.prototype,"elements",void 0),Mn=kn=vA([he(),bA("design:paramtypes",[Array])],Mn);let Rn=xn=class extends ue{unsignedHash(){return wA.blake2b(oe(xn,this))}verifyExtrinsicHash(e){return this.extrinsicHash===e.extrinsicHash()}};var Fn;vA([ye(NA),bA("design:type",Object)],Rn.prototype,"parent",void 0),vA([ye(NA,"parent_state_root"),bA("design:type",Object)],Rn.prototype,"parentStateRoot",void 0),vA([ye(NA,"extrinsic_hash"),bA("design:type",Object)],Rn.prototype,"extrinsicHash",void 0),vA([ye(TA),bA("design:type",Object)],Rn.prototype,"slot",void 0),vA([qe(Dn,"epoch_mark"),bA("design:type",Dn)],Rn.prototype,"epochMarker",void 0),vA([qe(Mn,"tickets_mark"),bA("design:type",Mn)],Rn.prototype,"ticketsMark",void 0),vA([He(2,"author_index"),bA("design:type",Number)],Rn.prototype,"authorIndex",void 0),vA([ye($e(96),"entropy_source"),bA("design:type",Object)],Rn.prototype,"entropySource",void 0),vA([ye(On,"offenders_mark"),bA("design:type",On)],Rn.prototype,"offendersMark",void 0),Rn=xn=vA([he()],Rn);let Un=Fn=class extends Rn{constructor(e){super(),void 0!==e&&Object.assign(this,e)}signedHash(){return wA.blake2b(this.toBinary())}static sealSignContext(e,t,A){if(t.isFallback())return new Uint8Array([...L,...oe(NA,e)]);{const r=t.tickets[A.slotPhase()];return new Uint8Array([...K,...oe(NA,e),r.attempt])}}blockAuthor(e){return e.at(this.authorIndex).banderSnatch}verifySeal(e){const t=this.blockAuthor(e.p_kappa);if(!fA.verifySignature(this.seal,t,oe(Rn,this),Fn.sealSignContext(e.p_entropy_3,e.p_gamma_s,this.slot)))return!1;if(e.p_gamma_s.isFallback()){return 0===lt(e.p_gamma_s.keys[this.slot.slotPhase()],t)}return 0===lt(e.p_gamma_s.tickets[this.slot.slotPhase()].id,fA.vrfOutputSignature(this.seal))}verifyEntropy(e){const t=this.blockAuthor(e);return fA.verifySignature(this.entropySource,t,new Uint8Array([]),new Uint8Array([...H,...oe(NA,fA.vrfOutputSignature(this.seal))]))}verifyOffenders(e){return this.offendersMark.checkValidity(e)}buildNext(e,t,A,r){const n=e.kappa.toPosterior(e,{p_tau:A}),s=e.entropy.rotate1_3({slot:e.slot,p_tau:A}),o=e.safroleState.gamma_s.toPosterior({slot:e.slot,safroleState:e.safroleState,p_tau:A,p_kappa:n,p_eta2:s._2});if(!o.isKeyAllowedToProduce(r,{p_tau:A,p_entropy_3:s._3}))return Ut(Tn.KEY_NOT_ALLOWED);const i=n.bandersnatchIndex(r.public);if(-1===i)return Ut(Tn.KEY_INDEX_NOT_FOUND);const[a,g]=e.disputes.toPosterior({kappa:e.kappa,extrinsic:t.disputes,lambda:e.lambda}).safeRet();if(a)return Ut(a);const c=e.safroleState.gamma_p.toPosterior({slot:e.slot,iota:e.iota,p_tau:A,p_offenders:g.offenders}),u=Fn.sealSignContext(s._3,o,A),I=new Fn({parent:this.signedHash(),parentStateRoot:e.merkleRoot(),slot:A,authorIndex:i,ticketsMark:Mn.build({p_tau:A,tau:e.slot,gamma_a:e.safroleState.gamma_a}),extrinsicHash:t.extrinsicHash(),epochMarker:Dn.build({p_tau:A,tau:e.slot,entropy:e.entropy,p_gamma_p:c}),entropySource:fA.sign(r.private,new Uint8Array([]),new Uint8Array([...H,...oe(NA,fA.vrfOutputSeed(r.private,u))])),offendersMark:On.build(t.disputes)});return I.seal=fA.sign(r.private,oe(Rn,I),u),Ft(I)}checkValidity(e){return 0!==lt(this.parent,e.prevHeader.signedHash())?Ut(Gn.INVALID_PARENT):0!==lt(e.curState.merkleRoot(),this.parentStateRoot)?Ut(Gn.INVALID_PARENT_STATE_ROOT):!1===this.verifySeal({p_kappa:e.p_kappa,p_gamma_s:e.p_gamma_s,p_entropy_3:e.p_entropy_3})?Ut(Gn.SEAL_INVALID):!1===Dn.validate(this.epochMarker,{p_tau:this.slot,tau:e.curState.slot,entropy:e.curState.entropy,p_gamma_p:e.p_gamma_p})?Ut(Gn.INVALID_EPOCH_MARKER):!1===Mn.validate(this.ticketsMark,{p_tau:this.slot,tau:e.curState.slot,gamma_a:e.curState.safroleState.gamma_a})?Ut(Gn.INVALID_TICKET_MARKER):0!==lt(this.extrinsicHash,e.extrinsicHash)?Ut(Gn.INVALID_EXTRINSIC_HASH):!1===this.verifyEntropy(e.p_kappa)?Ut(Gn.INVALID_ENTROPY_SOURCE):!1===this.verifyOffenders(e.disputesExtrinsic)?Ut(Gn.INVALID_OFFENDERS):Ft(this)}};var Tn,Gn,jn;vA([ye($e(96)),bA("design:type",Object)],Un.prototype,"seal",void 0),Un=Fn=vA([he(),bA("design:paramtypes",[Object])],Un),function(e){e.KEY_NOT_ALLOWED="KEY_NOT_ALLOWED",e.KEY_INDEX_NOT_FOUND="KEY_INDEX_NOT_FOUND"}(Tn||(Tn={})),function(e){e.INVALID_PARENT="INVALID_PARENT",e.INVALID_PARENT_STATE_ROOT="INVALID_PARENT_STATE_ROOT",e.SEAL_INVALID="SEAL_INVALID",e.INVALID_EPOCH_MARKER="INVALID_EPOCH_MARKER",e.INVALID_TICKET_MARKER="INVALID_TICKET_MARKER",e.INVALID_EXTRINSIC_HASH="INVALID_EXTRINSIC_HASH",e.INVALID_ENTROPY_SOURCE="INVALID_ENTROPY_SOURCE",e.INVALID_OFFENDERS="INVALID_OFFENDERS"}(Gn||(Gn={}));class Hn extends ue{constructor(e){super(),Object.assign(this,e)}isFallback(){return void 0!==this.keys}toJSON(){return Hn.toJSON(this)}toBinary(){return oe(Hn,this)}isKeyAllowedToProduce(e,t){if(this.isFallback())return 0===lt(this.keys[t.p_tau.slotPhase()],e.public);return 0===lt(this.tickets[t.p_tau.slotPhase()].id,fA.vrfOutputSeed(e.private,Un.sealSignContext(t.p_entropy_3,this,t.p_tau)))}toPosterior(e){if(e.p_tau.isNextEra(e.slot)&&e.safroleState.gamma_a.length()===R&&e.slot.slotPhase()>=x){const t=Mr(e.safroleState.gamma_a.elements);return new Hn({tickets:t})}if(e.p_tau.isSameEra(e.slot))return this;{const t=[],A=oe(NA,e.p_eta2);for(let r=0;r<R;r++){const n=new Uint8Array(4);xe.encode(BigInt(r),n);const s=wA.blake2b(new Uint8Array([...A,...n])).subarray(0,4),o=xe.decode(s).value%BigInt(e.p_kappa.elements.length);t.push(e.p_kappa.elements[Number(o)].banderSnatch)}return new Hn({keys:t})}}static encode(e,t){if(e instanceof Hn==!1)throw new Error(`GammaSImpl.encode expects GammaSImpl, got ${e.constructor.name}`);return e.isFallback()?(ke.encode(1n,t),1+Hn.codecOf("keys").encode(e.keys,t.subarray(1))):(ke.encode(0n,t),1+Hn.codecOf("tickets").encode(e.tickets,t.subarray(1)))}static decode(e){const t=1n===ke.decode(e.subarray(0,1)).value,A=Hn.codecOf(t?"keys":"tickets"),{value:r,readBytes:n}=A.decode(e.subarray(1)),s=new Hn;return t?s.keys=r:s.tickets=r,{value:s,readBytes:n+1}}static encodedSize(e){if(!(e instanceof Hn))throw new Error(`GammaSImpl.encodedSize expects GammaSImpl, got ${e.constructor.name}`);return e.isFallback()?1+Hn.codecOf("keys").encodedSize(e.keys):1+Hn.codecOf("tickets").encodedSize(e.tickets)}static fromJSON(e){const t=new Hn;return void 0!==e.keys?t.keys=Hn.codecOf("keys").fromJSON(e.keys):t.tickets=Hn.codecOf("tickets").fromJSON(e.tickets),t}static toJSON(e){if(!(e instanceof Hn))throw new Error(`GammaSImpl.toJSON expects GammaSImpl, got ${e.constructor.name}`);return e.isFallback()?{keys:Hn.codecOf("keys").toJSON(e.keys)}:{tickets:Hn.codecOf("tickets").toJSON(e.tickets)}}static newEmpty(){return new Hn({keys:Array.from({length:R},()=>new Uint8Array(32).fill(0))})}}vA([ot(R,$e(32)),bA("design:type",Object)],Hn.prototype,"keys",void 0),vA([ot(R,hn),bA("design:type",Object)],Hn.prototype,"tickets",void 0);let Ln=jn=class extends ue{constructor(e){super(),Object.assign(this,e)}toPosterior(e){return e.p_tau.isNewerEra(e.slot)?new jn({root:fA.ringRoot(e.p_gamma_p.elements.map(e=>e.banderSnatch))}):this}static newEmpty(){return new jn({root:new Uint8Array(144).fill(0)})}};vA([ye($e(144),ce),bA("design:type",Object)],Ln.prototype,"root",void 0),Ln=jn=vA([he(),bA("design:paramtypes",[Object])],Ln);class Yn{constructor(e){e&&(this.elements=e)}get(e){return this.elements.get(e)}toPosterior(e){const t=new Yn(new on([...this.elements]));t.elements.set(e.header.slot,e.header);const A=[...this.elements.keys()];return A.length>G&&(A.sort((e,t)=>e.value-t.value),t.elements.delete(A[0])),t}static newEmpty(){return new Yn(new on)}}var Kn;let Jn=Kn=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}rotate1_3(e){let[t,A,r]=[this._1,this._2,this._3];return e.p_tau.isNewerEra(e.slot)&&([t,A,r]=[this._0,this._1,this._2]),new Kn({_0:this._0,_1:t,_2:A,_3:r})}toPosterior(e){const t=wA.blake2b(new Uint8Array([...oe(NA,this._0),...oe(NA,e.vrfOutputHash)]));return new Kn({_0:t,_1:this._1,_2:this._2,_3:this._3})}static fromJSON(e){return new Kn({_0:NA.fromJSON(e[0]),_1:NA.fromJSON(e[1]),_2:NA.fromJSON(e[2]),_3:NA.fromJSON(e[3])})}static toJSON(e){const t=e;return[t._0,t._1,t._2,t._3].map(e=>NA.toJSON(e))}static newEmpty(){return new Kn({_0:new Uint8Array(32).fill(0),_1:new Uint8Array(32).fill(0),_2:new Uint8Array(32).fill(0),_3:new Uint8Array(32).fill(0)})}};var Pn;vA([ye(NA),bA("design:type",Object)],Jn.prototype,"_0",void 0),vA([ye(NA),bA("design:type",Object)],Jn.prototype,"_1",void 0),vA([ye(NA),bA("design:type",Object)],Jn.prototype,"_2",void 0),vA([ye(NA),bA("design:type",Object)],Jn.prototype,"_3",void 0),Jn=Kn=vA([he(!0),bA("design:paramtypes",[Object])],Jn);let Vn=class extends ue{constructor(e){super(),Object.assign(this,e)}};vA([He(4),bA("design:type",Number)],Vn.prototype,"serviceIndex",void 0),vA([ye(NA),bA("design:type",Object)],Vn.prototype,"accumulationResult",void 0),Vn=vA([he(),bA("design:paramtypes",[Object])],Vn);let Xn=Pn=class extends ue{constructor(e){super(),this.elements=void 0!==e?e:[]}add(e,t){this.elements.push(new Vn({serviceIndex:e,accumulationResult:t}))}static union(e,t){return new Pn([...new Set([...e.elements,...t.elements]).values()])}static newEmpty(){return new Pn([])}merkleRoot(){return cr([...this.elements].sort((e,t)=>e.serviceIndex-t.serviceIndex).map(e=>e.toBinary()),wA.keccak256)}};vA([nt(Vn,ce),bA("design:type",Array)],Xn.prototype,"elements",void 0),Xn=Pn=vA([he(),bA("design:paramtypes",[Array])],Xn);class zn{constructor(e){Object.assign(this,e)}isTransfer(){return void 0!==this.transfer}isOperand(){return void 0!==this.operand}static decode(e){const{value:t,readBytes:A}=qn.decode(e);return{value:new zn(t),readBytes:A}}static encode(e,t){return qn.encode(e,t)}static encodedSize(e){return qn.encodedSize(e)}}const qn=gt([["transfer",vr],["operand",Lr]]),Wn=(e,t,A)=>{const r=e.instructionPointer,n=e;let s;for(let e=0;e<A.length&&void 0===s;e++){const o=A[e];if("ip"===o.type)n.instructionPointer=o.data;else if("gas"===o.type)n.gas=n.gas-o.data;else if("exit"===o.type)s=o.data;else if("register"===o.type)n.registers.elements[o.data.index]=new en(o.data.value);else if("memory"===o.type){const e=n.memory.firstUnwriteable(o.data.from,o.data.data.length);if(void 0===e)n.memory.setBytes(o.data.from,o.data.data);else{const A=Wn(n,t,[...kr.pageFault(e,r)]);void 0!==A&&(s=A)}}else if("object"===o.type)for(const e of Object.keys(o.data))t[e]=o.data[e]}return s};function Zn(e,t){return t.has(e)?Zn((e-256+1)%(2**32-512)+256,t):e}const $n=65536,es=2**24,ts=ie([["roDataLength",Fe(3)],["rwDataLength",Fe(3)],["rwDataPaddingPages",Fe(2)],["stackSize",Fe(3)]]),As=e=>Ae*Math.ceil(Number(e)/Ae),rs=e=>$n*Math.ceil(Number(e)/$n);class ns{constructor(e){Object.assign(this,e)}}const ss=(e,t,A)=>A?e.program.isBlockBeginning(t)?[kr.ip(t)]:[kr.ip(e.execution.instructionPointer),kr.panic()]:[],os=(e,t)=>4294901760==t?[kr.ip(e.execution.instructionPointer),kr.halt()]:0===t||t>2*e.program.rawProgram.j.length||t%2!=0?[kr.ip(e.execution.instructionPointer),kr.panic()]:[kr.ip(e.program.rawProgram.j[t/2-1])],is=(e,A)=>{if(t(e>=0,"n in Z(n) must be positive"),0==e)return 0n;const r=2n**(8n*BigInt(e)-1n);return A>=r?A-2n*r:A},as=e=>Number(is(4,BigInt(e))),gs=e=>is(8,BigInt(e)),cs=e=>((e,A)=>(t(e>=0,"n in Z_inv(n) must be positive"),(2n**(8n*BigInt(e))+A)%2n**(8n*BigInt(e))))(8,BigInt(e)),us=(e,A)=>{t(A<=8&&A>=0,"length must be <= 8 and >= 0");const r=Oe(A).decode(e.subarray(0,A)).value,n=BigInt(A);return 0n===n?r:Sr(n)(r)},Is=()=>({}),ds=e=>{let A=0;const r=Math.min(4,e[0]%8);A+=1,t(e.length>=A+r+(0==r?1:0),"not enough bytes");const n=Number(us(e.subarray(A,A+r),r));A+=r;const s=Math.min(4,Math.max(0,e.length-A));return{vX:n,vY:us(e.subarray(1+r,1+r+s),s)}},ps=e=>{t(e.length>0,"no input bytes");const A=Math.min(12,e[0]%16),r=Math.min(4,Math.max(0,e.length-1));return{rA:A,vX:us(e.subarray(1),r)}},ls=e=>{const A=Math.min(12,e[0]%16),r=Math.min(4,Math.floor(e[0]/16)%8);t(e.length>=r+1,"not enough bytes");const n=Math.min(4,Math.max(0,e.length-1-r));return{rA:A,vX:us(e.subarray(1,1+r),r),vY:us(e.subarray(1+r),n)}},ys=e=>{t(e.length>0,"no input bytes");const A=Math.min(12,e[0]%16),r=Math.min(4,Math.floor(e[0]/16)%8);t(e.length>=r+1,"not enough bytes");const n=Math.min(4,Math.max(0,e.length-1-r));return{rA:A,vX:us(e.subarray(1,1+r),r),ipOffsetRaw:Number(is(n,Oe(n).decode(e.subarray(1+r,1+r+n)).value))}},hs=e=>{t(e.length>0,"no input bytes");return{rD:Math.min(12,e[0]%16),rA:Math.min(12,Math.floor(e[0]/16))}},Cs=e=>{const t=Math.min(12,e[0]%16),A=Math.min(12,Math.floor(e[0]/16)),r=Math.min(4,Math.max(0,e.length-1));return{rA:t,rB:A,vX:us(e.subarray(1,1+r),r)}},Es=e=>{const t=Math.min(12,e[0]%16),A=Math.min(12,Math.floor(e[0]/16)),r=Math.min(4,Math.max(0,e.length-1));return{rA:t,rB:A,ipOffsetRaw:Number(is(r,Oe(r).decode(e.subarray(1,1+r)).value))}},ms=e=>{t(e.length>=2,"not enough bytes (2)");return{rA:Math.min(12,e[0]%16),rB:Math.min(12,Math.floor(e[0]/16)),rD:Math.min(12,e[1])}};const Bs={byCode:new Map,byIdentifier:new Map,blockTerminators:new Set},Qs=(e,t)=>(A,r,n)=>(((e,t=!1)=>{if(Bs.byCode.has(e.opCode))throw new Error(`duplicate opCode ${e.opCode}`);if(Bs.byIdentifier.has(e.identifier))throw new Error(`duplicate identifier ${e.identifier}`);Bs.byCode.set(e.opCode,e),Bs.byIdentifier.set(e.identifier,e),t&&Bs.blockTerminators.add(e.opCode)})({opCode:e,identifier:r,decode:t,evaluate:function(e,t){return n.value.call(this,(r=t,"rA"in(A=e)&&(A.wA=r.execution.registers.elements[A.rA].value),"rB"in A&&(A.wB=r.execution.registers.elements[A.rB].value),"rD"in A&&(A.wD=r.execution.registers.elements[A.rD].value),"ipOffsetRaw"in A&&(A.ipOffset=r.execution.instructionPointer+A.ipOffsetRaw),A),t);var A,r},gasCost:1n},n.isBlockTermination),n),fs=(e,t,A)=>(A.isBlockTermination=!0,A);class _s{trap(e,t){return[kr.ip(t.execution.instructionPointer),kr.panic()]}fallthrough(e,t){return[kr.ip(t.execution.instructionPointer+1)]}ecalli({vX:e}){return[kr.hostCall(e)]}load_imm_64({rA:e,vX:t}){return[kr.reg(e,t)]}store_imm_u8({vX:e,vY:t}){return[kr.memory(e,new Uint8Array([Number(t%256n)]))]}store_imm_u16({vX:e,vY:t}){return[kr.memory(e,oe(Me,t%65536n))]}store_imm_u32({vX:e,vY:t}){return[kr.memory(e,oe(xe,t%2n**32n))]}store_imm_u64({vX:e,vY:t}){return[kr.memory(e,oe(Re,BigInt(t)))]}jump({ipOffset:e},t){return ss(t,e,!0)}jump_ind({wA:e,vX:t},A){const r=Number((e+t)%2n**32n);return[...os(A,r)]}load_imm({rA:e,vX:t}){return[kr.reg(e,t)]}load_u8({rA:e,vX:t},A){const r=$r(t);return A.execution.memory.canRead(r,1)?[kr.reg(e,A.execution.memory.getBytes(r,1)[0])]:ws(A.execution.memory.firstUnreadable(r,1),A.execution)}load_u16({rA:e,vX:t},A){const r=$r(t);return A.execution.memory.canRead(r,2)?[kr.reg(e,Te.decode(A.execution.memory.getBytes(r,2)).value)]:ws(A.execution.memory.firstUnreadable(r,2),A.execution)}load_u32({rA:e,vX:t},A){const r=$r(t);return A.execution.memory.canRead(r,4)?[kr.reg(e,Ge.decode(A.execution.memory.getBytes(r,4)).value)]:ws(A.execution.memory.firstUnreadable(r,4),A.execution)}load_u64({rA:e,vX:t},A){const r=$r(t);return A.execution.memory.canRead(r,8)?[kr.reg(e,Re.decode(A.execution.memory.getBytes(r,8)).value)]:ws(A.execution.memory.firstUnreadable(r,8),A.execution)}load_i8({rA:e,vX:t},A){const r=$r(t);return A.execution.memory.canRead(r,1)?[kr.reg(e,Sr(1n)(BigInt(A.execution.memory.getBytes(r,1)[0])))]:ws(A.execution.memory.firstUnreadable(r,1),A.execution)}load_i16({rA:e,vX:t},A){const r=$r(t);return A.execution.memory.canRead(r,2)?[kr.reg(e,Sr(2n)(Me.decode(A.execution.memory.getBytes(r,2)).value))]:ws(A.execution.memory.firstUnreadable(r,2),A.execution)}load_i32({rA:e,vX:t},A){const r=$r(t);return A.execution.memory.canRead(r,4)?[kr.reg(e,Dr(xe.decode(A.execution.memory.getBytes(r,4)).value))]:ws(A.execution.memory.firstUnreadable(r,4),A.execution)}store_u8({wA:e,vX:t}){return[kr.memory(t,new Uint8Array([Number(e%256n)]))]}store_u16({wA:e,vX:t}){return[kr.memory(t,oe(Me,e%65536n))]}store_u32({wA:e,vX:t}){return[kr.memory(t,oe(xe,e%2n**32n))]}store_u64({wA:e,vX:t}){return[kr.memory(t,oe(Re,e))]}store_imm_ind_u8({wA:e,vX:t,vY:A}){const r=e+t;return[kr.memory($r(r),new Uint8Array([Number(A%0xffn)]))]}store_imm_ind_u16({wA:e,vX:t,vY:A}){const r=e+t;return[kr.memory($r(r),oe(Me,A%65536n))]}store_imm_ind_u32({wA:e,vX:t,vY:A}){const r=e+t;return[kr.memory($r(r),oe(xe,A%2n**32n))]}store_imm_ind_u64({wA:e,vX:t,vY:A}){const r=e+t;return[kr.memory($r(r),oe(Re,A))]}load_imm_jump({rA:e,vX:t,ipOffset:A},r){return[kr.reg(e,t),...ss(r,A,!0)]}branch_eq_imm({wA:e,vX:t,ipOffset:A},r){return ss(r,A,e===t)}branch_ne_imm({vX:e,ipOffset:t,wA:A},r){return ss(r,t,A!=e)}branch_lt_u_imm({vX:e,ipOffset:t,wA:A},r){return ss(r,t,A<e)}branch_le_u_imm({vX:e,ipOffset:t,wA:A},r){return ss(r,t,A<=e)}branch_ge_u_imm({vX:e,ipOffset:t,wA:A},r){return ss(r,t,A>=e)}branch_gt_u_imm({vX:e,ipOffset:t,wA:A},r){return ss(r,t,A>e)}branch_lt_s_imm({vX:e,ipOffset:t,wA:A},r){return ss(r,t,is(8,A)<is(8,e))}branch_le_s_imm({vX:e,ipOffset:t,wA:A},r){return ss(r,t,is(8,A)<=is(8,e))}branch_ge_s_imm({vX:e,ipOffset:t,wA:A},r){return ss(r,t,is(8,A)>=is(8,e))}branch_gt_s_imm({vX:e,ipOffset:t,wA:A},r){return ss(r,t,is(8,A)>is(8,e))}move_reg({rD:e,wA:t}){return[kr.reg(e,t)]}sbrk({rD:e,wA:t},A){const r=Number(t),n=A.execution.memory.heap.pointer;if(0===r)return[kr.reg(e,n)];const s=A.execution.memory.firstWriteableInHeap(Number(t));return[kr.reg(e,s)]}count_set_bits_64({rD:e,wA:t}){let A=0n,r=t;for(let e=0;e<64;e++)A+=1n&r,r>>=1n;return[kr.reg(e,A)]}count_set_bits_32({rD:e,wA:t}){let A=0n,r=t%2n**32n;for(let e=0;e<32;e++)A+=1n&r,r>>=1n;return[kr.reg(e,A)]}leading_zero_bits_64({rD:e,wA:t}){const A=t;let r=0n;for(let e=0;e<64&&!(A&1n<<63n-BigInt(e));e++)r++;return[kr.reg(e,r)]}leading_zero_bits_32({rD:e,wA:t}){const A=t%2n**32n;let r=0n;for(let e=0;e<32&&!(A&1n<<31n-BigInt(e));e++)r++;return[kr.reg(e,r)]}trailing_zero_bits_64({rD:e,wA:t}){const A=t;let r=0n;for(let e=0;e<64&&!(A&1n<<BigInt(e));e++)r++;return[kr.reg(e,r)]}trailing_zero_bits_32({rD:e,wA:t}){const A=t%2n**32n;let r=0n;for(let e=0;e<32&&!(A&1n<<BigInt(e));e++)r++;return[kr.reg(e,r)]}sign_extend_8({rD:e,wA:t}){return[kr.reg(e,cs(is(1,t%256n)))]}sign_extend_16({rD:e,wA:t}){return[kr.reg(e,cs(is(2,t%65536n)))]}zero_extend_16({rD:e,wA:t}){return[kr.reg(e,t%65536n)]}reverse_bytes({rD:e,wA:t}){let A=0n;const r=t;for(let e=0;e<8;e++)A|=(r>>BigInt(8*e)&0xffn)<<BigInt(8*(7-e));return[kr.reg(e,A)]}load_imm_jump_ind(e,t){return[kr.reg(e.rA,e.vX),...os(t,Number((e.wB+e.vY)%2n**32n))]}branch_eq({wA:e,wB:t,ipOffset:A},r){return ss(r,A,e===t)}branch_ne({wA:e,wB:t,ipOffset:A},r){return ss(r,A,e!==t)}branch_lt_u({wA:e,wB:t,ipOffset:A},r){return ss(r,A,e<t)}branch_lt_s({wA:e,wB:t,ipOffset:A},r){return ss(r,A,is(8,e)<is(8,t))}branch_ge_u({wA:e,wB:t,ipOffset:A},r){return ss(r,A,e>=t)}branch_ge_s({wA:e,wB:t,ipOffset:A},r){return ss(r,A,is(8,e)>=is(8,t))}store_ind_u8({wB:e,vX:t,wA:A}){const r=$r(e+t);return[kr.memory(r,new Uint8Array([Number(0xffn&A)]))]}store_ind_u16({wA:e,wB:t,vX:A}){const r=$r(t+A);return[kr.memory(r,oe(Me,0xffffn&e))]}store_ind_u32({wA:e,wB:t,vX:A}){const r=$r(t+A),n=new Uint8Array(4);return xe.encode(BigInt(e%2n**32n),n),[kr.memory(r,n)]}store_ind_u64({wA:e,wB:t,vX:A}){const r=$r(t+A);return[kr.memory(r,oe(Re,e))]}load_ind_u8({rA:e,wB:t,vX:A},r){const n=$r(t+A);return r.execution.memory.canRead(n,1)?[kr.reg(e,r.execution.memory.getBytes(n,1)[0])]:ws(r.execution.memory.firstUnreadable(n,1),r.execution)}load_ind_u16({rA:e,wB:t,vX:A},r){const n=$r(t+A);if(!r.execution.memory.canRead(n,2))return ws(r.execution.memory.firstUnreadable(n,2),r.execution);const s=r.execution.memory.getBytes(n,2);return[kr.reg(e,Me.decode(s).value)]}load_ind_u32({rA:e,wB:t,vX:A},r){const n=$r(t+A);if(!r.execution.memory.canRead(n,4))return ws(r.execution.memory.firstUnreadable(n,4),r.execution);const s=r.execution.memory.getBytes(n,4);return[kr.reg(e,xe.decode(s).value)]}load_ind_u64({rA:e,wB:t,vX:A},r){const n=$r(t+A);if(!r.execution.memory.canRead(n,8))return ws(r.execution.memory.firstUnreadable(n,8),r.execution);const s=r.execution.memory.getBytes(n,8);return[kr.reg(e,Re.decode(s).value)]}load_ind_i8({rA:e,wB:t,vX:A},r){const n=$r(t+A);if(!r.execution.memory.canRead(n,1))return ws(r.execution.memory.firstUnreadable(n,1),r.execution);const s=r.execution.memory.getBytes(n,1),o=cs(is(1,BigInt(s[0])));return[kr.reg(e,o)]}load_ind_i16({rA:e,wB:t,vX:A},r){const n=$r(t+A);if(!r.execution.memory.canRead(n,2))return ws(r.execution.memory.firstUnreadable(n,2),r.execution);const s=r.execution.memory.getBytes(n,2),o=Me.decode(s).value;return[kr.reg(e,cs(is(2,o)))]}load_ind_i32({rA:e,wB:t,vX:A},r){const n=$r(t+A);if(!r.execution.memory.canRead(n,4))return ws(r.execution.memory.firstUnreadable(n,4),r.execution);const s=r.execution.memory.getBytes(n,4),o=xe.decode(s).value;return[kr.reg(e,cs(is(4,o)))]}add_imm_32({rA:e,wB:t,vX:A}){return[kr.reg(e,Dr((t+A)%2n**32n))]}and_imm({rA:e,wB:t,vX:A}){return[kr.reg(e,t&BigInt(A))]}xor_imm({rA:e,wB:t,vX:A}){return[kr.reg(e,t^BigInt(A))]}or_imm({rA:e,wB:t,vX:A}){return[kr.reg(e,t|BigInt(A))]}mul_imm_32({rA:e,wB:t,vX:A}){return[kr.reg(e,t*BigInt(A)%2n**32n)]}set_lt_u_imm({rA:e,wB:t,vX:A}){return[kr.reg(e,t<A?1:0)]}set_lt_s_imm({rA:e,wB:t,vX:A}){return[kr.reg(e,gs(t)<gs(BigInt(A))?1:0)]}shlo_l_imm_32({rA:e,wB:t,vX:A}){return[kr.reg(e,Dr((t<<A%32n)%2n**32n))]}shlo_r_imm_32({rA:e,wB:t,vX:A}){const r=Number(t%2n**32n);return[kr.reg(e,Dr(BigInt(r>>>Number(A%32n))))]}shar_r_imm_32({rA:e,wB:t,vX:A}){const r=Number(t%2n**32n);return[kr.reg(e,cs(BigInt(as(r)>>Number(A%32n))))]}neg_add_imm_32({rA:e,wB:t,vX:A}){let r=(A+2n**32n-t)%2n**32n;return r<0n&&(r+=2n**32n),[kr.reg(e,Dr(r))]}set_gt_u_imm({rA:e,wB:t,vX:A}){return[kr.reg(e,t>A?1:0)]}set_gt_s_imm({rA:e,wB:t,vX:A}){return[kr.reg(e,gs(t)>gs(BigInt(A))?1:0)]}shlo_l_imm_alt_32({rA:e,wB:t,vX:A}){return[kr.reg(e,Dr((A<<t%32n)%2n**32n))]}shlo_r_imm_alt_32({rA:e,wB:t,vX:A}){return[kr.reg(e,Number(A)>>>Number(t%32n))]}shar_r_imm_alt_32({rA:e,wB:t,vX:A}){return[kr.reg(e,cs(BigInt(as(A%2n**32n))>>t%32n))]}cmov_iz_imm({rA:e,wB:t,vX:A}){return 0n===t?[kr.reg(e,A)]:[]}cmov_nz_imm({rA:e,wB:t,vX:A}){return 0n!==t?[kr.reg(e,A)]:[]}add_imm_64({rA:e,wB:t,vX:A}){return[kr.reg(e,(t+BigInt(A))%2n**64n)]}mul_imm_64({rA:e,wB:t,vX:A}){return[kr.reg(e,t*BigInt(A)%2n**64n)]}shlo_l_imm_64({rA:e,wB:t,vX:A}){return[kr.reg(e,Nr((t<<BigInt(A%64n))%2n**64n))]}shlo_r_imm_64({rA:e,wB:t,vX:A}){return[kr.reg(e,Nr(t/2n**(BigInt(A)%64n)))]}shar_r_imm_64({rA:e,wB:t,vX:A}){const r=gs(t),n=2n**(BigInt(A)%64n);let s=r/n;return r<0n&&n>0n&&r%n!==0n&&(s-=1n),[kr.reg(e,cs(s))]}neg_add_imm_64({rA:e,wB:t,vX:A}){return[kr.reg(e,(BigInt(A)+2n**64n-t)%2n**64n)]}shlo_l_imm_alt_64({rA:e,wB:t,vX:A}){return[kr.reg(e,(BigInt(A)<<t%64n)%2n**64n)]}shlo_r_imm_alt_64({rA:e,wB:t,vX:A}){return[kr.reg(e,BigInt(A)/2n**(t%64n)%2n**64n)]}shar_r_imm_alt_64({rA:e,wB:t,vX:A}){return[kr.reg(e,cs(gs(BigInt(A))>>t%64n))]}rot_r_64_imm({rA:e,wB:t,vX:A}){const r=A%64n,n=t>>r|t<<64n-r&2n**64n-1n;return[kr.reg(e,n)]}rot_r_64_imm_alt({rA:e,wB:t,vX:A}){const r=t%64n,n=A>>r|A<<64n-r&2n**64n-1n;return[kr.reg(e,n)]}rot_r_32_imm({rA:e,wB:t,vX:A}){const r=A%32n,n=t%2n**32n,s=n>>r|n<<32n-r&2n**32n-1n;return[kr.reg(e,Dr(s))]}rot_r_32_imm_alt({rA:e,wB:t,vX:A}){const r=t%32n,n=A%2n**32n,s=n>>r|n<<32n-r&2n**32n-1n;return[kr.reg(e,Dr(s))]}add_32({wA:e,wB:t,rD:A}){return[kr.reg(A,Dr((e+t)%2n**32n))]}sub_32({wA:e,wB:t,rD:A}){return[kr.reg(A,Dr((e+2n**32n-t%2n**32n)%2n**32n))]}mul_32({wA:e,wB:t,rD:A}){return[kr.reg(A,Dr(e*t%2n**32n))]}div_u_32({wA:e,wB:t,rD:A}){return t%2n**32n===0n?[kr.reg(A,2n**64n-1n)]:[kr.reg(A,e/t)]}div_s_32({wA:e,wB:t,rD:A}){const r=as(e%2n**32n),n=as(t%2n**32n);let s;return s=0===n?2n**64n-1n:cs(r==-1*2**31&&-1===n?BigInt(r):BigInt(Math.trunc(r/n))),[kr.reg(A,s)]}rem_u_32({wA:e,wB:t,rD:A}){let r;return r=Dr(t%2n**32n===0n?e%2n**32n:e%2n**32n%(t%2n**32n)),[kr.reg(A,r)]}rem_s_32({wA:e,wB:t,rD:A}){const r=as(e%2n**32n),n=as(t%2n**32n);let s;return s=r===-1*2**31&&-1===n?0:cs(Or(BigInt(r),BigInt(n))),[kr.reg(A,s)]}shlo_l_32({wA:e,wB:t,rD:A}){return[kr.reg(A,Dr((e<<t%32n)%2n**32n))]}shlo_r_32({wA:e,wB:t,rD:A}){const r=Number(e%2n**32n),n=Number(t%2n**32n);return[kr.reg(A,Dr(BigInt(r>>>n)))]}shar_r_32({wA:e,wB:t,rD:A}){const r=as(e%2n**32n);return[kr.reg(A,cs(BigInt(Math.floor(r/2**Number(t%32n)))))]}add_64({wA:e,wB:t,rD:A}){return[kr.reg(A,(e+t)%2n**64n)]}sub_64({wA:e,wB:t,rD:A}){return[kr.reg(A,(e+2n**64n-t)%2n**64n)]}mul_64({wA:e,wB:t,rD:A}){return[kr.reg(A,e*t%2n**64n)]}div_u_64({wA:e,wB:t,rD:A}){return 0n===t?[kr.reg(A,2n**64n-1n)]:[kr.reg(A,e/t)]}div_s_64({wA:e,wB:t,rD:A}){const r=gs(e),n=gs(t);let s;return s=0n===t?2n**64n-1n:r==-1n*2n**63n&&-1n===n?e:cs(r/n),[kr.reg(A,s)]}rem_u_64({wA:e,wB:t,rD:A}){let r;return r=0n===t?e:e%t,[kr.reg(A,r)]}rem_s_64({wA:e,wB:t,rD:A}){const r=gs(e),n=gs(t);let s;return s=r===-1n*2n**63n&&-1n===n?0:cs(Or(r,n)),[kr.reg(A,s)]}shlo_l_64({wA:e,wB:t,rD:A}){return[kr.reg(A,(e<<t%64n)%2n**64n)]}shlo_r_64({wA:e,wB:t,rD:A}){return[kr.reg(A,e/2n**(t%64n))]}shar_r_64({wA:e,wB:t,rD:A}){const r=gs(e),n=2n**(t%64n);let s=r/n;return r<0n&&n>0n&&r%n!==0n&&(s-=1n),[kr.reg(A,cs(s))]}and({wA:e,wB:t,rD:A}){return[kr.reg(A,e&t)]}xor({wA:e,wB:t,rD:A}){return[kr.reg(A,e^t)]}or({wA:e,wB:t,rD:A}){return[kr.reg(A,e|t)]}mul_upper_s_s({wA:e,wB:t,rD:A}){return[kr.reg(A,cs(gs(e)*gs(t)/2n**64n))]}mul_upper_u_u({wA:e,wB:t,rD:A}){return[kr.reg(A,e*t/2n**64n)]}mul_upper_s_u({wA:e,wB:t,rD:A}){const r=gs(e)*t;let n=r/2n**64n;return n<0n&&r%2n**64n!==0n&&n--,[kr.reg(A,cs(n))]}set_lt_u({wA:e,wB:t,rD:A}){return[kr.reg(A,e<t?1:0)]}set_lt_s({wA:e,wB:t,rD:A}){const r=gs(e),n=gs(t);return[kr.reg(A,r<n?1:0)]}cmov_iz({wA:e,wB:t,rD:A}){return 0n===t?[kr.reg(A,e)]:[]}cmov_nz({wA:e,wB:t,rD:A}){return 0n!==t?[kr.reg(A,e)]:[]}rot_l_64({wA:e,wB:t,rD:A}){const r=63n&t,n=(e<<r|e>>64n-r)&2n**64n-1n;return[kr.reg(A,n)]}rot_l_32({wA:e,wB:t,rD:A}){const r=e%2n**32n,n=31n&t,s=(r<<n|r>>32n-n)&2n**32n-1n;return[kr.reg(A,Dr(s))]}rot_r_64({wA:e,wB:t,rD:A}){const r=63n&t,n=(e>>r|e<<64n-r)&2n**64n-1n;return[kr.reg(A,n)]}rot_r_32({wA:e,wB:t,rD:A}){const r=e%2n**32n,n=31n&t,s=(r>>n|r<<32n-n)&2n**32n-1n;return[kr.reg(A,Dr(s))]}and_inv({wA:e,wB:t,rD:A}){return[kr.reg(A,e&~t)]}or_inv({wA:e,wB:t,rD:A}){return[kr.reg(A,(2n**64n+(e|~t))%2n**64n)]}xnor({wA:e,wB:t,rD:A}){return[kr.reg(A,(2n**64n+(e^~t))%2n**64n)]}max({wA:e,wB:t,rD:A}){const r=gs(e),n=gs(t);return[kr.reg(A,r>n?e:t)]}max_u({wA:e,wB:t,rD:A}){return[kr.reg(A,e>t?e:t)]}min({wA:e,wB:t,rD:A}){const r=gs(e),n=gs(t);return[kr.reg(A,r<n?e:t)]}min_u({wA:e,wB:t,rD:A}){return[kr.reg(A,e<t?e:t)]}}vA([Qs(0,Is),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"trap",null),vA([Qs(1,Is),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"fallthrough",null),vA([Qs(10,e=>{const A=Math.min(4,e.length),r=us(e,A);return t(r<=255n,"value is too large"),{vX:Number(us(e,A))}}),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"ecalli",null),vA([Qs(20,e=>{t(e.length>0,"no input bytes");return{rA:Math.min(12,e[0]%16),vX:Re.decode(e.subarray(1,9)).value}}),fs,bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"load_imm_64",null),vA([Qs(30,ds),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"store_imm_u8",null),vA([Qs(31,ds),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"store_imm_u16",null),vA([Qs(32,ds),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"store_imm_u32",null),vA([Qs(33,ds),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"store_imm_u64",null),vA([Qs(40,e=>{const t=Math.min(4,e.length);return{ipOffsetRaw:Number(is(t,Oe(t).decode(e.subarray(0,t)).value))}}),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"jump",null),vA([Qs(50,ps),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"jump_ind",null),vA([Qs(51,ps),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"load_imm",null),vA([Qs(52,ps),bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"load_u8",null),vA([Qs(54,ps),bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"load_u16",null),vA([Qs(56,ps),bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"load_u32",null),vA([Qs(58,ps),bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"load_u64",null),vA([Qs(53,ps),bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"load_i8",null),vA([Qs(55,ps),bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"load_i16",null),vA([Qs(57,ps),bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"load_i32",null),vA([Qs(59,ps),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"store_u8",null),vA([Qs(60,ps),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"store_u16",null),vA([Qs(61,ps),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"store_u32",null),vA([Qs(62,ps),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"store_u64",null),vA([Qs(70,ls),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"store_imm_ind_u8",null),vA([Qs(71,ls),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"store_imm_ind_u16",null),vA([Qs(72,ls),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"store_imm_ind_u32",null),vA([Qs(73,ls),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"store_imm_ind_u64",null),vA([Qs(80,ys),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"load_imm_jump",null),vA([Qs(81,ys),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"branch_eq_imm",null),vA([Qs(82,ys),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"branch_ne_imm",null),vA([Qs(83,ys),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"branch_lt_u_imm",null),vA([Qs(84,ys),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"branch_le_u_imm",null),vA([Qs(85,ys),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"branch_ge_u_imm",null),vA([Qs(86,ys),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"branch_gt_u_imm",null),vA([Qs(87,ys),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"branch_lt_s_imm",null),vA([Qs(88,ys),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"branch_le_s_imm",null),vA([Qs(89,ys),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"branch_ge_s_imm",null),vA([Qs(90,ys),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"branch_gt_s_imm",null),vA([Qs(100,hs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"move_reg",null),vA([Qs(101,hs),bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"sbrk",null),vA([Qs(102,hs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"count_set_bits_64",null),vA([Qs(103,hs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"count_set_bits_32",null),vA([Qs(104,hs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"leading_zero_bits_64",null),vA([Qs(105,hs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"leading_zero_bits_32",null),vA([Qs(106,hs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"trailing_zero_bits_64",null),vA([Qs(107,hs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"trailing_zero_bits_32",null),vA([Qs(108,hs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"sign_extend_8",null),vA([Qs(109,hs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"sign_extend_16",null),vA([Qs(110,hs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"zero_extend_16",null),vA([Qs(111,hs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"reverse_bytes",null),vA([Qs(180,e=>{const A=Math.min(12,e[0]%16),r=Math.min(12,Math.floor(e[0]/16));t(e.length>=2,"not enough bytes [1]");const n=Math.min(4,e[1]%8),s=Math.min(4,Math.max(0,e.length-2-n));t(e.length>=2+n,"not enough bytes [2]");return{vX:us(e.subarray(2,2+n),n),vY:us(e.subarray(2+n,2+n+s),s),rA:A,rB:r}}),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"load_imm_jump_ind",null),vA([Qs(170,Es),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"branch_eq",null),vA([Qs(171,Es),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"branch_ne",null),vA([Qs(172,Es),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"branch_lt_u",null),vA([Qs(173,Es),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"branch_lt_s",null),vA([Qs(174,Es),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"branch_ge_u",null),vA([Qs(175,Es),fs,bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"branch_ge_s",null),vA([Qs(120,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"store_ind_u8",null),vA([Qs(121,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"store_ind_u16",null),vA([Qs(122,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"store_ind_u32",null),vA([Qs(123,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"store_ind_u64",null),vA([Qs(124,Cs),bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"load_ind_u8",null),vA([Qs(126,Cs),bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"load_ind_u16",null),vA([Qs(128,Cs),bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"load_ind_u32",null),vA([Qs(130,Cs),bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"load_ind_u64",null),vA([Qs(125,Cs),bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"load_ind_i8",null),vA([Qs(127,Cs),bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"load_ind_i16",null),vA([Qs(129,Cs),bA("design:type",Function),bA("design:paramtypes",[Object,ns]),bA("design:returntype",void 0)],_s.prototype,"load_ind_i32",null),vA([Qs(131,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"add_imm_32",null),vA([Qs(132,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"and_imm",null),vA([Qs(133,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"xor_imm",null),vA([Qs(134,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"or_imm",null),vA([Qs(135,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"mul_imm_32",null),vA([Qs(136,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"set_lt_u_imm",null),vA([Qs(137,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"set_lt_s_imm",null),vA([Qs(138,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shlo_l_imm_32",null),vA([Qs(139,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shlo_r_imm_32",null),vA([Qs(140,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shar_r_imm_32",null),vA([Qs(141,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"neg_add_imm_32",null),vA([Qs(142,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"set_gt_u_imm",null),vA([Qs(143,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"set_gt_s_imm",null),vA([Qs(144,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shlo_l_imm_alt_32",null),vA([Qs(145,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shlo_r_imm_alt_32",null),vA([Qs(146,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shar_r_imm_alt_32",null),vA([Qs(147,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"cmov_iz_imm",null),vA([Qs(148,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"cmov_nz_imm",null),vA([Qs(149,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"add_imm_64",null),vA([Qs(150,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"mul_imm_64",null),vA([Qs(151,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shlo_l_imm_64",null),vA([Qs(152,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shlo_r_imm_64",null),vA([Qs(153,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shar_r_imm_64",null),vA([Qs(154,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"neg_add_imm_64",null),vA([Qs(155,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shlo_l_imm_alt_64",null),vA([Qs(156,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shlo_r_imm_alt_64",null),vA([Qs(157,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shar_r_imm_alt_64",null),vA([Qs(158,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"rot_r_64_imm",null),vA([Qs(159,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"rot_r_64_imm_alt",null),vA([Qs(160,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"rot_r_32_imm",null),vA([Qs(161,Cs),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"rot_r_32_imm_alt",null),vA([Qs(190,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"add_32",null),vA([Qs(191,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"sub_32",null),vA([Qs(192,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"mul_32",null),vA([Qs(193,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"div_u_32",null),vA([Qs(194,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"div_s_32",null),vA([Qs(195,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"rem_u_32",null),vA([Qs(196,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"rem_s_32",null),vA([Qs(197,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shlo_l_32",null),vA([Qs(198,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shlo_r_32",null),vA([Qs(199,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shar_r_32",null),vA([Qs(200,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"add_64",null),vA([Qs(201,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"sub_64",null),vA([Qs(202,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"mul_64",null),vA([Qs(203,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"div_u_64",null),vA([Qs(204,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"div_s_64",null),vA([Qs(205,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"rem_u_64",null),vA([Qs(206,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"rem_s_64",null),vA([Qs(207,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shlo_l_64",null),vA([Qs(208,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shlo_r_64",null),vA([Qs(209,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"shar_r_64",null),vA([Qs(210,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"and",null),vA([Qs(211,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"xor",null),vA([Qs(212,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"or",null),vA([Qs(213,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"mul_upper_s_s",null),vA([Qs(214,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"mul_upper_u_u",null),vA([Qs(215,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"mul_upper_s_u",null),vA([Qs(216,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"set_lt_u",null),vA([Qs(217,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"set_lt_s",null),vA([Qs(218,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"cmov_iz",null),vA([Qs(219,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"cmov_nz",null),vA([Qs(220,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"rot_l_64",null),vA([Qs(221,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"rot_l_32",null),vA([Qs(222,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"rot_r_64",null),vA([Qs(223,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"rot_r_32",null),vA([Qs(224,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"and_inv",null),vA([Qs(225,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"or_inv",null),vA([Qs(226,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"xnor",null),vA([Qs(227,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"max",null),vA([Qs(228,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"max_u",null),vA([Qs(229,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"min",null),vA([Qs(230,ms),bA("design:type",Function),bA("design:paramtypes",[Object]),bA("design:returntype",void 0)],_s.prototype,"min_u",null);const ws=(e,t)=>e<65536?[kr.panic()]:kr.pageFault(Ae*Math.floor(e%Ae),t.instructionPointer);var vs,bs,Ss,Ds;class Ns{constructor(e){this.rawProgram=e,vs.set(this,void 0),bs.set(this,void 0),Ss.set(this,new Map),Ds.set(this,new Map),DA(this,vs,new Set),DA(this,bs,new Map),DA(this,Ss,new Map),t(1===e.k[0]&&Bs.byCode.has(e.c[0]),`First instruction must be an instruction k[0]=${e.k[0]} c[0]=${e.c[0]}`),SA(this,Ss,"f").set(0,e.c[0]);let A=0;for(let t=1;t<e.k.length;t++)1===e.k[t]&&(SA(this,Ss,"f").set(t,e.c[t]),SA(this,bs,"f").set(A,t-A-1),A=t);SA(this,bs,"f").set(A,e.k.length-A-1),SA(this,vs,"f").add(0);for(const[t,A]of SA(this,bs,"f").entries())Bs.blockTerminators.has(e.c[t])&&SA(this,vs,"f").add(t+A+1)}ixAt(e){if(SA(this,Ss,"f").has(e))return Bs.byCode.get(SA(this,Ss,"f").get(e))}skip(e){return SA(this,bs,"f").get(e)}isBlockBeginning(e){return SA(this,vs,"f").has(e)}singleStep(e){const t=this.ixAt(e.execution.instructionPointer);if(void 0===t){return Wn(e.execution,{},[kr.gas(1n),kr.panic()])}const A=this.skip(e.execution.instructionPointer)+1;let r=SA(this,Ds,"f").get(e.execution.instructionPointer);if(void 0===r)try{const n=this.rawProgram.c.subarray(e.execution.instructionPointer+1,e.execution.instructionPointer+A);r=t.decode(n),SA(this,Ds,"f").set(e.execution.instructionPointer,r)}catch(r){console.warn(`Decoding error for ${t.identifier}`,r.message);return Wn(e.execution,{},[kr.skip(e.execution.instructionPointer,A),kr.gas(1n+t.gasCost),kr.panic()])}const n=t.evaluate(r,e);return Wn(e.execution,{},[kr.gas(t.gasCost),kr.skip(e.execution.instructionPointer,A),...n])}static parse(e){return new Ns(e)}}vs=new WeakMap,bs=new WeakMap,Ss=new WeakMap,Ds=new WeakMap;const Os=e=>{let t;try{t=Tr.decode(e).value}catch(e){return br.panic()}return Ns.parse(t)},ks=(e,t)=>{let A=1;const r="true"===process.env.DEBUG_STEPS,n=t.execution;for(;n.gas>0;){const s=n.instructionPointer,o=e.singleStep(t);if(r){const r=s,n=e.ixAt(s);Rr(`${(A++).toString().padEnd(4," ")} [@${r.toString().padEnd(6," ")}] - ${n?.identifier.padEnd(20," ")} ${Ms(t.execution)}`,!0)}if(void 0!==o)return Rr("exitReson != empty","true"===process.env.DEBUG_STEPS),Rr(o.toString(),"true"===process.env.DEBUG_STEPS),o}return br.outOfGas()},Ms=e=>`regs:[${e.registers.elements.join(" ")}] gas:${e.gas}`,xs=(t,A,r,n,s,o)=>{const i=((e,t)=>{const{readBytes:A,value:{roDataLength:r,rwDataLength:n,rwDataPaddingPages:s,stackSize:o}}=ts.decode(e);let i=A;const a=e.subarray(i,i+r);i+=r;const g=e.subarray(i,i+n);i+=n;const c=Ge.decode(e.subarray(i,i+4));i+=4;const u=e.subarray(i,i+c.value);if(i+=c.value,5*$n+rs(r)+rs(n+s*Ae)+rs(o)+es>2**32)return;const I=new tn([4294901760n,2n**32n-2n*BigInt($n)-BigInt(es),0n,0n,0n,0n,0n,2n**32n-BigInt($n)-BigInt(es),BigInt(t.length),0n,0n,0n,0n].map(e=>new en(e))),d={pointer:0,end:0,start:0},p=new Map,l=[],y=e=>{for(let t=e.from;t<e.to;t+=Ae)p.set(Math.floor(t/Ae),e.kind)};l.push({at:$n,content:a}),y({from:$n,to:$n+As(r),kind:Xt.Read});{const e=2*$n+rs(r);l.push({at:e,content:g});const t=e+As(n)+s*Ae;y({from:e,to:t,kind:Xt.Write}),d.start=t,d.pointer=d.start,d.end=t+Ae,y({from:d.start,to:d.end,kind:Xt.Write})}y({from:4278059008-As(o),to:4278059008,kind:Xt.Write});{const e=4278124544;l.push({at:e,content:t}),y({from:e,to:e+As(t.length),kind:Xt.Read})}return{programCode:u,memory:new Zr(l.filter(e=>e.content.length>0),p,d),registers:I}})(t,n);if(void 0===i)return{gasUsed:0n,res:HA.panic(),out:o};const{programCode:a,memory:g,registers:c}=i,u=new Kr({instructionPointer:A,gas:r,registers:c,memory:g}),I=((t,A,r,n)=>{const s=Os(t);if(s instanceof br)return{exitReason:s,out:n};const o=new ns({execution:A,program:s});for(;;){const t=ks(s,o);if(!t.isHostCall())return{exitReason:t,out:n};{const s=o.execution.instructionPointer,i=r({hostCallOpcode:t.opCode,ctx:A,out:n});if(A.instructionPointer=s,void 0!==i)return e(0==i.isPageFault(),"host call cannot return page fault"),{exitReason:i,out:n}}}})(a,u,s,o);return Rs(r,I,u)},Rs=(e,t,A)=>{const r=A.gas,n=e-(r>0n?r:0n);if(t.exitReason?.reason===Pt.OutOfGas)return{gasUsed:n,res:HA.outOfGas(),out:t.out};if(t.exitReason?.reason===Pt.Halt){return A.memory.canRead(A.registers.w7().value,Number(A.registers.w8()))?{gasUsed:n,res:new HA(A.memory.getBytes(A.registers.w7().value,Number(A.registers.w8()))),out:t.out}:{gasUsed:n,res:new HA(new Uint8Array),out:t.out}}return{gasUsed:n,res:HA.panic(),out:t.out}},Fs=ie([["t",Je()],["s",Je()],["bold_i_length",Je()]]),Us=(e,t,A,r)=>{e.accounts.clone().delete(t);const n=Zn(Ge.decode(wA.blake2b(oe(ie([["s",Fe(4)],["p_eta_0",NA],["tau",TA]]),{s:t,p_eta_0:A,tau:r}))).value%(2**32-512)+256,e.accounts);return new An({id:t,state:e.clone(),nextFreeID:n,transfers:new jo([]),yield:void 0,provisions:[]})},Ts=(t,A,r,n,s)=>o=>{const i=Fr.byCode.get(o.hostCallOpcode);e("string"==typeof i,`Unknown identifier for ${o.hostCallOpcode}`);const a=o.out.x.bold_s(),g=o.out.x.state.accounts;switch(i){case"read":{const e=Wn(o.ctx,o.out,ko.read(o.ctx,{bold_s:a,s:o.out.x.id,bold_d:g}));return Gs(o,a),e}case"fetch":{const e=Wn(o.ctx,o.out,ko.fetch(o.ctx,{n:n,bold_o:r.filter(e=>e.isOperand()).map(e=>e.operand)}));return Gs(o,a),e}case"write":{const e={bold_s:a},t=Wn(o.ctx,e,ko.write(o.ctx,{bold_s:a,s:o.out.x.id}));return Gs(o,e.bold_s),t}case"lookup":{const e=Wn(o.ctx,o.out,ko.lookup(o.ctx,{bold_s:a,s:o.out.x.id,bold_d:g}));return Gs(o,a),e}case"gas":{const e=Wn(o.ctx,o.out,ko.gas(o.ctx,void 0));return Gs(o,a),e}case"info":{const e=Wn(o.ctx,o.out,ko.info(o.ctx,{bold_d:g,s:o.out.x.id}));return Gs(o,a),e}case"bless":return Wn(o.ctx,o.out,ko.bless(o.ctx,o.out.x));case"assign":return Wn(o.ctx,o.out,ko.assign(o.ctx,o.out.x));case"designate":return Wn(o.ctx,o.out,ko.designate(o.ctx,o.out.x));case"checkpoint":return Wn(o.ctx,o.out,ko.checkpoint(o.ctx,o.out.x));case"new":return Wn(o.ctx,o.out,ko.new(o.ctx,{x:o.out.x,tau:t}));case"upgrade":return Wn(o.ctx,o.out,ko.upgrade(o.ctx,o.out.x));case"transfer":return Wn(o.ctx,o.out,ko.transfer(o.ctx,o.out.x));case"eject":return Wn(o.ctx,o.out,ko.eject(o.ctx,{x:o.out.x,tau:t}));case"query":return Wn(o.ctx,o.out,ko.query(o.ctx,o.out.x));case"solicit":return Wn(o.ctx,o.out,ko.solicit(o.ctx,{x:o.out.x,tau:t}));case"forget":return Wn(o.ctx,o.out,ko.forget(o.ctx,{x:o.out.x,tau:t}));case"yield":return Wn(o.ctx,o.out,ko.yield(o.ctx,o.out.x));case"provide":return Wn(o.ctx,o.out,ko.provide(o.ctx,{x:o.out.x,s:s}));case"log":return Wn(o.ctx,o.out,ko.log(o.ctx,{core:A,serviceIndex:s}))}throw new Error("not implemented"+o.hostCallOpcode)},Gs=(e,t)=>{const A=e.out.x.clone();A.state.accounts.set(e.out.x.id,t),e.out.x=A},js=(e,t,A)=>t.isPanic()||t.isOutOfGas()?new zA({postState:A.y.state,deferredTransfers:A.y.transfers,yield:A.y.yield,gasUsed:e,provisions:A.y.provisions}):t.isSuccess()&&32===t.success.length?new zA({postState:A.x.state,deferredTransfers:A.x.transfers,yield:NA.decode(t.success).value,gasUsed:e,provisions:A.x.provisions}):new zA({postState:A.x.state,deferredTransfers:A.x.transfers,yield:A.x.yield,gasUsed:e,provisions:A.x.provisions}),Hs=(e,t,A,r,n)=>{let s=0n,o=0;for(const A of t){if(s+=A.digests.reduce((e,t)=>e+t.gasLimit,0n),!(s<=e))break;o++}if(0==o)return{nAccumulatedWork:0,postAccState:A,transfers:jo.newEmpty(),lastAccOutputs:new Xn([]),gasUsed:{elements:[]}};const{postAccState:i,transfers:a,accOut:g,gasUsed:c}=Ls(A,t.slice(0,o),r,n),u=c.elements.map(e=>e.gasUsed).reduce((e,t)=>e+t,0n),{postAccState:I,lastAccOutputs:d,transfers:p,gasUsed:l,nAccumulatedWork:y}=Hs(e-u,t.slice(o),i,new Map,n);return{nAccumulatedWork:o+y,transfers:new jo([...a.elements,...p.elements]),postAccState:I,lastAccOutputs:Xn.union(g,d),gasUsed:{elements:c.elements.concat(l.elements)}}},Ls=(e,t,A,r)=>{const n=[...new Set([...t.map(e=>e.digests.map(e=>e.serviceIndex)).flat(),...A.keys()]).values()],s={elements:[]},o=new Map,i=new jo([]),a=new Xn([]),g=n=>{let s=o.get(n);return void 0===s&&(s=Ys(e,t,A,n,r),o.set(n,s)),s};n.forEach(e=>{const t=g(e);s.elements.push({serviceIndex:e,gasUsed:t.gasUsed}),void 0!==t.yield&&a.add(e,t.yield),i.elements.push(...t.deferredTransfers.elements)});const c=e.accounts.clone(),u=new Set,I=new Gr;for(let e=0;e<n.length;e++){const t=n[e],A=o.get(t);for(const e of A.postState.accounts.services())c.has(e)&&e!==t||I.set(e,A.postState.accounts.get(e));for(const e of c.services())A.postState.accounts.has(e)||u.add(e)}const d=Gr.union(c,I);for(const e of u)d.delete(e);const p=d.preimageIntegration([...o.values()].map(e=>e.provisions).flat(),r.p_tau),l=g(e.manager).postState,y=structuredClone(e.assigners);for(let e=0;e<M;e++)y[e]=g(l.assigners[e]).postState.assigners[e];let h=structuredClone(e.delegator);e.delegator!==l.delegator&&(h=g(e.delegator).postState.delegator);const C=g(e.delegator).postState.stagingSet,E=new ir({elements:[]});for(let t=0;t<M;t++)E.elements[t]=g(e.assigners[t]).postState.authQueue.elements[t];return{postAccState:new Yr({accounts:p,stagingSet:C,authQueue:E,manager:l.manager,assigners:y,delegator:h,alwaysAccers:l.alwaysAccers}),transfers:i,accOut:a,gasUsed:s}},Ys=(e,t,A,r,n)=>{let s=A.get(r)||0n;t.forEach(e=>e.digests.filter(e=>e.serviceIndex===r).forEach(e=>s+=e.gasLimit));const o=[];let i=0;for(const e of t)for(const t of e.digests)t.serviceIndex===r&&(i=e.core,o.push(new zn({operand:new Lr({result:t.result,gasLimit:t.gasLimit,payloadHash:t.payloadHash,authTrace:e.authTrace,segmentRoot:e.avSpec.segmentRoot,packageHash:e.avSpec.packageHash,authorizerHash:e.authorizerHash})})));const a=((e,t,A,r,n,s)=>{const o=Us(e,A,s.p_eta_0,s.p_tau),i=o.clone(),a=e.accounts.get(A)?.code();if(void 0===a||a.length>X)return new zA({postState:e,deferredTransfers:new jo([]),yield:void 0,gasUsed:0n,provisions:[]});const g=xs(a,5,r,oe(Fs,{t:t.value,s:A,bold_i_length:n.length}),Ts(t,s.core,n,s.p_eta_0,A),{x:o,y:i});return js(g.gasUsed,g.res,g.out)})(e,n.p_tau,r,s,o,{core:i,p_tau:n.p_tau,p_eta_0:n.p_eta_0});return a};var Ks;let Js=class extends ue{isSignatureValid(e){return _A.verifySignature(this.signature,e.kappa.at(this.validatorIndex).ed25519,new Uint8Array([...j,...wA.blake2b(new Uint8Array([...oe(NA,e.headerParent),...oe(Xe(M),this.bitstring)]))]))}isValid(e){if(this.validatorIndex>=O)return!1;if(this.bitstring.length!==M)return!1;if(0!==lt(this.anchorHash,e.headerParent))return!1;for(let t=0;t<M;t++)if(1===this.bitstring[t]&&void 0===e.d_rho.elementAt(t))return!1;return this.isSignatureValid({kappa:e.kappa,headerParent:e.headerParent})}};var Ps,Vs;vA([ye(NA,"anchor"),bA("design:type",Object)],Js.prototype,"anchorHash",void 0),vA([(Ps=M,Vs="bitfield",(e,t)=>{pe(Xe(Ps))(e,t),le(Ne(we(),{fromJSON(e){const t=[];for(let A=0;A<M;A++){const r=A/8|0,n=A%8;t.push((Number(e[r])>>n)%2)}return t},toJSON(e){const t=Buffer.alloc(Math.floor((e.length+7)/8)).fill(0);for(let A=0;A<e.length;A++){const r=A/8|0,n=A%8,s=t[r];t[r]=s|e[A]<<n}return t}}),Vs)(e,t)}),bA("design:type",Object)],Js.prototype,"bitstring",void 0),vA([He(2,"validator_index"),bA("design:type",Number)],Js.prototype,"validatorIndex",void 0),vA([ye($e(64),"signature"),bA("design:type",Object)],Js.prototype,"signature",void 0),Js=vA([he()],Js);let Xs=Ks=class extends ue{constructor(e=[]){super(),this.elements=e}nPositiveVotes(e){return this.elements.reduce((t,A)=>t+A.bitstring[e],0)}checkValidity(e){if(this.elements.length>O)return Ut(zs.EA_TOO_MANY_VALIDATORS);for(let e=1;e<this.elements.length;e++)if(this.elements[e-1].validatorIndex>=this.elements[e].validatorIndex)return Ut(zs.EA_VALIDATORS_NOT_ORDERED_OR_UNIQUE);for(let t=0;t<this.elements.length;t++)if(!this.elements[t].isValid({headerParent:e.headerParent,kappa:e.kappa,d_rho:e.d_rho}))return Ut(zs.EA_SINGLE_ELEMENT_INVALID);return Ft(this)}static newlyAvailableReports(e,t){const A=new WA;for(let r=0;r<M;r++){e.nPositiveVotes(r)>2*O/3&&A.elements.push(t.elementAt(r).workReport)}return A}static newEmpty(){return new Ks([])}};var zs;vA([nt(Js,ce),bA("design:type",Object)],Xs.prototype,"elements",void 0),Xs=Ks=vA([he(),bA("design:paramtypes",[Array])],Xs),function(e){e.EA_TOO_MANY_VALIDATORS="EA_TOO_MANY_VALIDATORS",e.EA_VALIDATORS_NOT_ORDERED_OR_UNIQUE="EA_VALIDATORS_NOT_ORDERED_OR_UNIQUE",e.EA_SINGLE_ELEMENT_INVALID="EA_SINGLE_ELEMENT_INVALID"}(zs||(zs={}));const qs=ie([["codeHash",$e(32)],["balance",Oe(8)],["minAccGas",Oe(8)],["minMemoGas",Oe(8)],["totalOctets",Oe(8)],["gratis",Oe(8)],["itemInStorage",Fe(4)],["created",TA],["lastAcc",TA],["parent",Fe(4)]]),Ws=e=>{if(0===e.size)return new Uint8Array(32).fill(0);if(1===e.size){const[[t,A]]=e.values();return wA.blake2b(((e,t)=>t.length<=32?new Uint8Array([128+t.length,...e,...t,...new Array(32-t.length).fill(0)]):new Uint8Array([192,...e,...wA.blake2b(t)]))(t,A))}{const t=new Map([...e.entries()].filter(([e])=>0===e[0]).map(([e,t])=>[e.slice(1),t])),A=new Map([...e.entries()].filter(([e])=>1===e[0]).map(([e,t])=>[e.slice(1),t]));return wA.blake2b(((e,t)=>new Uint8Array([127&e[0],...e.subarray(1),...t]))(Ws(t),Ws(A)))}},Zs=e=>{const t=new KA;t.set(rn(1),e.authPool.toBinary()),t.set(rn(2),e.authQueue.toBinary()),t.set(rn(3),e.beta.toBinary()),t.set(rn(4),e.safroleState.toBinary()),t.set(rn(5),e.disputes.toBinary()),t.set(rn(6),e.entropy.toBinary()),t.set(rn(7),e.iota.toBinary()),t.set(rn(8),e.kappa.toBinary()),t.set(rn(9),e.lambda.toBinary()),t.set(rn(10),e.rho.toBinary()),t.set(rn(11),e.slot.toBinary()),t.set(rn(12),e.privServices.toBinary()),t.set(rn(13),e.statistics.toBinary()),t.set(rn(14),e.accumulationQueue.toBinary()),t.set(rn(15),e.accumulationHistory.toBinary()),t.set(rn(16),e.mostRecentAccumulationOutputs.toBinary());for(const[A,r]of e.serviceAccounts.elements){t.set(rn(255,A),oe(qs,{...r,itemInStorage:r.itemInStorage(),totalOctets:r.totalOctets()}));for(const[e,n]of r.preimages){const r=oe(Ge,2**32-2);t.set(rn(A,new Uint8Array([...r,...e])),n)}for(const[e,A]of r.merkleStorage.entries())t.set(e,A)}return t};class $s{constructor(e){Object.assign(this,e)}merkleRoot(){const e=Zs(this);return Ws(new Map([...e.entries()].map(([e,t])=>{return[(A=e,[...A].map(e=>e.toString(2).padStart(8,"0").split("").map(e=>parseInt(e))).flat()),[e,t]];var A})))}applyBlock(t){e(this.block,"Cannot apply block to a state without a block");const A=t.header.slot,[r,n]=A.checkPTauValid(this.slot).safeRet();if(void 0!==r)return Ut(r);const s=this.kappa.toPosterior(this,{p_tau:n}),o=this.lambda.toPosterior(this,{p_tau:n}),i=this.entropy.rotate1_3({slot:this.slot,p_tau:n}).toPosterior({vrfOutputHash:fA.vrfOutputSignature(t.header.entropySource)}),[a,g]=t.extrinsics.disputes.checkValidity({disputesState:this.disputes,tau:this.slot,kappa:this.kappa,lambda:this.lambda}).safeRet();if(void 0!==a)return Ut(a);const[c,u]=this.disputes.toPosterior({kappa:this.kappa,lambda:this.lambda,extrinsic:g}).safeRet();if(void 0!==c)return Ut(c);const I=this.safroleState.gamma_p.toPosterior({slot:this.slot,iota:this.iota,p_tau:n,p_offenders:u.offenders}),d=this.safroleState.gamma_z.toPosterior({slot:this.slot,p_tau:n,p_gamma_p:I}),[p,l]=t.extrinsics.tickets.newTickets({p_tau:n,p_gamma_z:d,gamma_a:this.safroleState.gamma_a,p_entropy:i}).safeRet();if(void 0!==p)return Ut(p);const y=this.safroleState.gamma_s.toPosterior({slot:this.slot,safroleState:this.safroleState,p_tau:n,p_kappa:s,p_eta2:i._2}),[h,C]=this.safroleState.gamma_a.toPosterior({slot:this.slot,p_tau:n,newTickets:l}).safeRet();if(void 0!==h)return Ut(h);const E=this.safroleState.toPosterior({p_gamma_p:I,p_gamma_z:d,p_gamma_a:C,p_gamma_s:y}),[m]=t.header.checkValidity({disputesExtrinsic:g,p_kappa:s,extrinsicHash:t.extrinsics.extrinsicHash(),curState:this,prevHeader:this.block.header,p_entropy_3:i._3,p_gamma_s:y,p_gamma_p:I}).safeRet();if(void 0!==m)return Ut(m);const B=this.rho.toDagger({p_disputes:u}),[Q,f]=t.extrinsics.assurances.checkValidity({headerParent:this.block.header.signedHash(),kappa:this.kappa,d_rho:B}).safeRet();if(void 0!==Q)return Ut(Q);const _=Xs.newlyAvailableReports(f,B),{p_accumulationHistory:w,p_accumulationQueue:v,p_mostRecentAccumulationOutputs:b,deferredTransfers:S,p_privServices:D,d_delta:N,p_iota:O,p_authQueue:k,accumulationStatistics:x}=((e,t)=>{const A=e.queueable(t.accumulationHistory),r=e.accumulatableReports({accQueue:t.accumulationQueue,accHistory:t.accumulationHistory,p_tau:t.p_tau}),n=[te,$*BigInt(M)+[...t.privServices.alwaysAccers.values()].reduce((e,t)=>e+t,0n)].reduce((e,t)=>e<t?t:e),s=new Yr({accounts:t.serviceAccounts,stagingSet:t.iota,authQueue:t.authQueue,manager:t.privServices.manager,assigners:t.privServices.assigners,delegator:t.privServices.delegator,alwaysAccers:t.privServices.alwaysAccers}),{nAccumulatedWork:o,postAccState:i,transfers:a,lastAccOutputs:g,gasUsed:c}=Hs(n,r,s,t.privServices.alwaysAccers,{p_tau:t.p_tau,p_eta_0:t.p_eta_0}),u=Ar.compute({r_star:r,nAccumulatedWork:o,gasUsed:c}),I=t.accumulationHistory.toPosterior({r_star:r,nAccumulatedWork:o});return{p_accumulationHistory:I,p_accumulationQueue:t.accumulationQueue.toPosterior({tau:t.tau,p_tau:t.p_tau,r_q:A,p_accumulationHistory:I}),deferredTransfers:a,p_mostRecentAccumulationOutputs:g,p_privServices:new Hr({manager:i.manager,delegator:i.delegator,assigners:i.assigners,alwaysAccers:i.alwaysAccers}),d_delta:i.accounts,p_iota:i.stagingSet,p_authQueue:i.authQueue,accumulationStatistics:u}})(_,{tau:this.slot,p_tau:n,accumulationHistory:this.accumulationHistory,accumulationQueue:this.accumulationQueue,authQueue:this.authQueue,serviceAccounts:this.serviceAccounts,privServices:this.privServices,iota:this.iota,p_eta_0:i._0}),R=this.beta.toDagger(t.header.parentStateRoot),F=S.invokedTransfers({d_delta:N,p_tau:n,p_eta_0:i._0}),U=N.toDoubleDagger({p_tau:n,invokedTransfers:F,accumulationStatistics:x}),[T,G]=t.extrinsics.preimages.checkValidity({serviceAccounts:this.serviceAccounts}).safeRet();if(T)return Ut(T);const j=U.toPosterior({p_tau:n,ep:G}),H=B.toDoubleDagger({p_tau:n,newReports:_,rho:this.rho}),[L,Y]=t.extrinsics.reportGuarantees.checkValidity({beta:this.beta,rho:this.rho,accumulationHistory:this.accumulationHistory,accumulationQueue:this.accumulationQueue,authPool:this.authPool,headerLookupHistory:this.headerLookupHistory,serviceAccounts:this.serviceAccounts,dd_rho:H,d_recentHistory:R.recentHistory,p_entropy:i,p_kappa:s,p_lambda:o,p_disputes:u,p_tau:n}).safeRet();if(void 0!==L)return Ut(L);const K=H.toPosterior({p_tau:n,EG_Extrinsic:Y}),J=t.header.signedHash(),P=R.toPosterior({headerHash:J,eg:Y,p_theta:b}),V=this.statistics.toPosterior({tau:this.slot,p_tau:n,extrinsics:t.extrinsics,ea:f,ep:G,d_rho:B,p_disputes:u,authorIndex:t.header.authorIndex,p_entropy:i,p_kappa:s,p_lambda:o,accumulationStatistics:x,transferStatistics:S.statistics(F)}),X=this.authPool.toPosterior({p_tau:n,eg:Y,p_queue:k}),z=this.headerLookupHistory.toPosterior({header:t.header});return Ft(new $s({block:t,entropy:i,slot:t.header.slot,iota:O,authPool:X,authQueue:k,safroleState:E,statistics:V,rho:K,serviceAccounts:j,beta:P,accumulationQueue:v,accumulationHistory:w,privServices:D,lambda:o,kappa:s,disputes:u,headerLookupHistory:z,mostRecentAccumulationOutputs:b}))}}var eo;let to=eo=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}static newEmpty(){return new eo({providedCount:0,providedSize:0,refinementCount:0,refinementGasUsed:0n,importCount:0,extrinsicCount:0,extrinsicSize:0,exportCount:0,accumulateCount:0,accumulateGasUsed:0n,transfersCount:0,transfersGasUsed:0n})}};var Ao;vA([Ve("provided_count"),bA("design:type",Number)],to.prototype,"providedCount",void 0),vA([Ve("provided_size"),bA("design:type",Number)],to.prototype,"providedSize",void 0),vA([Ve("refinement_count"),bA("design:type",Number)],to.prototype,"refinementCount",void 0),vA([Pe("refinement_gas_used"),bA("design:type",BigInt)],to.prototype,"refinementGasUsed",void 0),vA([Ve("imports"),bA("design:type",Number)],to.prototype,"importCount",void 0),vA([Ve("exports"),bA("design:type",Number)],to.prototype,"extrinsicCount",void 0),vA([Ve("extrinsic_size"),bA("design:type",Number)],to.prototype,"extrinsicSize",void 0),vA([Ve("extrinsic_count"),bA("design:type",Number)],to.prototype,"exportCount",void 0),vA([Ve("accumulate_count"),bA("design:type",Number)],to.prototype,"accumulateCount",void 0),vA([Pe("accumulate_gas_used"),bA("design:type",BigInt)],to.prototype,"accumulateGasUsed",void 0),vA([Ve("on_transfers_count"),bA("design:type",Number)],to.prototype,"transfersCount",void 0),vA([Pe("on_transfers_gas_used"),bA("design:type",BigInt)],to.prototype,"transfersGasUsed",void 0),to=eo=vA([he(),bA("design:paramtypes",[Object])],to);let ro=Ao=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}toPosterior(e){const t=new Ao({elements:new Map}),A=new Set(e.guaranteedReports.map(e=>e.digests).flat().map(e=>e.serviceIndex)),r=new Set(e.ep.elements.map(e=>e.requester)),n=new Set([...r,...A,...e.accumulationStatistics.services(),...e.transferStatistics.keys()]);for(const A of n){const r=e.ep.elements.filter(({requester:e})=>e===A).map(({blob:e})=>({count:1,size:e.length})).reduce((e,t)=>({count:e.count+t.count,size:e.size+t.size}),{count:0,size:0});t.elements.set(A,new to({...no(A,e.guaranteedReports),providedCount:r.count,providedSize:r.size,accumulateCount:e.accumulationStatistics.get(A)?.count??0,accumulateGasUsed:e.accumulationStatistics.get(A)?.gasUsed??0n,transfersCount:e.transferStatistics.get(A)?.count??0,transfersGasUsed:e.transferStatistics.get(A)?.gasUsed??0n}))}return t}static newEmpty(){return new Ao({elements:new Map})}};vA([le(Se({key:"id",value:"record"},{fromJSON:e=>e,toJSON:e=>e},to),ce),pe(it(Fe(4),to,(e,t)=>e-t)),bA("design:type",Map)],ro.prototype,"elements",void 0),ro=Ao=vA([he(),bA("design:paramtypes",[Object])],ro);const no=(e,t)=>t.map(e=>e.digests).flat().filter(t=>t.serviceIndex===e).map(e=>({refinementCount:1,refinementGasUsed:e.refineLoad.gasUsed,importCount:e.refineLoad.importCount,extrinsicCount:e.refineLoad.extrinsicCount,extrinsicSize:e.refineLoad.extrinsicSize,exportCount:e.refineLoad.exportCount})).reduce((e,t)=>({refinementCount:e.refinementCount+t.refinementCount,refinementGasUsed:e.refinementGasUsed+t.refinementGasUsed,importCount:e.importCount+t.importCount,extrinsicCount:e.extrinsicCount+t.extrinsicCount,extrinsicSize:e.extrinsicSize+t.extrinsicSize,exportCount:e.exportCount+t.exportCount}),{refinementCount:0,refinementGasUsed:0n,importCount:0,extrinsicCount:0,extrinsicSize:0,exportCount:0});var so;let oo=so=class extends ue{constructor(e){super(),Object.assign(this,e)}static newEmpty(){return new so({blocks:0,tickets:0,preimageCount:0,preimageSize:0,guarantees:0,assurances:0})}};var io;vA([He(4),bA("design:type",Number)],oo.prototype,"blocks",void 0),vA([He(4),bA("design:type",Number)],oo.prototype,"tickets",void 0),vA([He(4),bA("design:type",Number)],oo.prototype,"preimageCount",void 0),vA([He(4),bA("design:type",Number)],oo.prototype,"preimageSize",void 0),vA([He(4),bA("design:type",Number)],oo.prototype,"guarantees",void 0),vA([He(4),bA("design:type",Number)],oo.prototype,"assurances",void 0),oo=so=vA([he(),bA("design:paramtypes",[Object])],oo);let ao=io=class extends ue{constructor(e){super(),e&&(this.elements=e)}static newEmpty(){return new io(Array.from({length:O},()=>oo.newEmpty()))}};var go;vA([ot(O,oo),bA("design:type",Object)],ao.prototype,"elements",void 0),ao=io=vA([he(),bA("design:paramtypes",[Array])],ao);let co=go=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}toPosterior(e){const t=e.extrinsics.reportGuarantees.reporters({p_tau:e.p_tau,p_lambda:e.p_lambda,p_kappa:e.p_kappa,p_disputes:e.p_disputes,p_entropy:e.p_entropy}),A=Ie(this);let r=A.accumulator;e.p_tau.isNewerEra(e.tau)&&(r=ao.newEmpty(),A.previous=this.accumulator);for(let n=0;n<O;n++){const s=n===e.authorIndex;A.accumulator.elements[n]=new oo({blocks:r.elements[n].blocks+(s?1:0),tickets:r.elements[n].tickets+(s?e.extrinsics.tickets.elements.length:0),preimageCount:r.elements[n].preimageCount+(s?e.extrinsics.preimages.elements.length:0),preimageSize:r.elements[n].preimageSize+(s?e.extrinsics.preimages.elements.reduce((e,t)=>e+t.blob.length,0):0),guarantees:r.elements[n].guarantees+(t.has(e.p_kappa.at(n).ed25519)?1:0),assurances:r.elements[n].assurances+e.extrinsics.assurances.elements.filter(e=>e.validatorIndex===n).length})}return A}static newEmpty(){return new go({accumulator:ao.newEmpty(),previous:ao.newEmpty()})}};var uo;vA([ye(ao),bA("design:type",ao)],co.prototype,"accumulator",void 0),vA([ye(ao),bA("design:type",ao)],co.prototype,"previous",void 0),co=go=vA([he(),bA("design:paramtypes",[Object])],co);let Io=uo=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}toPosterior(e){const t=e.extrinsics.reportGuarantees.workReports(),A=Xs.newlyAvailableReports(e.ea,e.d_rho),r=new uo;return r.validators=this.validators.toPosterior({tau:e.tau,p_tau:e.p_tau,extrinsics:e.extrinsics,p_disputes:e.p_disputes,authorIndex:e.authorIndex,p_entropy:e.p_entropy,p_kappa:e.p_kappa,p_lambda:e.p_lambda}),r.cores=this.cores.toPosterior({ea:e.ea,d_rho:e.d_rho,bold_I:t,bold_R:A}),r.services=this.services.toPosterior({ep:e.ep,transferStatistics:e.transferStatistics,guaranteedReports:t,accumulationStatistics:e.accumulationStatistics}),r}static newEmpty(){return new uo({cores:Qr.newEmpty(),services:ro.newEmpty(),validators:co.newEmpty()})}};var po;vA([ye(co),bA("design:type",co)],Io.prototype,"validators",void 0),vA([ye(Qr),bA("design:type",Qr)],Io.prototype,"cores",void 0),vA([ye(ro),bA("design:type",ro)],Io.prototype,"services",void 0),Io=uo=vA([he(),bA("design:paramtypes",[Object])],Io);let lo=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}};vA([ye(PA,"report"),bA("design:type",PA)],lo.prototype,"workReport",void 0),vA([ye(TA,"timeout"),bA("design:type",TA)],lo.prototype,"reportSlot",void 0),lo=vA([he(),bA("design:paramtypes",[Object])],lo);let yo=po=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}elementAt(t){return e(t>=0&&t<M,"Core index out of bounds"),this.elements[t]}toDagger(e){const t=new MA([...e.p_disputes.bad,...e.p_disputes.wonky]),A=Ie(this);return this.elements.forEach((e,r)=>{void 0!==e&&t.has(e.workReport.hash())&&(A.elements[r]=void 0)}),A}toDoubleDagger(e){const t=Ie(this);for(let A=0;A<M;A++){if(void 0===this.elements[A])continue;if(void 0===e.rho.elements[A])continue;new MA(e.newReports.elements.map(e=>e.hash())).has(e.rho.elementAt(A).workReport.hash())&&(t.elements[A]=void 0),e.p_tau.value>=this.elements[A].reportSlot.value+5&&(t.elements[A]=void 0)}return t}toPosterior(e){const t=Ie(this);for(let A=0;A<M;A++){const r=e.EG_Extrinsic.elementForCore(A);void 0!==r&&(t.elements[A]=new lo({workReport:r.report,reportSlot:e.p_tau}))}return t}static newEmpty(){return new po({elements:Array.from({length:M},()=>{})})}};var ho;vA([le(be(De(lo)),ce),pe(st(M,new ze(lo))),bA("design:type",Object)],yo.prototype,"elements",void 0),yo=po=vA([he(),bA("design:paramtypes",[Object])],yo);let Co=ho=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}toPosterior(e){return new ho({gamma_p:e.p_gamma_p,gamma_z:e.p_gamma_z,gamma_a:e.p_gamma_a,gamma_s:e.p_gamma_s})}static newEmpty(){return new ho({gamma_s:Hn.newEmpty(),gamma_a:mn.newEmpty(),gamma_z:Ln.newEmpty(),gamma_p:vn.newEmpty()})}};var Eo;vA([ye(vn),bA("design:type",Object)],Co.prototype,"gamma_p",void 0),vA([ye(Ln),bA("design:type",Ln)],Co.prototype,"gamma_z",void 0),vA([ye(Hn),bA("design:type",Hn)],Co.prototype,"gamma_s",void 0),vA([ye(mn),bA("design:type",mn)],Co.prototype,"gamma_a",void 0),Co=ho=vA([he(),bA("design:paramtypes",[Object])],Co);const mo=(e,t)=>{const A=new Uint8Array(4+t.length);return Ge.encode(2**32-1,A),A.set(t,4),rn(e,A)},Bo=(e,t,A)=>{const r=new Uint8Array([...oe(Ge,A),...t]);return rn(e,r)},Qo=rt(TA);let fo=Eo=class extends ue{constructor(e,t=0n,A=0){super(),this.serviceIndex=e,this.octets=t,this.items=A,this._storage=new KA}setStorage(e,t){this._storage.set(e,t)}deleteStorage(e){return this._storage.delete(e)}entries(){return Array.from(this._storage.entries()).map(([e,t])=>[e,t]).values()}get storage(){const e={set:(t,A)=>{const r=mo(this.serviceIndex,t);e.delete(t),this.setStorage(r,A),this.items=this.items+1,this.octets=this.octets+34n+BigInt(A.length)+BigInt(t.length)},get:e=>{const t=mo(this.serviceIndex,e);return this._storage.get(t)},has:e=>{const t=mo(this.serviceIndex,e);return this._storage.has(t)},delete:e=>{const t=mo(this.serviceIndex,e);if(this._storage.has(t)){const A=this._storage.get(t);return this.items=this.items-1,this.octets=this.octets-34n-BigInt(A.length)-BigInt(e.length),this.deleteStorage(t)}return!1}};return e}get requests(){const e=e=>{const t=this._storage.get(e);if(t)return Qo.decode(t).value},t={set:(e,A,r)=>{const n=Bo(this.serviceIndex,e,A);t.delete(e,A);const s=oe(Qo,r);this.setStorage(n,s),this.items=this.items+2,this.octets=this.octets+BigInt(81)+BigInt(A)},get:(t,A)=>{const r=Bo(this.serviceIndex,t,A);return Object.freeze(e(r))},has:(e,t)=>{const A=Bo(this.serviceIndex,e,t);return this._storage.has(A)},delete:(e,t)=>{const A=Bo(this.serviceIndex,e,t);return!!this._storage.has(A)&&(this.items=this.items-2,this.octets=this.octets-BigInt(t+81),this.deleteStorage(A))}};return t}clone(){const e=new Eo(this.serviceIndex,this.octets,this.items);return e._storage=this._storage.clone(),e}equals(e){return this===e||[...this._storage.entries()].every(([t,A])=>e._storage.has(t)&&0===lt(e._storage.get(t),A))}};var _o;vA([ye(JA($e(31),At,{key:"stateKey",value:"blob"})),bA("design:type",KA)],fo.prototype,"_storage",void 0),fo=Eo=vA([he(),bA("design:paramtypes",[Number,BigInt,Number])],fo);const wo=ie([["metadata",At],["code",We]]);let vo=_o=class extends ue{constructor(e,t){super(),this.preimages=new KA,this.preimages=e.preimages,this.gratis=e.gratis,this.codeHash=e.codeHash,this.balance=e.balance,this.minAccGas=e.minAccGas,this.minMemoGas=e.minMemoGas,this.created=e.created,this.lastAcc=e.lastAcc,this.parent=e.parent,this.merkleStorage=t,this.requests=this.merkleStorage.requests,this.storage=this.merkleStorage.storage}itemInStorage(){return this.merkleStorage.items}totalOctets(){return this.merkleStorage.octets}gasThreshold(){const e=100n+10n*BigInt(this.itemInStorage())+1n*this.totalOctets()-this.gratis;return e<0n?0n:e}decodeMetaAndCode(){const e=this.preimages.get(this.codeHash);this.decodedMetaAndCode=void 0===e?{code:void 0,metadata:void 0}:wo.decode(this.preimages.get(this.codeHash)).value}metadata(){return void 0===this.decodedMetaAndCode&&this.decodeMetaAndCode(),this.decodedMetaAndCode.metadata}code(){return void 0===this.decodedMetaAndCode&&this.decodeMetaAndCode(),this.decodedMetaAndCode.code}isPreimageSolicitedButNotYetProvided(e,t){return!this.preimages.has(e)&&0===this.requests.get(e,t)?.length}historicalLookup(e,t){const A=this.preimages.get(t);if(void 0!==A&&bo(this.requests.get(t,A.length),e))return this.preimages.get(t)}clone(){return new _o(this,this.merkleStorage.clone())}equals(e){return this===e||this.balance===e.balance&&0===lt(this.codeHash,e.codeHash)&&this.created.value===e.created.value&&this.gratis===e.gratis&&this.lastAcc.value===e.lastAcc.value&&this.minAccGas===e.minAccGas&&this.minMemoGas===e.minMemoGas&&this.parent===e.parent&&this.merkleStorage.equals(e.merkleStorage)}};vA([ye(JA($e(32),At,{key:"key",value:"blob"})),bA("design:type",KA)],vo.prototype,"preimages",void 0),vA([je(8),bA("design:type",BigInt)],vo.prototype,"gratis",void 0),vA([ye($e(32)),bA("design:type",Object)],vo.prototype,"codeHash",void 0),vA([je(8),bA("design:type",BigInt)],vo.prototype,"balance",void 0),vA([je(8),bA("design:type",BigInt)],vo.prototype,"minAccGas",void 0),vA([je(8),bA("design:type",BigInt)],vo.prototype,"minMemoGas",void 0),vA([ye(TA),bA("design:type",TA)],vo.prototype,"created",void 0),vA([ye(TA),bA("design:type",TA)],vo.prototype,"lastAcc",void 0),vA([He(4),bA("design:type",Number)],vo.prototype,"parent",void 0),vA([ye(fo),bA("design:type",fo)],vo.prototype,"merkleStorage",void 0),vo=_o=vA([he(),bA("design:paramtypes",[Object,fo])],vo);const bo=(e,A)=>{switch(e.length){case 0:return!1;case 1:return e[0]<=A;case 2:return e[0]<=A&&e[1]>A;case 3:return e[0]<=A&&e[1]>A&&e[2]<=A;default:t(!1,"should never happen")}},So={encode(e,t){const A=e.root;if((e=>e instanceof Uint8Array&&32===e.length)(A)){let r=NA.encode(A,t.subarray(0,32));return r+=Fe(2).encode(e.index,t.subarray(r)),r}{let r=NA.encode(A.value,t.subarray(0,32));return r+=Fe(2).encode(e.index+32768,t.subarray(r)),r}},decode(e){const{value:t}=NA.decode(e.subarray(0,32)),{value:A}=Fe(2).decode(e.subarray(32));return A>32768?{value:{root:{value:t},index:A-32768},readBytes:34}:{value:{root:t,index:A},readBytes:34}},encodedSize:()=>34};let Do=class extends ue{originalBlob(){throw new Error("X() not implemented")}};vA([ye(NA,"hash"),bA("design:type",Object)],Do.prototype,"blobHash",void 0),vA([He(4,"len"),bA("design:type",Number)],Do.prototype,"length",void 0),Do=vA([he()],Do);let No=class extends ue{};vA([He(4),bA("design:type",Number)],No.prototype,"service",void 0),vA([ye(NA,"code_hash"),bA("design:type",Object)],No.prototype,"codeHash",void 0),vA([je(8,"refine_gas_limit"),bA("design:type",BigInt)],No.prototype,"refineGasLimit",void 0),vA([je(8,"accumulate_gas_limit"),bA("design:type",BigInt)],No.prototype,"accumulateGasLimit",void 0),vA([He(2,"export_count"),bA("design:type",Number)],No.prototype,"exportCount",void 0),vA([ye(At),bA("design:type",Object)],No.prototype,"payload",void 0),vA([le(be(de([["root","tree_root",NA],["index","index",{fromJSON:e=>e,toJSON:e=>e}]])),"import_segments"),pe(rt(So)),bA("design:type",Object)],No.prototype,"importSegments",void 0),vA([nt(Do,"extrinsic"),bA("design:type",Object)],No.prototype,"exportedDataSegments",void 0),No=vA([he()],No);class Oo{gas(e,t){const A=e.gas-10n;return[kr.w7(A)]}fetch(e,t){const[A,r,n,s,o,i]=e.registers.slice(7),a=A;let g;switch(s.value){case 0n:g=new Uint8Array([...oe(Re,10n),...oe(Re,1n),...oe(Re,100n),...oe(Fe(2),M),...oe(Fe(4),q),...oe(Fe(4),R),...oe(Re,10000000n),...oe(Re,50000000n),...oe(Re,ee),...oe(Re,te),...oe(Fe(2),8),...oe(Fe(2),16),...oe(Fe(2),8),...oe(Fe(2),F),...oe(Fe(4),G),...oe(Fe(2),U),...oe(Fe(2),8),...oe(Fe(2),N),...oe(Fe(2),V),...oe(Fe(2),T),...oe(Fe(2),128),...oe(Fe(2),5),...oe(Fe(2),O),...oe(Fe(4),64e3),...oe(Fe(4),13794305),...oe(Fe(4),X),...oe(Fe(4),684),...oe(Fe(4),2048),...oe(Fe(4),W),...oe(Fe(4),49152),...oe(Fe(4),z),...oe(Fe(4),3072),...oe(Fe(4),x)]);break;case 1n:void 0!==t.n&&(g=t.n);break;case 2n:void 0!==t.bold_r&&(g=t.bold_r);break;case 3n:void 0!==t.overline_x&&o.value<t.overline_x.length&&i.value<t.overline_x[Number(o)].length&&(g=t.overline_x[Number(o)][Number(i)]);break;case 4n:void 0!==t.overline_x&&void 0!==t.i&&o.value<(t.overline_x[t.i]?.length??0)&&(g=t.overline_x[t.i][Number(o)]);break;case 5n:void 0!==t.overline_i&&o.value<t.overline_i.length&&i.value<t.overline_i[Number(o)].length&&(g=t.overline_i[Number(o)][Number(i)]);break;case 6n:void 0!==t.overline_i&&void 0!==t.i&&o.value<(t.overline_i[t.i]?.length??0)&&(g=t.overline_i[t.i][Number(o)]);break;case 7n:void 0!==t.p&&(g=t.p.toBinary());break;case 8n:void 0!==t.p&&(g=new Uint8Array([...oe(NA,t.p.authCodeHash),...oe(At,t.p.authConfig)]));break;case 9n:void 0!==t.p&&(g=t.p.authToken);break;case 10n:void 0!==t.p&&(g=oe(jA,t.p.context));break;case 11n:void 0!==t.p&&(g=oe(rt(Mo),t.p.workItems.map(e=>({...e,iLength:e.importSegments.length,xLength:e.exportedDataSegments.length,yLength:e.payload.length}))));break;case 12n:if(void 0!==t.p&&o.value<t.p.workItems.length){const e=t.p.workItems[Number(o)];g=oe(Mo,{...e,iLength:e.importSegments.length,xLength:e.exportedDataSegments.length,yLength:e.payload.length})}break;case 13n:if(void 0!==t.p&&o.value<t.p.workItems.length){g=t.p.workItems[Number(o)].payload}break;case 14n:void 0!==t.bold_o&&(g=oe(rt(Lr),t.bold_o));break;case 15n:void 0!==t.bold_o&&o.value<t.bold_o.length&&(g=oe(Lr,t.bold_o[Number(o)]));break;case 16n:g=t.bold_t?.toBinary();break;case 17n:void 0!==t.bold_t&&o.value<t.bold_t.length()&&(g=t.bold_t.elements[Number(o)].toBinary())}if(void 0===g)return[kr.w7(C)];const c=r.value<g.length?Number(r.value):g.length,u=n.value<g.length-c?Number(n.value):g.length-c;return e.memory.canWrite(a.value,u)?[kr.w7(g.length),kr.memory(a.value,g.subarray(c,c+u))]:[kr.panic()]}lookup(e,t){let A;const r=e.registers.w7();Number(r)===t.s||r.value===2n**64n-1n?A=t.bold_s:r.fitsInU32()&&t.bold_d.has(r.checked_u32())&&(A=t.bold_d.get(r.checked_u32()));const[n,s]=e.registers.slice(8);let o;if(!e.memory.canRead(n.value,32))return[kr.panic()];if(o=NA.decode(e.memory.getBytes(n.value,32)).value,void 0===A||!A.preimages.has(o))return[kr.w7(C)];const i=A.preimages.get(o),a=e.registers.w10(),g=e.registers.w11(),c=BigInt(i.length),u=a.value<c?a.value:c,I=g.value<c-u?g.value:c-u;return!1===e.memory.canWrite(s.value,Number(I))?[kr.panic()]:[kr.w7(i.length),kr.memory(s.value,i.subarray(Number(u),Number(u+I)))]}read(e,t){const A=e.registers.w7();let r,n=t.s;A.value!==2n**64n-1n&&(n=Number(A)),n===t.s?r=t.bold_s:n!==t.s&&A.fitsInU32()&&t.bold_d.has(A.checked_u32())&&(r=t.bold_d.get(A.checked_u32()));const[s,o,i,a,g]=e.registers.slice(8);if(!e.memory.canRead(s.toSafeMemoryAddress(),Number(o)))return[kr.panic()];const c=e.memory.getBytes(s.toSafeMemoryAddress(),Number(o)),u=r?.storage.get(c);if(void 0===u)return[kr.w7(C)];const I=a.value<u.length?Number(a):u.length,d=g.value<u.length-I?Number(g):u.length-I;return i.fitsInU32()&&e.memory.canWrite(i.checked_u32(),d)?[kr.w7(u.length),kr.memory(i.checked_u32(),u.subarray(I,I+d))]:[kr.panic()]}write(e,t){const[A,r,n,s]=e.registers.slice(7);let o;if(!(A.fitsInU32()&&r.fitsInU32()&&e.memory.canRead(A.checked_u32(),r.checked_u32())))return[kr.panic()];o=e.memory.getBytes(A.checked_u32(),r.checked_u32());const i=t.bold_s.clone();if(0n===s.value)Rr(`HostFunction::write delete key ${ve.toJSON(o)} for service ${t.s}`,"true"===process.env.DEBUG_TRACES),i.storage.delete(o);else{if(!(n.fitsInU32()&&s.fitsInU32()&&e.memory.canRead(n.checked_u32(),s.checked_u32())))return[kr.panic()];Rr(`HostFunction::write set key ${ve.toJSON(o)} for service ${t.s} to ${ve.toJSON(e.memory.getBytes(n.checked_u32(),s.checked_u32()))}`,"true"===process.env.DEBUG_TRACES),i.storage.set(o,e.memory.getBytes(n.checked_u32(),s.checked_u32()))}if(i.gasThreshold()>i.balance)return[kr.w7(Q)];let a;return a=t.bold_s.storage.has(o)?t.bold_s.storage.get(o).length:C,[kr.w7(a),kr.obj({bold_s:i})]}info(e,t){const A=e.registers.w7();let r;if(r=A.value===2n**64n-1n?t.bold_d.get(t.s):t.bold_d.get(Number(A)),void 0===r)return[kr.w7(C)];const n=oe(xo,{codeHash:r.codeHash,balance:r.balance,gasThreshold:r.gasThreshold(),minAccGas:r.minAccGas,minMemoGas:r.minMemoGas,totalOctets:r.totalOctets(),itemInStorage:r.itemInStorage(),gratis:r.gratis,created:r.created,lastAcc:r.lastAcc,parent:r.parent});let s=Number(e.registers.w9());s>n.length&&(s=n.length);let o=Number(e.registers.w10());o>n.length-s&&(o=n.length-s);const i=e.registers.w8();return i.fitsInU32()&&e.memory.canWrite(i.checked_u32(),o)?[kr.w7(n.length),kr.memory(i.checked_u32(),n.subarray(s,s+o))]:[kr.panic()]}historical_lookup(e,t){const[A,r,n,s,o]=e.registers.slice(7);if(!r.fitsInU32()||!e.memory.canRead(r.checked_u32(),32))return[kr.panic()];let i;if(A.value===2n**64n-1n&&t.bold_d.has(t.s))i=t.bold_d.get(t.s);else{if(!t.bold_d.has(Number(A)))return[kr.w7(C)];i=t.bold_d.get(Number(A))}const a=i.historicalLookup(t.tau,NA.decode(e.memory.getBytes(r.checked_u32(),32)).value);if(void 0===a)return[kr.w7(C)];const g=Math.min(Number(s),a.length),c=Math.min(Number(o),a.length-g);return n.fitsInU32()&&e.memory.canWrite(n.checked_u32(),c)?[kr.w7(a.length),kr.memory(n.checked_u32(),a.subarray(g,c))]:[kr.panic()]}export(e,t){const[A,r]=e.registers.slice(7),n=Math.min(Number(r),Z);if(!A.fitsInU32()||!e.memory.canRead(A.checked_u32(),n))return[kr.panic()];if(t.segmentOffset+t.refineCtx.segments.length>=3072)return[kr.w7(Q)];const s=((e,t)=>{const A=new Uint8Array(Math.ceil(t.length/e)*e).fill(0);return A.set(t),A})(Z,e.memory.getBytes(A.checked_u32(),n)),o=structuredClone(t.refineCtx);return o.segments.push(s),[kr.w7(t.segmentOffset+t.refineCtx.segments.length),kr.obj(o)]}machine(e,t){const[A,r,n]=e.registers.slice(7);if(!A.fitsInU32()||!r.fitsInU32()||!e.memory.canRead(A.checked_u32(),r.checked_u32()))return[kr.panic()];const s=e.memory.getBytes(A.checked_u32(),r.checked_u32());try{Tr.decode(s)}catch(e){return[kr.w7(v)]}const o=[...t.bold_m.keys()].sort((e,t)=>e-t);let i=0;for(;o.length>0&&i==o[0];)o.shift(),i++;const a=new Zr(new Map,new Map,{start:0,end:0,pointer:0}),g=structuredClone(t);return g.bold_m.set(i,{code:s,ram:a,instructionPointer:Number(n.value)}),[kr.w7(i),kr.obj(g)]}peek(e,t){const[A,r,n,s]=e.registers.slice(7);return r.fitsInU32()&&s.fitsInU32()&&e.memory.canWrite(r.checked_u32(),s.checked_u32())?t.bold_m.has(Number(A))?n.fitsInU32()&&t.bold_m.get(Number(A)).ram.canRead(n.checked_u32(),s.checked_u32())?[kr.w7(b),kr.memory(r.checked_u32(),t.bold_m.get(Number(A)).ram.getBytes(n.checked_u32(),s.checked_u32()))]:[kr.w7(m)]:[kr.w7(B)]:[kr.panic()]}poke(e,t){const[A,r,n,s]=e.registers.slice(7);return r.fitsInU32()&&s.fitsInU32()&&e.memory.canWrite(r.checked_u32(),s.checked_u32())?t.bold_m.has(Number(A))?t.bold_m.get(Number(A)).ram.canRead(n.value,Number(s))?[kr.w7(b),kr.memory(r.checked_u32(),t.bold_m.get(Number(A)).ram.getBytes(n.checked_u32(),Number(s)))]:[kr.w7(m)]:[kr.w7(B)]:[kr.panic()]}pages(e,t){const[A,r,n,s]=e.registers.slice(7);if(!t.bold_m.has(Number(A)))return[kr.w7(B)];const o=t.bold_m.get(Number(A)).ram;if(s.value>4||r.value<16||r.value+n.value>=1048576)return[kr.w7(v)];if(s.value>2&&o.canRead(r.value,Number(n)))return[kr.w7(v)];const i=o.clone();for(let e=0;e<n.value;e++)s.value<3&&i.changeAcl(Number(r)+e,Xt.Write).setBytes((Number(r)+e)*Ae,new Uint8Array(Ae).fill(0)),1n==s.value||3n==s.value?i.changeAcl(Number(r)+e,Xt.Read):2n==s.value||4n==s.value?i.changeAcl(Number(r)+e,Xt.Write):0n==s.value&&i.changeAcl(Number(r)+e,Xt.Null);const a=structuredClone(t);return a.bold_m.get(Number(A)).ram=i,[kr.w7(b),kr.obj(a)]}invoke(e,t){const[A,r]=e.registers.slice(7);if(!e.memory.canWrite(r.value,112))return[kr.panic()];if(!t.bold_m.has(Number(A)))return[kr.w7(B)];const n=Re.decode(e.memory.getBytes(r.value,8)).value,s=tn.decode(e.memory.getBytes(r.value+8n,104)).value,o=new Kr({instructionPointer:t.bold_m.get(Number(A)).instructionPointer,gas:n,registers:s,memory:t.bold_m.get(Number(A)).ram.clone()}),i=Os(t.bold_m.get(Number(A)).code);let a,g;i instanceof br?(g=void 0,a=i):(g=new ns({execution:o,program:i}),a=ks(i,g));const c=o,u={from:r.checked_u32(),data:new Uint8Array(112)};Re.encode(c.gas,u.data.subarray(0,8)),tn.encode(c.registers,u.data.subarray(8));const I=new Map(t.bold_m.entries()),d=new Ro({code:I.get(Number(A)).code,instructionPointer:c.instructionPointer,ram:c.memory});switch(I.set(Number(A),d),a.reason){case Vt.HostCall:return I.get(Number(A)).instructionPointer=c.instructionPointer+1,[kr.w8(a.opCode),kr.w7(S.HOST),kr.memory(u.from,u.data),kr.obj({...t,bold_m:I})];case Vt.PageFault:return[kr.w7(S.FAULT),kr.w8(a.address),kr.memory(u.from,u.data),kr.obj({...t,bold_m:I})];case Pt.OutOfGas:return[kr.w7(S.OOG),kr.memory(u.from,u.data),kr.obj({...t,bold_m:I})];case Pt.Panic:return[kr.w7(S.PANIC),kr.memory(u.from,u.data),kr.obj({...t,bold_m:I})];case Pt.Halt:return[kr.w7(S.HALT),kr.memory(u.from,u.data),kr.obj({...t,bold_m:I})]}}expunge(e,t){const[A]=e.registers.slice(7);if(!t.bold_m.has(Number(A)))return[kr.w7(B)];const r=structuredClone(t);return r.bold_m.delete(Number(A)),[kr.w7(t.bold_m.get(Number(A)).instructionPointer),kr.obj(r)]}bless(e,t){const[A,r,n,s,o,i]=e.registers.slice(7);if(!e.memory.canRead(r.toSafeMemoryAddress(),4*M))return[kr.panic()];const a=Hr.codecOf("assigners").decode(e.memory.getBytes(r.toSafeMemoryAddress(),4*M)).value;if(!e.memory.canRead(o.toSafeMemoryAddress(),12*Number(i)))return[kr.panic()];const g=new Map,c=e.memory.getBytes(o.toSafeMemoryAddress(),12*Number(i));for(let e=0;e<i.value;e++){const t=c.subarray(12*e,12*(e+1)),A=Fe(4).decode(t).value,r=Oe(8).decode(t.subarray(4)).value;g.set(A,r)}if(t.id!==t.state.manager)return[kr.w7(v)];if(A.value>=2**32||r.value>=2**32||s.value>=2**32)return[kr.w7(B)];const u=new An({id:t.id,nextFreeID:t.nextFreeID,provisions:t.provisions,transfers:t.transfers,yield:t.yield,state:new Yr({accounts:t.state.accounts,authQueue:t.state.authQueue,stagingSet:t.state.stagingSet,assigners:a,manager:A.checked_u32(),delegator:n.checked_u32(),alwaysAccers:g})});return[kr.w7(b),kr.obj({x:u})]}assign(e,t){const[A,r,n]=e.registers.slice(7);if(!e.memory.canRead(r.toSafeMemoryAddress(),2560))return[kr.panic()];if(A.value>=M)return[kr.w7(f)];if(t.id!==t.state.assigners[Number(A)])return[kr.w7(v)];const s=e.memory.getBytes(r.toSafeMemoryAddress(),2560),o=[];for(let e=0;e<V;e++)o.push(NA.decode(s.subarray(32*e,32*(e+1))).value);const i=new An({id:t.id,nextFreeID:t.nextFreeID,provisions:t.provisions,yield:t.yield,transfers:t.transfers,state:new Yr({authQueue:Ie(t.state.authQueue),assigners:t.state.assigners.slice(),accounts:t.state.accounts,stagingSet:t.state.stagingSet,manager:t.state.manager,delegator:t.state.delegator,alwaysAccers:t.state.alwaysAccers})});return i.state.authQueue.elements[Number(A)]=o,i.state.assigners[Number(A)]=Number(n),[kr.w7(b),kr.obj({x:i})]}designate(e,t){const A=e.registers.w7();if(!e.memory.canRead(A.toSafeMemoryAddress(),336*O))return[kr.panic()];const r=_n.decode(e.memory.getBytes(A.toSafeMemoryAddress(),336*O)).value;if(t.id!==t.state.delegator)return[kr.w7(v)];const n=new An({id:t.id,nextFreeID:t.nextFreeID,provisions:t.provisions,yield:t.yield,state:new Yr({stagingSet:r,accounts:t.state.accounts,authQueue:t.state.authQueue,assigners:t.state.assigners,manager:t.state.manager,delegator:t.state.delegator,alwaysAccers:t.state.alwaysAccers}),transfers:t.transfers});return[kr.w7(b),kr.obj({x:n})]}checkpoint(e,t){const A=t.clone(),r=e.gas-10n;return[kr.w7(r),kr.obj({y:A})]}new(e,t){const[A,r,n,s,o]=e.registers.slice(7);if(!e.memory.canRead(A.toSafeMemoryAddress(),32)||r.value>=2**32)return[kr.panic()];const i=NA.decode(e.memory.getBytes(A.toSafeMemoryAddress(),32)).value;if(0n!==o.value&&t.x.id!==t.x.state.manager)return[kr.w7(v)];const a=Zn(re+(t.x.nextFreeID-re+42)%4294901504,t.x.state.accounts),g=new fo(t.x.nextFreeID),c=new vo({codeHash:i,balance:0n,minAccGas:n.value,minMemoGas:s.value,preimages:new KA,created:t.tau,gratis:o.value,lastAcc:new TA(0),parent:t.x.id},g);c.requests.set(i,Number(r),[]),c.balance=c.gasThreshold();const u=t.x.bold_s(),I=u.clone();if(I.balance=u.balance-c.gasThreshold(),I.balance<u.gasThreshold())return[kr.w7(_)];const d=new An({id:t.x.id,nextFreeID:t.x.nextFreeID,provisions:t.x.provisions,yield:t.x.yield,state:new Yr({accounts:new Gr(t.x.state.accounts.elements),authQueue:t.x.state.authQueue,stagingSet:t.x.state.stagingSet,assigners:t.x.state.assigners,manager:t.x.state.manager,delegator:t.x.state.delegator,alwaysAccers:t.x.state.alwaysAccers}),transfers:t.x.transfers});return d.nextFreeID=a,d.state.accounts.set(t.x.nextFreeID,c),d.state.accounts.set(t.x.id,I),[kr.w7(t.x.nextFreeID),kr.obj({x:d})]}upgrade(e,t){const[A,r,n]=e.registers.slice(7);if(e.memory.canRead(A.toSafeMemoryAddress(),32)){const s=t.bold_s().clone();s.codeHash=NA.decode(e.memory.getBytes(A.toSafeMemoryAddress(),32)).value,s.minAccGas=r.u64(),s.minMemoGas=n.u64();const o=t.clone();return o.state.accounts.set(o.id,s),[kr.w7(b),kr.obj({x:o})]}return[kr.panic()]}transfer(e,t){const[A,r,n,s]=e.registers.slice(7),o=t.state.accounts.clone();if(!e.memory.canRead(s.toSafeMemoryAddress(),z))return[kr.panic()];if(!A.fitsInU32()||!o.has(A.checked_u32()))return[kr.w7(B)];if(n.value<o.get(A.checked_u32()).minMemoGas)return[kr.w7(w)];if(r.value<t.bold_s().gasThreshold())return[kr.w7(_)];const i=t.bold_s().balance-r.value,a=new vr({source:t.id,destination:A.checked_u32(),amount:r.u64(),gas:n.u64(),memo:e.memory.getBytes(s.toSafeMemoryAddress(),z)}),g=t.clone();return g.transfers.elements.push(a),g.state.accounts.get(t.id).balance=i,[kr.w7(b),kr.obj({x:g})]}eject(e,t){const[A,r]=e.registers.slice(7);if(!e.memory.canRead(r.toSafeMemoryAddress(),32))return[kr.panic()];const n=NA.decode(e.memory.getBytes(r.toSafeMemoryAddress(),32)).value;if(!A.fitsInU32()||t.x.id!=A.checked_u32()||!t.x.state.accounts.has(A.checked_u32()))return[kr.w7(B)];const s=t.x.state.accounts.get(A.checked_u32());if(0!==lt(s.codeHash,oe(Fe(32),t.x.id)))return[kr.w7(B)];const o=s.totalOctets(),i=Number((o>81?o:81n)-81n),a=s.requests.get(n,i);if(2!==s.itemInStorage()||void 0===a)return[kr.w7(v)];const[,g]=a;if(2===a.length&&g.value<t.tau.value-q){const e=t.x.clone();e.state.accounts.delete(A.checked_u32());const r=e.state.accounts.get(t.x.id);return r.balance=r.balance+s.balance,e.state.accounts.set(t.x.id,r),[kr.w7(b),kr.obj({x:e})]}return[kr.w7(v)]}query(e,t){const[A,r]=e.registers.slice(7);if(!e.memory.canRead(A.toSafeMemoryAddress(),32))return[kr.panic()];const n=NA.decode(e.memory.getBytes(A.toSafeMemoryAddress(),32)).value,s=t.bold_s().requests.get(n,Number(r));if(void 0===s)return[kr.w7(C),kr.w8(0)];const[o,i,a]=s.map(e=>BigInt(e.value));switch(s.length){case 0:return[kr.w7(0),kr.w8(0)];case 1:return[kr.w7(1n+2n**32n*o),kr.w8(0)];case 2:return[kr.w7(2n+2n**32n*o),kr.w8(i)];default:return[kr.w7(3n+2n**32n*o),kr.w8(i+2n**32n*a)]}}solicit(e,t){const[A,r]=e.registers.slice(7);if(!e.memory.canRead(A.toSafeMemoryAddress(),32))return[kr.panic()];const n=NA.decode(e.memory.getBytes(A.toSafeMemoryAddress(),32)).value,s=t.x.clone(),o=s.bold_s(),i=Number(r);if(void 0===o.requests.get(n,i))o.requests.set(n,i,[]);else{if(2!==o.requests.get(n,i)?.length)return[kr.w7(v)];{const e=o.requests.get(n,i);o.requests.set(n,i,[...e,t.tau])}}return o.balance<o.gasThreshold()?[kr.w7(Q)]:[kr.w7(b),kr.obj({x:s})]}forget(e,t){const[A,r]=e.registers.slice(7);if(!e.memory.canRead(A.toSafeMemoryAddress(),32))return[kr.panic()];if(!r.fitsInU32())return[kr.w7(v)];const n=NA.decode(e.memory.getBytes(A.toSafeMemoryAddress(),32)).value,s=t.x.clone(),o=s.bold_s(),i=o.requests.get(n,r.checked_u32());if(void 0===i)return[kr.w7(v)];{const[e,A,a]=i;if(Rr(`Preimage Request h=${NA.toJSON(n)} | z=${Number(r)} - stateKey=${we().toJSON(Bo(s.id,n,r.checked_u32()))}`,"true"===process.env.DEBUG_TRACES),0===i.length||2===i.length&&A.value<t.tau.value-q)Rr("l=0 or l=2 but expired... Deleting preimage","true"===process.env.DEBUG_TRACES),o.requests.delete(n,r.checked_u32()),o.preimages.delete(n);else if(1===i.length)Rr(`l=1... adding tau=${t.tau.value}`,"true"===process.env.DEBUG_TRACES),o.requests.set(n,r.checked_u32(),[e,t.tau]);else{if(!(3===i.length&&A.value<t.tau.value-q))return[kr.w7(v)];Rr("l=3 but expired... removing oldest tau","true"===process.env.DEBUG_TRACES),o.requests.set(n,r.checked_u32(),[a,t.tau])}}return s.state.accounts.set(s.id,o),[kr.w7(b),kr.obj({x:s})]}yield(e,t){const A=e.registers.w7();if(!e.memory.canRead(A.toSafeMemoryAddress(),32))return[kr.panic()];const r=NA.decode(e.memory.getBytes(A.toSafeMemoryAddress(),32)).value,n=t.clone();return n.yield=r,[kr.w7(b),kr.obj({x:n})]}provide(e,t){const[A,r]=e.registers.slice(8),n=e.registers.w7();let s=Number(n);if(n.value===2n**64n-1n&&(s=t.s),!e.memory.canRead(A.toSafeMemoryAddress(),Number(r)))return[kr.panic()];const o=e.memory.getBytes(A.toSafeMemoryAddress(),Number(r)),i=t.x.state.accounts.get(s);if(void 0===i)return[kr.w7(B)];if(0!==i.requests.get(wA.blake2b(o),r.checked_u32())?.length)return[kr.w7(v)];if(t.x.provisions.find(e=>e.serviceId===s&&0===Buffer.compare(e.blob,o)))return[kr.w7(v)];const a=t.x.clone();return a.provisions.push({serviceId:s,blob:o}),[kr.w7(b),kr.obj({x:a})]}log(e,t){const A=e.registers.w7().checked_u32(),r=e.registers.w8().u64(),n=e.registers.w9().checked_u32();let s;0n!==r&&0!==n&&(s=e.memory.getBytes(r,n));const o=e.registers.w10().u64(),i=e.registers.w11().checked_u32(),a=e.memory.getBytes(o,i),g=["FATAL","WARN","INFO","DEBUG","TRACE"][A];let c=`${(new Date).toISOString()} ${g}@${t.core}`;return void 0!==t.serviceIndex&&(c+=`#${t.serviceIndex}`),void 0!==s&&(c+=` ${Buffer.from(s).toString("utf8")}`),c+=` ${Buffer.from(a).toString("utf8")}`,Rr(c,"true"===process.env.DEBUG_TRACES),[]}}vA([Ur(0),bA("design:type",Function),bA("design:paramtypes",[Kr,void 0]),bA("design:returntype",Array)],Oo.prototype,"gas",null),vA([Ur(1),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"fetch",null),vA([Ur(2),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"lookup",null),vA([Ur(3),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"read",null),vA([Ur(4),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"write",null),vA([Ur(5),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"info",null),vA([Ur(6),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"historical_lookup",null),vA([Ur(7),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"export",null),vA([Ur(8),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"machine",null),vA([Ur(9),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"peek",null),vA([Ur(10),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"poke",null),vA([Ur(11),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"pages",null),vA([Ur(12),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"invoke",null),vA([Ur(13),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"expunge",null),vA([Ur(14),bA("design:type",Function),bA("design:paramtypes",[Kr,An]),bA("design:returntype",Array)],Oo.prototype,"bless",null),vA([Ur(15),bA("design:type",Function),bA("design:paramtypes",[Kr,An]),bA("design:returntype",Array)],Oo.prototype,"assign",null),vA([Ur(16),bA("design:type",Function),bA("design:paramtypes",[Kr,An]),bA("design:returntype",Array)],Oo.prototype,"designate",null),vA([Ur(17),bA("design:type",Function),bA("design:paramtypes",[Kr,An]),bA("design:returntype",Array)],Oo.prototype,"checkpoint",null),vA([Ur(18),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"new",null),vA([Ur(19),bA("design:type",Function),bA("design:paramtypes",[Kr,An]),bA("design:returntype",Array)],Oo.prototype,"upgrade",null),vA([Ur(20),bA("design:type",Function),bA("design:paramtypes",[Kr,An]),bA("design:returntype",Array)],Oo.prototype,"transfer",null),vA([Ur(21),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"eject",null),vA([Ur(22),bA("design:type",Function),bA("design:paramtypes",[Kr,An]),bA("design:returntype",Array)],Oo.prototype,"query",null),vA([Ur(23),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"solicit",null),vA([Ur(24),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"forget",null),vA([Ur(25),bA("design:type",Function),bA("design:paramtypes",[Kr,An]),bA("design:returntype",Array)],Oo.prototype,"yield",null),vA([Ur(26),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"provide",null),vA([Ur(100,0n),bA("design:type",Function),bA("design:paramtypes",[Kr,Object]),bA("design:returntype",Array)],Oo.prototype,"log",null);const ko=new Oo,Mo=ie([["service",No.codecOf("service")],["codeHash",No.codecOf("codeHash")],["refineGasLimit",No.codecOf("refineGasLimit")],["accumulateGasLimit",No.codecOf("accumulateGasLimit")],["exportCount",No.codecOf("exportCount")],["iLength",Fe(2)],["xLength",Fe(2)],["yLength",Fe(4)]]),xo=ie([["codeHash",$e(32)],["balance",Oe(8)],["gasThreshold",Oe(8)],["minAccGas",Oe(8)],["minMemoGas",Oe(8)],["totalOctets",Oe(8)],["itemInStorage",Fe(4)],["gratis",Oe(8)],["created",TA],["lastAcc",TA],["parent",Fe(4)]]);class Ro{constructor(e){Object.assign(this,e)}}const Fo=ie([["tau",TA],["serviceIndex",Fe(4)],["transfersLength",Je()]]),Uo=(e,A,r,n,s)=>{let o=e.get(r);t(void 0!==o,"Service not found in delta"),o=o.clone(),o.balance=o.balance+n.elements.reduce((e,t)=>e+t.amount,0n),t(o.balance>=0,"Balance cannot be negative");const i=o.code();if(void 0===i||i.length>X||0===n.length())return{serviceAccount:o,gasUsed:0n};const a=xs(i,10,n.totalGasUsed(),oe(Fo,{tau:A,serviceIndex:r,transfersLength:n.length()}),To({p_eta_0:s.p_eta_0,bold_d:e,s:r,bold_s:o,bold_t:n}),o);return{serviceAccount:a.out,gasUsed:a.gasUsed}},To=e=>t=>{const{s:A,bold_s:r,bold_d:n}=e;switch(Fr.byCode.get(t.hostCallOpcode)){case"gas":return Wn(t.ctx,t.out,ko.gas(t.ctx,void 0));case"fetch":return Wn(t.ctx,t.out,ko.fetch(t.ctx,{n:e.p_eta_0,bold_t:e.bold_t}));case"lookup":return Wn(t.ctx,t.out,ko.lookup(t.ctx,{bold_d:n,s:A,bold_s:r}));case"read":return Wn(t.ctx,t.out,ko.read(t.ctx,{bold_d:n,s:A,bold_s:r}));case"write":{const e={bold_s:t.out},n=Wn(t.ctx,e,ko.write(t.ctx,{s:A,bold_s:r}));return t.out=e.bold_s,n}case"info":{const e=ko.info(t.ctx,{s:A,bold_d:n});return Wn(t.ctx,t.out,e)}default:return Wn(t.ctx,t.out,[kr.gas(10n),kr.reg(7,E)])}};var Go;let jo=Go=class extends ue{constructor(e){super(),this.elements=void 0===e?[]:e}totalAmount(){return this.elements.reduce((e,t)=>e+t.amount,0n)}totalGasUsed(){return this.elements.reduce((e,t)=>e+t.gas,0n)}length(){return this.elements.length}byDestination(e){return new Go(this.elements.slice().sort((e,t)=>e.source===t.source?e.destination-t.destination:e.source-t.source).filter(t=>t.destination===e))}invokedTransfers(e){const t=new Map;for(const[A]of e.d_delta.elements)t.set(A,Uo(e.d_delta,e.p_tau,A,this.byDestination(A),{p_eta_0:e.p_eta_0}));return t}statistics(e){const t=new Map;for(const[A,{gasUsed:r}]of e){const e=this.byDestination(A);e.length()>0&&t.set(A,{count:e.length(),gasUsed:r})}return t}static newEmpty(){return new Go([])}};var Ho;vA([nt(vr),bA("design:type",Array)],jo.prototype,"elements",void 0),jo=Go=vA([he(),bA("design:paramtypes",[Array])],jo);let Lo=class extends ue{isSignatureValid(){return _A.verifySignature(this.signature,this.key,new Uint8Array([...Y,...this.target]))}};vA([ye(NA),bA("design:type",Object)],Lo.prototype,"target",void 0),vA([ye($e(32)),bA("design:type",Object)],Lo.prototype,"key",void 0),vA([ye($e(64)),bA("design:type",Object)],Lo.prototype,"signature",void 0),Lo=vA([he()],Lo);let Yo=Ho=class extends ue{constructor(e=[]){super(),this.elements=e}checkValidity(e){const t=new MA([...e.kappa.elements.map(e=>e.ed25519),...e.lambda.elements.map(e=>e.ed25519)]);e.disputesState.offenders.forEach(e=>t.delete(e));if(!this.elements.every(({key:e})=>t.has(e)))return Ut(Ko.CULPRITKEYNOTINK);if(!this.elements.every(e=>e.isSignatureValid()))return Ut(Ko.CULPRITSIGNATURESWRONG);if(this.elements.length>0)for(let e=1;e<this.elements.length;e++){const[t,A]=[this.elements[e-1],this.elements[e]];if(lt(t.key,A.key)>=0)return Ut(Ko.CULPRIT_NOT_ORDERED_BY_ED25519_PUBLIC_KEY)}return!1===e.bold_v.filter(e=>e.votes===un.ZERO).every(e=>!(this.elements.filter(t=>0===lt(t.target,e.reportHash)).length<2))?Ut(Ko.NEGATIVE_VERDICTS_NOT_IN_CULPRIT):Ft(this)}static empty(){return new Ho([])}};var Ko,Jo;vA([nt(Lo,ce),bA("design:type",Array)],Yo.prototype,"elements",void 0),Yo=Ho=vA([he(),bA("design:paramtypes",[Array])],Yo),function(e){e.CULPRITKEYNOTINK="CULPRITKEYNOTINK",e.CULPRITSIGNATURESWRONG="CULPRITSIGNATURESWRONG",e.CULPRIT_NOT_ORDERED_BY_ED25519_PUBLIC_KEY="CULPRIT_NOT_ORDERED_BY_ED25519_PUBLIC_KEY",e.NEGATIVE_VERDICTS_NOT_IN_CULPRIT="NEGATIVE_VERDICTS_NOT_IN_CULPRIT"}(Ko||(Ko={}));let Po=class extends ue{isSignatureValid(){return _A.verifySignature(this.signature,this.key,new Uint8Array([...this.vote?J:P,...this.target]))}};vA([ye(NA),bA("design:type",Object)],Po.prototype,"target",void 0),vA([Le(),bA("design:type",Boolean)],Po.prototype,"vote",void 0),vA([ye($e(32)),bA("design:type",Object)],Po.prototype,"key",void 0),vA([ye($e(64)),bA("design:type",Object)],Po.prototype,"signature",void 0),Po=vA([he()],Po);let Vo=Jo=class extends ue{constructor(e=[]){super(),this.elements=e}checkValidity(e){if(!1===e.bold_v.filter(e=>e.votes===un.TWO_THIRD_PLUS_ONE).every(e=>this.elements.some(t=>0===lt(t.target,e.reportHash))))return Ut(Xo.POSITIVE_VERDICTS_NOT_IN_FAULTS);const t=new MA([...e.kappa.elements.map(e=>e.ed25519),...e.lambda.elements.map(e=>e.ed25519)]);e.disputesState.offenders.forEach(e=>t.delete(e));if(!this.elements.every(({key:e})=>t.has(e)))return Ut(Xo.FAULTKEYNOTINK);if(!this.elements.every(e=>e.isSignatureValid()))return Ut(Xo.FAULTSIGNATURESWRONG);if(this.elements.length>0)for(let e=1;e<this.elements.length;e++){const[t,A]=[this.elements[e-1],this.elements[e]];if(lt(t.key,A.key)>=0)return Ut(Xo.FAULTS_NOT_ORDERED_BY_ED25519_PUBLIC_KEY)}return Ft(this)}static empty(){return new Jo([])}};var Xo,zo;vA([nt(Po,ce),bA("design:type",Array)],Vo.prototype,"elements",void 0),Vo=Jo=vA([he(),bA("design:paramtypes",[Array])],Vo),function(e){e.FAULTSIGNATURESWRONG="FAULTSIGNATURESWRONG",e.FAULTKEYNOTINK="FAULTKEYNOTINK",e.FAULTS_NOT_ORDERED_BY_ED25519_PUBLIC_KEY="FAULTS_NOT_ORDERED_BY_ED25519_PUBLIC_KEY",e.POSITIVE_VERDICTS_NOT_IN_FAULTS="POSITIVE_VERDICTS_NOT_IN_FAULTS"}(Xo||(Xo={}));let qo=zo=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}checkValidity(e){const t=this.verdicts.checkValidity({tau:e.tau,kappa:e.kappa,lambda:e.lambda,disputesState:e.disputesState});if(t.isErr())return Ut(t.error);const A=t.value.votes(),r=this.culprits.checkValidity({bold_v:A,disputesState:e.disputesState,kappa:e.kappa,lambda:e.lambda});if(r.isErr())return Ut(r.error);const n=this.faults.checkValidity({bold_v:A,kappa:e.kappa,lambda:e.lambda,disputesState:e.disputesState});return n.isErr()?Ut(n.error):Ft(this)}static newEmpty(){return new zo({culprits:Yo.empty(),faults:Vo.empty(),verdicts:cn.empty()})}};vA([ye(cn),bA("design:type",cn)],qo.prototype,"verdicts",void 0),vA([ye(Yo),bA("design:type",Yo)],qo.prototype,"culprits",void 0),vA([ye(Vo),bA("design:type",Vo)],qo.prototype,"faults",void 0),qo=zo=vA([he(),bA("design:paramtypes",[Object])],qo);const Wo=(e,t)=>{const A=[];for(let r=0;r<e;r++)A.push(Ge.decode(wA.blake2b(new Uint8Array([...t,...oe(Ge,Math.floor(r/8))])).subarray(4*r%32,4*r%32+4)).value);return A};var Zo;let $o=class extends ue{checkValidity(e){if(this.validatorIndex<0||this.validatorIndex>=O)return Ut(Ai.VALIDATOR_INDEX_MUST_BE_IN_BOUNDS);return _A.verifySignature(this.signature,e.guarantorAssignment.validatorsED22519Key[this.validatorIndex],e.messageToSign)?e.guarantorAssignment.validatorsAssignedCore[this.validatorIndex]!==e.reportCore?Ut(Ai.CORE_INDEX_MISMATCH):Ft(this):Ut(Ai.SIGNATURE_INVALID)}};vA([He(2,"validator_index"),bA("design:type",Number)],$o.prototype,"validatorIndex",void 0),vA([ye($e(64)),bA("design:type",Object)],$o.prototype,"signature",void 0),$o=vA([he()],$o);let ei=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}totalSize(){return this.report.authTrace.length+this.report.digests.map(e=>e.result).filter(e=>e.isSuccess()).map(e=>e.success.length).reduce((e,t)=>e+t,0)}messageToSign(){return new Uint8Array([...Y,...oe(NA,this.report.hash())])}checkValidity(e){if(this.report.srLookup.size+this.report.context.prerequisites.length>8)return Ut(Ai.TOO_MANY_PREREQUISITES);if(this.totalSize()>49152)return Ut(Ai.WORKREPORT_SIZE_EXCEEDED);if(this.signatures.length<2||this.signatures.length>3)return Ut(Ai.CREDS_MUST_BE_BETWEEN_2_AND_3);for(let e=1;e<this.signatures.length;e++){const[t,A]=[this.signatures[e-1],this.signatures[e]];if(t.validatorIndex>=A.validatorIndex)return Ut(Ai.VALIDATOR_INDEX_MUST_BE_UNIQUE_AND_ORDERED)}const t=Math.floor(e.p_tau.value/T);if(T*(t-1)>this.slot.value)return Ut(Ai.TIMESLOT_BOUNDS_1);if(this.slot.value>e.p_tau.value)return Ut(Ai.TIMESLOT_BOUNDS_2);const A=this.messageToSign();for(const r of this.signatures){let n=e.M_STAR;t===Math.floor(this.slot.value/T)&&(n=e.M);const[s,o]=r.checkValidity({guarantorAssignment:n,reportCore:this.report.core,messageToSign:A}).safeRet();if(void 0!==s)return Ut(s)}return Ft(this)}};vA([ye(PA),bA("design:type",PA)],ei.prototype,"report",void 0),vA([ye(TA),bA("design:type",TA)],ei.prototype,"slot",void 0),vA([nt($o),bA("design:type",Object)],ei.prototype,"signatures",void 0),ei=vA([he(),bA("design:paramtypes",[Object])],ei);let ti=Zo=class extends ue{constructor(e=[]){super(),this.elements=e}elementForCore(e){return this.elements.find(t=>t.report.core===e)}workReports(){return this.elements.map(e=>e.report)}M_star(e){return ni({p_eta2:e.p_entropy._2,p_eta3:e.p_entropy._3,p_kappa:e.p_kappa,p_lambda:e.p_lambda,p_offenders:e.p_disputes.offenders,p_tau:e.p_tau})}M(e){return ri({entropy:e.p_entropy._2,p_tau:e.p_tau,tauOffset:0,validatorKeys:e.p_kappa,p_offenders:e.p_disputes.offenders})}reporters(e){const t=this.M_star({p_entropy:e.p_entropy,p_kappa:e.p_kappa,p_lambda:e.p_lambda,p_disputes:e.p_disputes,p_tau:e.p_tau}),A=this.M({p_tau:e.p_tau,p_disputes:e.p_disputes,p_entropy:e.p_entropy,p_kappa:e.p_kappa}),r=new MA,n=Math.floor(e.p_tau.value/T);for(const{signatures:e,slot:s}of this.elements){let o=t;n===Math.floor(s.value/T)&&(o=A);for(const{validatorIndex:t}of e)r.add(o.validatorsED22519Key[t])}return r}checkValidity(e){if(0===this.elements.length)return Ft(this);if(this.elements.length>M)return Ut(Ai.EXTRINSIC_LENGTH_MUST_BE_LESS_THAN_CORES);for(let e=1;e<this.elements.length;e++){const[t,A]=[this.elements[e-1],this.elements[e]];if(t.report.core>=A.report.core)return Ut(Ai.CORE_INDEX_MUST_BE_UNIQUE_AND_ORDERED);if(A.report.core>=M||A.report.core<0)return Ut(Ai.CORE_INDEX_NOT_IN_BOUNDS)}for(const t of this.elements){const[A,r]=t.checkValidity({p_tau:e.p_tau,M_STAR:this.M_star({p_tau:e.p_tau,p_kappa:e.p_kappa,p_entropy:e.p_entropy,p_lambda:e.p_lambda,p_disputes:e.p_disputes}),M:this.M({p_disputes:e.p_disputes,p_tau:e.p_tau,p_entropy:e.p_entropy,p_kappa:e.p_kappa})}).safeRet();if(void 0!==A)return Ut(A)}const t=this.workReports();for(let A=0;A<t.length;A++){const{core:r,authorizerHash:n}=t[A];if(void 0!==e.dd_rho.elementAt(r))return Ut(Ai.REPORT_PENDING_AVAILABILITY);if(!new MA(e.authPool.elementAt(r)).has(n))return Ut(Ai.MISSING_AUTH)}for(const A of t){if(A.digests.map(e=>e.gasLimit).reduce((e,t)=>e+t,0n)>$)return Ut(Ai.GAS_EXCEEDED_ACCUMULATION_LIMITS);for(const t of A.digests){const A=e.serviceAccounts.get(t.serviceIndex);if(void 0===A)return Ut(Ai.REPORT_NOT_IN_ACCOUNTS);if(t.gasLimit<A.minAccGas)return Ut(Ai.GAS_TOO_LOW)}}const A=t.map(({context:e})=>e),r=t.map(({avSpec:e})=>e.packageHash);if(r.length!==new MA(r).size)return Ut(Ai.WORK_PACKAGE_HASH_NOT_UNIQUE);for(const t of A){if(void 0===e.d_recentHistory.elements.find(e=>0===Buffer.compare(e.headerHash,t.anchorHash)&&0===Buffer.compare(e.stateRoot,t.anchorPostState)&&0===Buffer.compare(e.accumulationResultMMB,t.anchorAccOutLog)))return Ut(Ai.ANCHOR_NOT_IN_RECENTHISTORY);if(t.lookupAnchorSlot.value<e.p_tau.value-G)return Ut(Ai.LOOKUP_ANCHOR_NOT_WITHIN_L);const A=e.headerLookupHistory.get(t.lookupAnchorSlot);if(void 0===A)return Ut(Ai.LOOKUP_ANCHOR_TIMESLOT_MISMATCH);if(0!==Buffer.compare(A.signedHash(),t.lookupAnchorHash))return Ut(Ai.LOOKUP_HASH_MISMATCH)}const n=new MA(e.accumulationQueue.elements.flat().map(e=>e.workReport.avSpec.packageHash).flat()),s=new MA(e.rho.elements.map(e=>e?.workReport.avSpec.packageHash).flat().filter(e=>void 0!==e)),o=e.beta.recentHistory.allPackageHashes(),i=new Set(e.accumulationHistory.elements.map(e=>[...e.values()]).flat());for(const e of r)if(n.has(e)||s.has(e)||o.has(e)||i.has(e))return Ut(Ai.WORKPACKAGE_IN_PIPELINE);const a=new MA(r);o.forEach(e=>a.add(e));for(const e of t){const t=new Set([...e.srLookup.keys()]);e.context.prerequisites.forEach(e=>t.add(e));for(const e of t.values())if(!a.has(e))return Ut(Ai.SRLWP_NOTKNOWN)}{const A=new KA(this.elements.map(e=>e.report.avSpec).map(e=>[e.packageHash,e.segmentRoot])),r=new KA(e.beta.recentHistory.elements.map(e=>[...e.reportedPackages.entries()]).flat().concat([...A.entries()]));for(const e of t)for(const[t,A]of e.srLookup){const e=r.get(t);if(void 0===e||0!==Buffer.compare(e,A))return Ut(Ai.SRLWP_NOTKNOWN)}}for(const A of t)for(const t of A.digests)if(0!==Buffer.compare(t.codeHash,e.serviceAccounts.get(t.serviceIndex)?.codeHash??new Uint8Array))return Ut(Ai.WRONG_CODEHASH);return Ft(this)}static newEmpty(){return new Zo([])}};var Ai;vA([nt(ei,ce),bA("design:type",Object)],ti.prototype,"elements",void 0),ti=Zo=vA([he(),bA("design:paramtypes",[Array])],ti),function(e){e.GAS_TOO_LOW="Work result gasPrioritization is too low",e.GAS_EXCEEDED_ACCUMULATION_LIMITS="Gas exceeded maximum accumulation limit GA",e.WORKREPORT_SIZE_EXCEEDED="Workreport max size exceeded",e.MISSING_AUTH="MISSING_AUTH",e.TOO_MANY_PREREQUISITES="Too many work prerequisites in report",e.ANCHOR_NOT_IN_RECENTHISTORY="ANCHOR_NOT_IN_RECENTHISTORY",e.EXTRINSIC_LENGTH_MUST_BE_LESS_THAN_CORES="Extrinsic length must be less than CORES",e.CORE_INDEX_MUST_BE_UNIQUE_AND_ORDERED="core index must be unique and ordered",e.CORE_INDEX_NOT_IN_BOUNDS="core index not in bounds",e.CREDS_MUST_BE_BETWEEN_2_AND_3="credential length must be between 2 and 3",e.VALIDATOR_INDEX_MUST_BE_IN_BOUNDS="validator index must be 0 <= x < V",e.VALIDATOR_INDEX_MUST_BE_UNIQUE_AND_ORDERED="validator index must be unique and ordered",e.SIGNATURE_INVALID="EG signature is invalid",e.CORE_INDEX_MISMATCH="CORE_INDEX_MISMATCH",e.TIMESLOT_BOUNDS_1="Time slot must be within bounds, R * floor(tau'/R) - 1 <= t",e.TIMESLOT_BOUNDS_2="Time slot must be within bounds, t <= tau'",e.WORK_PACKAGE_HASH_NOT_UNIQUE="WORK_PACKAGE_HASH_NOT_UNIQUE",e.WORKPACKAGE_IN_PIPELINE="Work Package alredy known",e.SRLWP_NOTKNOWN="Reported Segment Root lookup not known",e.LOOKUP_ANCHOR_NOT_WITHIN_L="LOOKUP_ANCHOR_NOT_WITHIN_L",e.REPORT_PENDING_AVAILABILITY="Bit may be set if the corresponding core has a report pending availability",e.LOOKUP_ANCHOR_TIMESLOT_MISMATCH="LOOKUP_ANCHOR_TIMESLOT_MISMATCH",e.WRONG_CODEHASH="WRONG_CODEHASH",e.LOOKUP_HASH_MISMATCH="LOOKUP_HASH_MISMATCH",e.REPORT_NOT_IN_ACCOUNTS="REPORT_NOT_IN_ACCOUNTS"}(Ai||(Ai={}));const ri=e=>{return{validatorsAssignedCore:(t=e.entropy,A=new TA(e.p_tau.value+e.tauOffset),s=Array.from({length:O},(e,t)=>Math.floor(M*t/O)),o=t,r=((e,t)=>{const A=e.slice();let r=A.length,n=0;const s=[];for(;r>0;)n=t[A.length-r]%r,s.push(A[n]),A[n]=A[r-1],r--;return s})(s,Wo(s.length,o)),n=Math.floor(A.value%R/T),r.map(e=>(e+n)%M)),validatorsED22519Key:e.validatorKeys.phi(e.p_offenders).elements.map(e=>e.ed25519)};var t,A,r,n,s,o},ni=e=>new TA(e.p_tau.value-T).epochIndex()==e.p_tau.epochIndex()?ri({entropy:e.p_eta2,tauOffset:-T,p_tau:e.p_tau,validatorKeys:e.p_kappa,p_offenders:e.p_offenders}):ri({entropy:e.p_eta3,tauOffset:-T,p_tau:e.p_tau,validatorKeys:e.p_lambda,p_offenders:e.p_offenders});var si;let oi=class extends ue{};vA([He(4),bA("design:type",Number)],oi.prototype,"requester",void 0),vA([ye(At),bA("design:type",Uint8Array)],oi.prototype,"blob",void 0),oi=vA([he()],oi);let ii=si=class extends ue{constructor(e=[]){super(),this.elements=e}checkValidity(e){for(const{requester:e}of this.elements)if(e<0||e>=2**32)return Ut(ai.VALIDATION_ERROR);for(let e=1;e<this.elements.length;e++){const t=this.elements[e-1];if(t.requester>this.elements[e].requester)return Ut(ai.PREIMAGES_NOT_SORTED);if(t.requester===this.elements[e].requester){if(-1!==lt(t.blob,this.elements[e].blob))return Ut(ai.PREIMAGES_NOT_SORTED)}}for(const{requester:t,blob:A}of this.elements)if(!e.serviceAccounts.get(t).isPreimageSolicitedButNotYetProvided(wA.blake2b(A),A.length))return Ut(ai.PREIMAGE_PROVIDED_OR_UNSOLICITED);return Ft(this)}static newEmpty(){return new si([])}};var ai,gi,ci;vA([nt(oi,ce),bA("design:type",Array)],ii.prototype,"elements",void 0),ii=si=vA([he(),bA("design:paramtypes",[Array])],ii),function(e){e.VALIDATION_ERROR="VALIDATION_ERROR",e.PREIMAGE_PROVIDED_OR_UNSOLICITED="PREIMAGE_PROVIDED_OR_UNSOLICITED",e.PREIMAGES_NOT_SORTED="PREIMAGES_NOT_SORTED"}(ai||(ai={})),function(e){e.LOTTERY_ENDED="Lottery has ended",e.INVALID_ENTRY_INDEX="Invalid Entry index must be 0<=x<N",e.INVALID_VRF_PROOF="Invalid VRF proof",e.MAX_TICKETS_EXCEEDED="Extrinsic length must be less than MAX_TICKETS_PER_BLOCK",e.TICKET_IN_GAMMA_A="Ticket id already in gamma_a",e.UNSORTED_VRF_PROOFS="VRF outputs must be in ascending order and not duplicate"}(ci||(ci={}));let ui=class extends ue{checkValidity(e){if(this.attempt<0||this.attempt>=U)return Ut(ci.INVALID_ENTRY_INDEX);return fA.verifyVrfProof(this.proof,e.p_gamma_z.root,new Uint8Array([...K,...oe(NA,e.p_entropy._2),this.attempt]))?Ft(this):Ut(ci.INVALID_VRF_PROOF)}};vA([He(1),bA("design:type",Number)],ui.prototype,"attempt",void 0),vA([le(we(),"signature"),pe(Ze(784)),bA("design:type",Object)],ui.prototype,"proof",void 0),ui=vA([he()],ui);let Ii=gi=class extends ue{constructor(e=[]){super(),this.elements=e}newTickets(e){if(0===this.elements.length)return Ft([]);if(e.p_tau.slotPhase()>=x)return Ut(ci.LOTTERY_ENDED);if(this.elements.length>F)return Ut(ci.MAX_TICKETS_EXCEEDED);for(const t of this.elements){const[A]=t.checkValidity({p_entropy:e.p_entropy,p_gamma_z:e.p_gamma_z}).safeRet();if(void 0!==A)return Ut(A)}const t=[];for(const e of this.elements)t.push(new hn({id:fA.vrfOutputRingProof(e.proof),attempt:e.attempt}));for(let e=1;e<t.length;e++)if(lt(t[e-1].id,t[e].id)>=0)return Ut(ci.UNSORTED_VRF_PROOFS);const A=new MA(e.gamma_a.elements.map(e=>e.id));for(const e of t)if(A.has(e.id))return Ut(ci.TICKET_IN_GAMMA_A);return Ft(t)}static newEmpty(){return new gi([])}};var di;vA([nt(ui,ce),bA("design:type",Object)],Ii.prototype,"elements",void 0),Ii=gi=vA([he(),bA("design:paramtypes",[Array])],Ii);let pi=di=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}extrinsicHash(){const e=[...wA.blake2b(this.tickets.toBinary()),...wA.blake2b(this.preimages.toBinary()),...wA.blake2b(oe(li,this.reportGuarantees.elements)),...wA.blake2b(this.assurances.toBinary()),...wA.blake2b(this.disputes.toBinary())],t=new Uint8Array(e);return wA.blake2b(t)}static newEmpty(){return new di({tickets:Ii.newEmpty(),preimages:ii.newEmpty(),reportGuarantees:ti.newEmpty(),assurances:Xs.newEmpty(),disputes:qo.newEmpty()})}};vA([ye(Ii),bA("design:type",Ii)],pi.prototype,"tickets",void 0),vA([ye(ii),bA("design:type",ii)],pi.prototype,"preimages",void 0),vA([ye(ti,"guarantees"),bA("design:type",ti)],pi.prototype,"reportGuarantees",void 0),vA([ye(Xs),bA("design:type",Xs)],pi.prototype,"assurances",void 0),vA([ye(qo),bA("design:type",qo)],pi.prototype,"disputes",void 0),pi=di=vA([he(),bA("design:paramtypes",[Object])],pi);const li=rt(ie([["report",{encode:(e,t)=>NA.encode(e.hash(),t),decode(){throw new Error("codec_Eg_4Hx should not be used for decoding")},encodedSize:()=>32}],["slot",TA],["signatures",rt(ie([["validatorIndex",Fe(2)],["signature",$e(64)]]))]]));var yi;let hi=yi=class extends ue{constructor(e){super(),e&&Object.assign(this,e)}static create(e,t,A,r){const[n,s]=e.block.header.buildNext(e,A,t,r).safeRet();return n?Ut(n):Ft(new yi({extrinsics:A,header:s}))}};var Ci;vA([ye(Un),bA("design:type",Un)],hi.prototype,"header",void 0),vA([ye(pi,"extrinsic"),bA("design:type",pi)],hi.prototype,"extrinsics",void 0),hi=yi=vA([he(),bA("design:paramtypes",[Object])],hi);let Ei=Ci=class extends _n{toPosterior(e,t){if(t.p_tau.isNewerEra(e.slot)){const t=Ie(e.safroleState.gamma_p);return new Ci({elements:t.elements})}return Ie(this)}bandersnatchIndex(e){return this.elements.findIndex(t=>0===lt(t.banderSnatch,e))}static newEmpty(){return new Ci({elements:Array.from({length:O},()=>Qn.newEmpty())})}};var mi;Ei=Ci=vA([he()],Ei);let Bi=mi=class extends _n{toPosterior(e,t){return t.p_tau.isNewerEra(e.slot)?new mi({elements:e.kappa.elements.slice()}):Ie(this)}static newEmpty(){return new mi({elements:Array.from({length:O},()=>Qn.newEmpty())})}};var Qi,fi;Bi=mi=vA([he()],Bi);let _i=class extends ue{constructor(){super(...arguments),Qi.add(this)}hash(){return wA.blake2b(this.toBinary())}authorizer(){return wA.blake2b(new Uint8Array([...oe(NA,this.authCodeHash),...this.authConfig]))}code(e){return SA(this,Qi,"m",fi).call(this,e).code}metadata(e){return SA(this,Qi,"m",fi).call(this,e).metadata}isAuthorized(e,t){const A=this.code(t.delta);if(0===A.length)return{res:HA.bad(),gasUsed:0n};if(A.length>64e3)return{res:HA.big(),gasUsed:0n};const r=xs(A,0,50000000n,oe(Te,e),wi(this,e),void 0);return{res:r.res,gasUsed:r.gasUsed}}};Qi=new WeakSet,fi=function(e){const t=e.get(this.authCodeHost).historicalLookup(this.context.lookupAnchorSlot,this.authCodeHash),{value:A,readBytes:r}=At.decode(t);return{metadata:A,code:t.slice(r)}},vA([He(4,"auth_code_host"),bA("design:type",Number)],_i.prototype,"authCodeHost",void 0),vA([ye(NA,"auth_code_hash"),bA("design:type",Object)],_i.prototype,"authCodeHash",void 0),vA([ye(jA),bA("design:type",jA)],_i.prototype,"context",void 0),vA([ye(At,"authorization"),bA("design:type",Object)],_i.prototype,"authToken",void 0),vA([ye(At,"authorizer_config"),bA("design:type",Object)],_i.prototype,"authConfig",void 0),vA([le(be(No),"items"),pe(rt(No)),bA("design:type",Object)],_i.prototype,"workItems",void 0),_i=vA([he()],_i);const wi=(e,t)=>A=>0===A.hostCallOpcode?Wn(A.ctx,A.out,ko.gas(A.ctx,void 0)):1===A.hostCallOpcode?Wn(A.ctx,A.out,ko.fetch(A.ctx,{p:e})):100===A.hostCallOpcode?Wn(A.ctx,A.out,ko.log(A.ctx,{core:t})):Wn(A.ctx,A.out,[kr.gas(10n),kr.reg(7,E)]);function vi(e,t,A,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,A):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,A,r);else for(var i=e.length-1;i>=0;i--)(n=e[i])&&(o=(s<3?n(o):s>3?n(t,A,o):n(t,A))||o);return s>3&&o&&Object.defineProperty(t,A,o),o}function bi(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}"function"==typeof SuppressedError&&SuppressedError;let Si=class extends ue{constructor(e){super(),e&&Object.assign(this,e)}};vi([ye($e(32),ce),bi("design:type",Object)],Si.prototype,"headerHash",void 0),Si=vi([he(),bi("design:paramtypes",[Object])],Si);let Di=class extends ue{};vi([He(1),bi("design:type",Number)],Di.prototype,"major",void 0),vi([He(1),bi("design:type",Number)],Di.prototype,"minor",void 0),vi([He(1),bi("design:type",Number)],Di.prototype,"patch",void 0),Di=vi([he()],Di);var Ni,Oi={version:"0.7.0","jam:protocolVersion":"0.7.0"};const ki={fromJSON:e=>e,toJSON:e=>e};let Mi=Ni=class extends ue{static build(){const e=new Ni;return e.name=`tsjam-${Oi.version}-${se()}`,e.jamVersion=new Di,e.jamVersion.major=parseInt(Oi["jam:protocolVersion"].split(".")[0]),e.jamVersion.minor=parseInt(Oi["jam:protocolVersion"].split(".")[1]),e.jamVersion.patch=parseInt(Oi["jam:protocolVersion"].split(".")[2]),e.appVersion=new Di,e.appVersion.major=parseInt(Oi.version.split(".")[0]),e.appVersion.minor=parseInt(Oi.version.split(".")[1]),e.appVersion.patch=parseInt(Oi.version.split(".")[2]),e}};vi([le(ki),pe(ae(At,e=>Buffer.from(e).toString("utf8"),e=>Buffer.from(e,"utf8"))),bi("design:type",String)],Mi.prototype,"name",void 0),vi([ye(Di,"app_version"),bi("design:type",Di)],Mi.prototype,"appVersion",void 0),vi([ye(Di,"jam_version"),bi("design:type",Di)],Mi.prototype,"jamVersion",void 0),Mi=Ni=vi([he()],Mi);let xi=class extends ue{constructor(e){super(),void 0!==e&&Object.assign(this,e)}};vi([ye(JA($e(31),At,{key:"key",value:"value"}),ce),bi("design:type",KA)],xi.prototype,"value",void 0),xi=vi([he(),bi("design:paramtypes",[Object])],xi);let Ri=class extends ue{constructor(e){super(),e&&Object.assign(this,e)}};var Fi;vi([ye(Un),bi("design:type",Un)],Ri.prototype,"header",void 0),vi([ye(xi),bi("design:type",xi)],Ri.prototype,"state",void 0),Ri=vi([he(),bi("design:paramtypes",[Object])],Ri),function(e){e.PEER_INFO="PEER_INFO",e.IMPORT_BLOCK="IMPORT_BLOCK",e.SET_STATE="SET_STATE",e.GET_STATE="GET_STATE",e.STATE="STATE",e.STATE_ROOT="STATE_ROOT"}(Fi||(Fi={}));class Ui{constructor(e){Object.assign(this,e)}type(){if(this.peerInfo)return Fi.PEER_INFO;if(this.importBlock)return Fi.IMPORT_BLOCK;if(this.setState)return Fi.SET_STATE;if(this.getState)return Fi.GET_STATE;if(this.state)return Fi.STATE;if(this.stateRoot)return Fi.STATE_ROOT;throw new Error("Invalid message type")}}const Ti=ae(gt([["peerInfo",Mi],["importBlock",hi],["setState",Ri],["getState",Si],["state",xi],["stateRoot",$e(32)]]),e=>new Ui(e),e=>e),Gi={encode(e,t){const A=Ti.encode(e,t.subarray(4));return Ge.encode(A,t),4+A},decode(e){const{value:t}=Ge.decode(e),{value:A}=Ti.decode(e.subarray(4,4+t));return{value:A,readBytes:4+t}},encodedSize:e=>4+Ti.encodedSize(e)},{values:ji}=h({options:{socket:{type:"string",short:"s"}}}),Hi=ji.socket??process.env.SOCKET_PATH??"/tmp/jam_target.sock";l.existsSync(Hi)&&l.unlinkSync(Hi);let Li,Yi=null;const Ki=y.createServer(e=>{const A=t=>{const A=oe(Gi,t);console.log(`-> ${A.length}`),e.write(A)};let r=Buffer.alloc(0),n=-1;e.on("data",e=>{-1===n&&(n=Fe(4).decode(e).value+4),r=Buffer.concat([r,e]),r.length===n&&(console.log("<-",r.length),s(r),n=-1,r=Buffer.alloc(0))});const s=e=>{const r=Gi.decode(e).value;switch(console.log(`received message ${r.type()}`),r.type()){case Fi.PEER_INFO:const e=Mi.build();A(new Ui({peerInfo:e}));break;case Fi.SET_STATE:const n=r.setState.state.value;Yi=(e=>{const t=sr.decode(e.get(rn(1))).value,A=ir.decode(e.get(rn(2))).value,r=Er.decode(e.get(rn(3))).value,n=Co.decode(e.get(rn(4))).value,s=pn.decode(e.get(rn(5))).value,o=Jn.decode(e.get(rn(6))).value,i=_n.decode(e.get(rn(7))).value,a=Ei.decode(e.get(rn(8))).value,g=Bi.decode(e.get(rn(9))).value,c=yo.decode(e.get(rn(10))).value,u=TA.decode(e.get(rn(11))).value,I=Hr.decode(e.get(rn(12))).value,d=Io.decode(e.get(rn(13))).value,p=tr.decode(e.get(rn(14))).value,l=XA.decode(e.get(rn(15))).value,y=Xn.decode(e.get(rn(16))).value,h=[...e.keys()].filter(t=>255===t[0]&&0===t[2]&&0===t[4]&&0===t[6]&&0===t[8]&&0===t[9]&&88===e.get(t).length),C=new Gr;for(const t of h){const A=new Uint8Array([t[1],t[3],t[5],t[7]]),r=qs.decode(e.get(t)).value,n=Fe(4).decode(A).value,s=new Set([...e.keys()].filter(e=>e[0]===A[0]&&e[2]===A[1]&&e[4]===A[2]&&e[6]===A[3])),o=new fo(n,r.totalOctets,r.itemInStorage),i=new vo({codeHash:r.codeHash,balance:r.balance,minAccGas:r.minAccGas,minMemoGas:r.minMemoGas,gratis:r.gratis,created:r.created,lastAcc:r.lastAcc,parent:r.parent,preimages:new KA},o),a=[...s.values()].filter(t=>{const A=e.get(t),r=wA.blake2b(A),s=rn(n,new Uint8Array([...oe(Ge,2**32-2),...r]));return 0===Buffer.compare(s,t)});for(const t of a){const A=e.get(t),r=wA.blake2b(A);i.preimages.set(r,A),s.delete(t)}for(const t of s)o.setStorage(t,e.get(t));C.set(n,i)}return new $s({accumulationHistory:l,accumulationQueue:p,authPool:t,authQueue:A,beta:r,disputes:s,entropy:o,iota:i,kappa:a,lambda:g,mostRecentAccumulationOutputs:y,privServices:I,rho:c,safroleState:n,serviceAccounts:C,slot:u,statistics:d,headerLookupHistory:new Yn(new on)})})(n),Yi.block=new hi({header:r.setState.header,extrinsics:pi.newEmpty()}),Yi.headerLookupHistory=Yi.headerLookupHistory.toPosterior({header:r.setState.header}),Li=new KA,Li.set(r.setState.header.signedHash(),r.setState),A(new Ui({stateRoot:Yi.merkleRoot()}));break;case Fi.IMPORT_BLOCK:const s=r.importBlock;t(Yi,"State must be initialized before applying a block");const o=Yi.applyBlock(s);if(o.isErr())return console.log("Block application error:"),console.log(o.error),void A(new Ui({stateRoot:Yi.merkleRoot()}));Yi=o.value,Li.set(s.header.signedHash(),new Ri({header:s.header,state:new xi({value:Zs(o.value)})})),A(new Ui({stateRoot:o.value.merkleRoot()}));break;case Fi.GET_STATE:const i=Li.get(r.getState.headerHash);t(i,"State not found for header hash: "+$e(32).toJSON(r.getState.headerHash)),A(new Ui({state:i.state}));break;default:console.error("Unhandled message type:",r.type())}};e.on("error",e=>console.error("Socket error:",e))});Ki.listen(Hi,()=>{console.log("Listening on",Hi),console.log("constant mode",se()),console.log(Mi.build().toJSON())}),Ki.on("error",e=>console.error("Server error:",e));
//# sourceMappingURL=cli.mjs.map
